let siteData={},allSearchableItems={},largePlayer,mediumPlayer,activePlayer=null,currentPlayingItem=null,isPlayerLooping=!1,isShuffleMode=!1,pausedForOverlay=!1,isResumingFromOverlay=!1,playerInitializationComplete=!1,likedSongs=new Set,achievements={},currentPlaylist=[],activePlaybackQueue=[],currentQueueIndex=-1,isHovering=!1,isAutoplayActive=!0,currentVolume=100,sfxEnabled=!0,currentLang="en",currentNavigationContext={playlist:[],index:-1},currentViewContext={type:"menu",data:null},isBackgroundPlayEnabled=!0,listenProgress=0,previousListenProgress=0,seekDetectedInCurrentPlay=!1,isReloadingForAd=!1,userCoins=0;const COIN_COST_UNLOCK=10;let unlockedDreamSeasonTracks=[],isTutorialActive=!1,tutorialSuppressAutoplay=!1,tutorialSavedPlayerState=null,originalAutoplayState=!0,titleScrollObserver=null,titleResizeObserver=null,deferredPrompt=null;const sounds={select:document.getElementById("select-sound"),back:document.getElementById("back-sound"),hover:document.getElementById("hover-sound"),switchToWhite:document.getElementById("switch-to-white-sound"),switchToBlack:document.getElementById("switch-to-black-sound"),shop:document.getElementById("shop-sound"),connecting:document.getElementById("connecting-sound"),achievementUnlocked:document.getElementById("achievement-unlocked-sound"),minimize:document.getElementById("minimize-sound"),maximize:document.getElementById("maximize-sound"),coin:document.getElementById("coin-sound"),keepAlive:document.getElementById("keep-alive-sound"),blocked:document.getElementById("blocked-sound")};async function loadDataAndInitialize(){try{const e=await fetch("data.json");if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);siteData=await e.json(),Object.values(siteData.contentData).forEach(s=>{Object.entries(s.titles).forEach(([a,n])=>n.id=a),Object.entries(s.gameplay).forEach(([a,n])=>n.id=a),Object.entries(s.makingofs).forEach(([a,n])=>n.id=a),Object.entries(s.albums).forEach(([a,n])=>{n.id=a,n.type="album"}),Object.assign(allSearchableItems,s.titles,s.gameplay,s.makingofs,s.albums)}),initializeApp()}catch(e){console.error("Could not load site data:",e),document.body.innerHTML='<h1 style="text-align: center; margin-top: 50px;">Erreur de chargement des donn\xE9es. Veuillez r\xE9essayer.</h1>'}}window.onYouTubeIframeAPIReady=function(){const e={height:"100%",width:"100%",playerVars:{playsinline:1,autoplay:0,controls:0,modestbranding:1,rel:0,origin:window.location.origin},events:{onReady:onPlayerReady,onStateChange:onPlayerStateChange}};largePlayer=new YT.Player("large-player-iframe",e),mediumPlayer=new YT.Player("medium-player-iframe",e),playerInitializationComplete=!0,currentPlayingItem&&loadAndPlayVideo(currentPlayingItem)};function onPlayerReady(e){setVolume(currentVolume),setInterval(updateProgressBar,1e3)}function onPlayerStateChange(e){const s=document.getElementById("play-pause-btn"),a=document.getElementById("play-pause-box"),n=document.getElementById("background-music");if(e.data===YT.PlayerState.PLAYING||e.data===YT.PlayerState.PAUSED||e.data===YT.PlayerState.ENDED?a.classList.remove("loading"):e.data===YT.PlayerState.BUFFERING&&a.classList.add("loading"),e.data===YT.PlayerState.ENDED){"mediaSession"in navigator&&(navigator.mediaSession.playbackState="paused");const o=activePlayer.getDuration()>0?activePlayer.getCurrentTime()/activePlayer.getDuration():0;if(currentPlayingItem&&isMusicTitle(currentPlayingItem)&&!seekDetectedInCurrentPlay&&o>=.95){userCoins++,localStorage.setItem("mmg-userCoins",JSON.stringify(userCoins)),updateCoinDisplay(),showDialog(`+1 pi\xE8ce ! Total : ${userCoins}`),playAudio(sounds.coin);const c=currentPlayingItem.id;isPlayerLooping&&updateAchievementProgress("loopMaster",c),currentPlayingItem.tags?.includes("retro")&&updateAchievementProgress("retroPlayer",c),currentPlayingItem.tags?.includes("playstation")&&updateAchievementProgress("psPlayer",c)}if(isPlayerLooping){isBackgroundPlayEnabled&&sounds.keepAlive&&sounds.keepAlive.play().catch(c=>console.log("Keep-alive audio failed to play on loop.")),e.target.seekTo(0),e.target.playVideo();return}isAutoplayActive?playNextTrack():(sounds.keepAlive&&sounds.keepAlive.pause(),s&&(s.className="fas fa-play")),updateMediaPositionState()}else if(e.data===YT.PlayerState.PLAYING){if(isReloadingForAd){isReloadingForAd=!1;return}if(s&&(s.className="fas fa-pause"),n.pause(),"mediaSession"in navigator&&(navigator.mediaSession.playbackState="playing"),isResumingFromOverlay){isResumingFromOverlay=!1;return}document.getElementById("video-suggestions-section").classList.contains("hidden")===!1&&showSection(isMusicTitle(currentPlayingItem)?"music-title-details-section":"large-player-section"),isMusicTitle(currentPlayingItem)&&setTimeout(()=>{!n.paused&&!isReloadingForAd&&activePlayer.getPlayerState()===YT.PlayerState.PLAYING&&(console.log("Ad detected (background music still playing). Reloading video."),isReloadingForAd=!0,loadAndPlayVideo(currentPlayingItem))},500),updateMediaPositionState()}else e.data===YT.PlayerState.PAUSED&&(s&&(s.className="fas fa-play"),"mediaSession"in navigator&&(navigator.mediaSession.playbackState="paused"),sounds.keepAlive&&sounds.keepAlive.pause(),updateMediaPositionState())}function playVideoWhenReady(e,s=[],a=-1,n=!1,o=!1){if(e){if(!isAutoplayActive&&!n&&!o&&isMusicTitle(e)){renderMusicTitleDetails(e),showSection("music-title-details-section");return}if(o)currentNavigationContext&&currentNavigationContext.playlist.length>0?(activePlaybackQueue=currentNavigationContext.playlist,currentQueueIndex=activePlaybackQueue.findIndex(c=>c===e.id),currentQueueIndex===-1&&(activePlaybackQueue=[e.id],currentQueueIndex=0)):(activePlaybackQueue=[e.id],currentQueueIndex=0);else if(n)activePlaybackQueue=[...currentPlaylist],currentQueueIndex=currentPlaylist.findIndex(c=>c===e.id);else if(s&&s.length>0)activePlaybackQueue=s,currentQueueIndex=a;else{const c=document.querySelector(".profile-tab.active")?.dataset.project||"mmg-music",r=e.albumId;r?(activePlaybackQueue=Object.values(siteData.contentData[c].titles).filter(l=>l.albumId===r).map(l=>l.id),currentQueueIndex=activePlaybackQueue.findIndex(l=>l===e.id)):(activePlaybackQueue=[e.id],currentQueueIndex=0)}currentPlayingItem=e,seekDetectedInCurrentPlay=!1,previousListenProgress=0,playerInitializationComplete?loadAndPlayVideo(e):showDialog("Chargement du lecteur vid\xE9o...")}}function loadAndPlayVideo(e){document.getElementById("play-pause-box").classList.add("loading"),currentPlayingItem=e;const s=isMusicTitle(e);activePlayer=s?mediumPlayer:largePlayer;const a=s?largePlayer:mediumPlayer;if(a&&typeof a.stopVideo=="function"&&a.stopVideo(),updateMp3PlayerInfo(e),updateLikeButtonUI(e.id),updateMediaSession(e),renderPlaylist(),tutorialSuppressAutoplay){tutorialSuppressAutoplay=!1,s?(renderMusicTitleDetails(e),showSection("music-title-details-section")):showSection("large-player-section");return}s?(renderMusicTitleDetails(e),showSection("music-title-details-section"),document.getElementById("medium-player-iframe").style.display="none"):(document.getElementById("medium-player-iframe").style.display="",showSection("large-player-section")),activePlayer&&typeof activePlayer.loadVideoById=="function"&&activePlayer.loadVideoById(e.youtube_id,0)}function updateMediaSession(e){if(!("mediaSession"in navigator))return;const s=document.querySelector(".profile-tab.active")?.dataset.project||"mmg-music",a=siteData.contentData[s].albums[e.albumId];navigator.mediaSession.metadata=new MediaMetadata({title:e.title,artist:s==="mmg-music"?"Mmg Music":"Mmg Beats",album:a?a.title:"Single",artwork:[{src:getCorrectImagePath(e),sizes:"512x512",type:"image/png"}]}),navigator.mediaSession.playbackState="playing",navigator.mediaSession.setActionHandler("play",()=>{activePlayer&&activePlayer.playVideo()}),navigator.mediaSession.setActionHandler("pause",()=>{activePlayer&&activePlayer.pauseVideo()}),navigator.mediaSession.setActionHandler("previoustrack",()=>playNextTrack(-1,!0)),navigator.mediaSession.setActionHandler("nexttrack",()=>playNextTrack(1,!0)),navigator.mediaSession.setActionHandler("seekbackward",n=>{const o=n.seekOffset||10;activePlayer&&activePlayer.seekTo(Math.max(0,activePlayer.getCurrentTime()-o),!0)}),navigator.mediaSession.setActionHandler("seekforward",n=>{const o=n.seekOffset||10;activePlayer&&activePlayer.seekTo(Math.min(activePlayer.getDuration(),activePlayer.getCurrentTime()+o),!0)}),navigator.mediaSession.setActionHandler("seekto",n=>{if(n.fastSeek&&"fastSeek"in activePlayer){activePlayer.fastSeek(n.seekTime);return}activePlayer&&activePlayer.seekTo(n.seekTime,!0)}),navigator.mediaSession.setActionHandler("stop",()=>{activePlayer&&typeof activePlayer.stopVideo=="function"&&(activePlayer.stopVideo(),currentPlayingItem=null,resetMiniPlayerUI(),sounds.keepAlive&&sounds.keepAlive.pause(),navigator.mediaSession.playbackState="none")}),updateMediaPositionState()}function updateMediaPositionState(){if(!("mediaSession"in navigator)||!activePlayer||typeof activePlayer.getDuration!="function")return;const e=activePlayer.getDuration()||0,s=activePlayer.getCurrentTime()||0;if(navigator.mediaSession.playbackState==="playing"&&!isNaN(e)&&isFinite(e))try{navigator.mediaSession.setPositionState({duration:e,playbackRate:activePlayer.getPlaybackRate(),position:s})}catch(a){console.error("Erreur lors de la mise \xE0 jour de setPositionState:",a)}}function findItemById(e){return allSearchableItems[e]||null}function isMusicTitle(e){return e&&e.albumId&&e.year}function initUserData(){const e=localStorage.getItem("mmg-likedSongs");likedSongs=e?new Set(JSON.parse(e)):new Set;const s=localStorage.getItem("mmg-playlist");currentPlaylist=s?JSON.parse(s):[];const a=localStorage.getItem("mmg-sfxEnabled");sfxEnabled=a!==null?JSON.parse(a):!0,document.getElementById("sfx-switch").checked=sfxEnabled,currentLang=localStorage.getItem("mmg-lang")||"en",applyLanguage(currentLang);const o=localStorage.getItem("mmg-backgroundPlayEnabled");isBackgroundPlayEnabled=o!==null?JSON.parse(o):!0,document.getElementById("background-play-switch").checked=isBackgroundPlayEnabled;const c=localStorage.getItem("mmg-readUpdateIds");readUpdateIds=c?new Set(JSON.parse(c)):new Set;const r=localStorage.getItem("mmg-achievements"),l={loopMaster:{unlocked:!1,progress:{},goal:3,icon:"fa-sync-alt"},retroPlayer:{unlocked:!1,progress:[],goal:3,icon:"fa-gamepad"},patienceIsKey:{unlocked:!1,progress:0,goal:2,icon:"fa-hourglass-end"},psPlayer:{unlocked:!1,progress:[],goal:2,icon:"fab fa-playstation"}};achievements=r?JSON.parse(r):l,Object.keys(l).forEach(v=>{achievements[v]||(achievements[v]=l[v])});const u=localStorage.getItem("mmg-userCoins");userCoins=u?JSON.parse(u):0;const f=localStorage.getItem("mmg-unlockedTracks");unlockedTracks=f?JSON.parse(f):[],renderAchievements(),updateShopLocksAndSelection()}function updateCoinDisplay(){const e=document.getElementById("coin-count");e&&(e.textContent=userCoins)}function updateNotificationDot(){const e=document.querySelector(".notification-dot"),s=document.getElementById("mark-as-read-btn"),a=document.getElementById("unlock-notification-item");if(!e||!a||!s)return;const o=Object.values(allSearchableItems).filter(l=>l.isUnlockable).some(l=>!unlockedTracks.includes(l.id)),c=userCoins>=COIN_COST_UNLOCK&&o,r=siteData.updateLog&&siteData.updateLog.some(l=>!readUpdateIds.has(l.id));e.classList.toggle("hidden",!r),a.classList.toggle("hidden",!c),s.disabled=!r,document.querySelector(".update-log").classList.toggle("has-unread",r)}function updateAchievementProgress(e,s){if(achievements[e].unlocked)return;const a=achievements[e];let n=!1;e==="loopMaster"?(a.progress[s]=(a.progress[s]||0)+1,a.progress[s]>=a.goal&&unlockAchievement(e),n=!0):e==="retroPlayer"||e==="psPlayer"?a.progress.includes(s)||(a.progress.push(s),a.progress.length>=a.goal&&unlockAchievement(e),n=!0):e==="patienceIsKey"&&(a.progress++,a.progress>=a.goal&&unlockAchievement(e),n=!0),n&&(localStorage.setItem("mmg-achievements",JSON.stringify(achievements)),renderAchievements())}function unlockAchievement(e){achievements[e].unlocked||(achievements[e].unlocked=!0,localStorage.setItem("mmg-achievements",JSON.stringify(achievements)),playAudio(sounds.achievementUnlocked),showDialog(`${getTranslation("achievementUnlocked")}: ${getTranslation(`achievement_${e}_title`)}!`),renderAchievements(),updateShopLocksAndSelection())}function unlockAllAchievements(){Object.keys(achievements).forEach(e=>{achievements[e].unlocked||(achievements[e].unlocked=!0)}),localStorage.setItem("mmg-achievements",JSON.stringify(achievements)),renderAchievements(),updateShopLocksAndSelection()}function renderAchievements(){const e=document.getElementById("achievements-list");e&&(e.innerHTML="",Object.entries(achievements).forEach(([s,a])=>{let n=0;s==="loopMaster"?n=Math.max(0,...Object.values(a.progress).map(Number))/a.goal:s==="retroPlayer"||s==="psPlayer"?n=a.progress.length/a.goal:s==="patienceIsKey"&&(n=a.progress/a.goal),n=Math.min(1,n)*100;const o=a.icon.startsWith("fab")?`<i class="${a.icon}"></i>`:`<i class="fas ${a.icon}"></i>`,c=document.createElement("div");c.className=`achievement-item ${a.unlocked?"unlocked":""}`,c.innerHTML=`
                <div class="achievement-icon">${o}</div>
                <div class="achievement-details">
                    <h4>${getTranslation(`achievement_${s}_title`)}</h4>
                    <p>${getTranslation(`achievement_${s}_desc`)}</p>
                    ${a.unlocked?"":`
                    <div class="achievement-progress-bar">
                        <div class="achievement-progress-fill" style="width: ${n}%"></div>
                    </div>`}
                </div>
            `,e.appendChild(c)}))}function updateShopLocksAndSelection(){const e=localStorage.getItem("ui-theme")||"default",s=localStorage.getItem("bg-theme")||"default-bg";document.querySelectorAll(".theme-buy-btn").forEach(a=>{const n=a.dataset.achievement,o=a.dataset.theme;a.disabled=!1,n&&achievements[n]&&!achievements[n].unlocked?(a.classList.add("locked"),a.classList.remove("selected"),a.innerHTML=getTranslation("unlockWithLockIcon"),a.disabled=!0):(a.classList.remove("locked"),o===e||o===s?(a.innerHTML=`<i class="fas fa-check"></i> ${getTranslation("selected")}`,a.classList.add("selected"),a.disabled=!0):(a.innerHTML=getTranslation("select"),a.classList.remove("selected")))})}function toggleLike(e){playAudio(sounds.select),likedSongs.has(e)?likedSongs.delete(e):likedSongs.add(e),localStorage.setItem("mmg-likedSongs",JSON.stringify([...likedSongs])),updateLikeButtonUI(e);const s=document.querySelector(`.card[data-item-id="${e}"] .like-btn-card`);if(s){const a=likedSongs.has(e);s.classList.toggle("active",a),s.classList.toggle("fas",a),s.classList.toggle("far",!a)}document.getElementById("liked-titles-section").classList.contains("hidden")===!1&&handleMenuNavigation("liked-titles-section")}function updateLikeButtonUI(e){const s=document.getElementById("player-like-btn");if(!s||!currentPlayingItem||currentPlayingItem.id!==e)return;const a=likedSongs.has(e);s.classList.toggle("active",a),s.classList.toggle("fas",a),s.classList.toggle("far",!a)}function togglePlaylistItem(e){const s=currentPlaylist.indexOf(e);s>-1?(currentPlaylist.splice(s,1),showDialog(getTranslation("titleRemovedPlaylist")),playAudio(sounds.back)):(currentPlaylist.push(e),showDialog(getTranslation("titleAddedPlaylist")),playAudio(sounds.select)),localStorage.setItem("mmg-playlist",JSON.stringify(currentPlaylist)),renderPlaylist(),updateDetailsPlaylistButtonState(),updateCardPlaylistButtonState(e)}function renderPlaylist(){const e=document.getElementById("playlist-container");if(e){if(currentPlaylist.length===0){e.innerHTML=`<p>${getTranslation("playlistEmpty")}</p>`;return}e.innerHTML="",currentPlaylist.forEach((s,a)=>{const n=findItemById(s);if(!n)return;const o=currentPlayingItem&&currentPlayingItem.id===s,c=document.createElement("div");c.className=`playlist-item ${o?"currently-playing":""}`,c.dataset.index=a,c.dataset.itemId=s,c.draggable=!0,c.innerHTML=`
                <i class="fas fa-bars playlist-drag-handle"></i>
                <img src="${getCorrectImagePath(n)}" alt="${n.title}">
                <div class="playlist-item-info">
                    <p class="playlist-item-title">${n.title}</p>
                    <p>${n.year||"Vid\xE9o"}</p>
                </div>
                <button class="playlist-item-delete" title="${getTranslation("deleteFromPlaylist")}"><i class="fas fa-trash-alt"></i></button>
                ${o?'<span class="currently-playing-indicator"><i class="fas fa-volume-up"></i></span>':""}
            `,e.appendChild(c)})}}window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),deferredPrompt=e,console.log("`beforeinstallprompt` event was fired.")});function showPwaInstallPrompt(){const e=window.matchMedia("(display-mode: standalone)").matches;if(deferredPrompt&&!e){console.log("Showing PWA install prompt.");const s=document.getElementById("pwa-install-overlay");s&&s.classList.remove("hidden")}else console.log("PWA prompt not shown:",{deferredPrompt:!!deferredPrompt,isStandalone:e})}function playAudio(e,s=!1){!sfxEnabled&&!s||!e||(e.currentTime=0,e.play().catch(a=>{}))}function getTranslation(e,s={}){let a=translations[currentLang][e]||translations.en[e]||`[${e}]`;for(const n in s)a=a.replace(`{${n}}`,s[n]);return a}function applyLanguage(e){currentLang=e,localStorage.setItem("mmg-lang",e),document.querySelectorAll("[data-lang-key]").forEach(n=>{const o=n.dataset.langKey,c=getTranslation(o);n.placeholder?n.placeholder=c:n.textContent=c}),document.querySelectorAll("[data-lang-title]").forEach(n=>{const o=n.dataset.langTitle;n.title=getTranslation(o)}),document.querySelectorAll(".lang-btn").forEach(n=>{n.classList.toggle("active",n.dataset.lang===e)});const s=document.querySelector(".profile-tab.active")?.dataset.project;if(s){const n=document.getElementById("menu-cards-section");n&&!n.classList.contains("hidden")&&renderCards("content-cards",siteData.projectData[s],"menu")}if(currentPlayingItem?updateMp3PlayerInfo(currentPlayingItem):resetMiniPlayerUI(),currentViewContext.type){const n=document.querySelector(".profile-tab.active")?.dataset.project,o=siteData.contentData[n];switch(currentViewContext.type){case"titles":const c=Object.fromEntries(Object.entries(o.titles).filter(([r,l])=>l.albumId===currentViewContext.data));renderCards("titles-cards",c,"title");break;case"liked":handleMenuNavigation("liked-titles-section",!1);break;case"about":handleMenuNavigation("about-section",!1);break;case"search":updateVisibleCards(currentViewContext.data);break;case"albums":handleMenuNavigation("albums-section",!1);break}}const a=document.getElementById("achievements-overlay");a&&!a.classList.contains("hidden")&&updateAchievementsOverlayText()}function updateAchievementsOverlayText(){const e=document.getElementById("achievements-overlay");e&&(e.querySelectorAll("[data-lang-key]").forEach(s=>{const a=s.dataset.langKey,n=getTranslation(a);s.placeholder?s.placeholder=n:s.textContent=n}),renderAchievements())}function updateTime(){document.getElementById("real-time").textContent=new Date().toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})}function getCorrectImagePath(e){return!e||!e.image?"https://placehold.co/200x120/9E9E9E/FFFFFF?text=No+Image":(e.image.startsWith("assets/"),e.image)}function renderCards(e,s,a="generic"){const n=document.getElementById(e);if(!n)return;if(n.innerHTML="",n.style.display="",n.style.alignItems="",n.style.justifyContent="",n.style.height="",Object.keys(s).length===0){const u=e==="search-results-cards"||e==="liked-titles-cards"?"noResults":"workInProgress";n.style.display="flex",n.style.alignItems="center",n.style.justifyContent="center",n.style.height="100%",n.innerHTML=`<p style="font-size: 1.2em; opacity: 0.7; white-space: nowrap;">${getTranslation(u)}</p>`;return}let o=0;Object.entries(s).forEach(([r,l])=>{const u=document.createElement("div");u.className="card",u.style.animationDelay=`${o}s`,o+=.05;const f=l.id||r;u.dataset.itemId=f;const v=Object.values(allSearchableItems).filter(B=>B.albumId===l.id&&B.isUnlockable),A=v.filter(B=>unlockedTracks.includes(B.id));if(a==="album"&&l.isUnlockableAlbum&&A.length<v.length){u.classList.add("locked"),u.innerHTML=`
                  <a href="#" class="card-link-wrapper" data-unlock-album="${l.id}">
                    <div class="card-inner">
                      <div class="lock-overlay">
                        <i class="fas fa-lock"></i>
                        <span class="unlock-cost">${COIN_COST_UNLOCK}</span>
                      </div>
                      <div class="card__content">
                        <div class="card__image" style="background-image: url('${getCorrectImagePath(l)}');"></div>
                        <div class="card__text">
                          <p class="card__title">${l.title}</p>
                          <p class="card__description">${getTranslation("unlockATrack",{unlockedCount:A.length,totalCount:v.length})}</p>
                        </div>
                      </div>
                    </div>
                  </a>
                `,n.appendChild(u);return}const C=l.isUnlockable&&!unlockedTracks.includes(f);if(C&&a==="title"){u.classList.add("locked"),u.innerHTML=`
                  <a href="#" class="card-link-wrapper" data-youtube-id="${l.youtube_id}">
                    <div class="card-inner">
                      <div class="lock-overlay">
                        <i class="fas fa-lock"></i>
                        <span class="unlock-cost">${COIN_COST_UNLOCK} <i class="fas fa-coin"></i></span>
                      </div>
                      <div class="card__content">
                        <img class="card__image" loading="lazy" decoding="async" src="${getCorrectImagePath(l)}" alt="${l.title}">
                        <div class="card__text">
                          <p class="card__title">${l.title}</p>
                        </div>
                      </div>
                    </div>
                  </a>
                `,n.appendChild(u);return}let p="";a==="title"||a==="video"||a==="search"?p=`data-youtube-id="${l.youtube_id}"`:a==="album"?p=`data-album-id="${l.id}"`:a==="menu"&&(p=`data-link="${l.link}"`);const w=getCorrectImagePath(l),I=l.loopable?'<div class="card__badge">LOOP ME!</div>':"";let $,x;const R=document.querySelector(".profile-tab.active")?.dataset.project,L=l.langKey?getTranslation(l.langKey):l.title;if(a==="menu"){const S={albums:{icon:"fa-record-vinyl",bg:"bg-albums"},videoClips:{icon:"fa-camera",bg:"bg-clips"},makingOfs:{icon:"fa-lightbulb",bg:"bg-makingofs"},likedTitles:{icon:"fa-heart",bg:"bg-liked"},albumsBeats:{icon:"fa-compact-disc",bg:"bg-albums-beats"},videosBeats:{icon:"fa-video",bg:"bg-videos-beats"}}[l.langKey];S?($=`<div class="card__image card-icon-bg ${S.bg}"><i class="fas ${S.icon}"></i></div>`,x=`<p class="card__title">${L}</p>`):($=`<img class="card__image" loading="lazy" decoding="async" src="${getCorrectImagePath(l)}" alt="${L}">`,x=`<p class="card__title">${L}</p>`)}else{$=`
                    <img 
                        class="card__image" 
                        loading="lazy" 
                        decoding="async"
                        src="${w}"
                        alt="${L}"
                    >
                `;const B=likedSongs.has(f),S=currentPlaylist.includes(f),q=a==="title"||a==="video"||a==="search"&&!l.type?`<div class="card-actions">
                         <i class="like-btn-card ${B?"fas":"far"} fa-heart ${B?"active":""}" data-like-id="${f}" title="Aimer"></i>
                         <i class="fas ${S?"fa-check":"fa-plus"} add-playlist-btn-card ${S?"added":""}" data-playlist-id="${f}" title="${S?"Retirer de la playlist":"Ajouter \xE0 la playlist"}"></i>
                       </div>`:"";let E="";if(a!=="menu")switch(a){case"title":E=getTranslation(`desc_${l.id}`)||l.description||getTranslation("listenToTitle");break;case"album":const M=Object.values(allSearchableItems).filter(O=>O.albumId===l.id&&O.isUnlockable);if(M.length>0){const O=M.filter(t=>unlockedTracks.includes(t.id)),D=M.length-O.length;D>0&&(E=getTranslation(D===1?"trackToUnlock_one":"trackToUnlock_many",{count:D}))}break;case"video":E="";break;case"search":E=l.type==="album"?getTranslation("viewAlbum"):l.year?getTranslation("musicTitle"):getTranslation("videoOrMakingOf");break;default:E=getTranslation("viewContent")}E.length>50&&(E=E.substring(0,47)+"...");const j=C&&a!=="title"?' <i class="fas fa-lock" style="font-size: 0.8em; opacity: 0.7;"></i>':"";x=`
                    <p class="card__title" title="${L.replace(/"/g,"&quot;")}"><span>${L}${j}</span></p>
                    ${E?`<p class="card__description">${E}</p>`:""}
                    ${q}
                `}u.innerHTML=`
              <a href="#" class="card-link-wrapper" ${p}>
                <div class="card-inner">
                  <div class="card__content">
                    ${I}
                    ${$}
                    <div class="card__text">
                      ${x}
                    </div>
                  </div>
                </div>
              </a>
            `,n.appendChild(u)}),["title","video","search","album"].includes(a)&&setupTitleScrollObserver(`#${e}`)}function updateCardPlaylistButtonState(e){const s=document.querySelectorAll(`.card[data-item-id="${e}"] .add-playlist-btn-card`);if(s.length===0)return;const a=currentPlaylist.includes(e);s.forEach(n=>{n.classList.toggle("fa-check",a),n.classList.toggle("fa-plus",!a),n.classList.toggle("added",a),n.title=getTranslation(a?"removePlaylist":"addPlaylist")})}function updateDetailsPlaylistButtonState(){const e=document.getElementById("music-title-details-section"),s=document.getElementById("details-add-to-playlist-btn");if(!e||!s)return;const a=e.dataset.currentItemId;if(!a)return;currentPlaylist.includes(a)?(s.innerHTML=`<i class="fas fa-check"></i> <span data-lang-key="addedToPlaylist">${getTranslation("addedToPlaylist")}</span>`,s.classList.add("added")):(s.innerHTML=`<i class="fas fa-plus"></i> <span data-lang-key="addToPlaylist">${getTranslation("addToPlaylist")}</span>`,s.classList.remove("added"))}function renderMusicTitleDetails(e){document.getElementById("music-title-details-section").dataset.currentItemId=e.id;const s=document.querySelector(".profile-tab.active")?.dataset.project||"mmg-music",a=siteData.contentData[s].albums[e.albumId];document.getElementById("details-album-art").src=getCorrectImagePath(e),document.getElementById("details-title").textContent=e.title;const n=document.getElementById("details-album");n.textContent=a?a.title:getTranslation("unknown"),n.parentElement.dataset.albumId=e.albumId;const o=document.getElementById("details-year");o.textContent=e.year||getTranslation("unknown"),o.parentElement.dataset.year=e.year||"",document.getElementById("details-description").textContent=getTranslation(`desc_${e.id}`)||e.description,document.getElementById("details-tags").innerHTML=(e.tags||[]).map(r=>`<span class="tag-item" data-action="filter-tag" data-tag="${r}">${r}</span>`).join("");const c=document.getElementById("streaming-links");if(c.innerHTML="",e.streaming){const r={spotify:{icon:"fab fa-spotify",base_url:"https://open.spotify.com/album/"},appleMusic:{icon:"fab fa-apple",base_url:"https://music.apple.com/fr/album/"},youtube:{icon:"fab fa-youtube",base_url:"https://www.youtube.com/watch?v="},deezer:{icon:"fab fa-deezer",base_url:"https://www.deezer.com/album/"},amazonMusic:{icon:"fab fa-amazon",base_url:"https://amazon.fr/music/player/albums/"},tidal:{icon:"fas fa-record-vinyl",base_url:"https://tidal.com/browse/album/"}};for(const[l,u]of Object.entries(e.streaming))if(r[l]&&u&&u.trim()!==""){const f=document.createElement("a");f.href=r[l].base_url+u,f.target="_blank",f.title=`\xC9couter sur ${l.charAt(0).toUpperCase()+l.slice(1)}`,f.innerHTML=`<i class="${r[l].icon}"></i>`,c.appendChild(f)}}renderAssociatedVideos(e),updateTempPlayButtonVisibility(),updateDetailsPlaylistButtonState()}function renderAssociatedVideos(e){const s=document.querySelector(".profile-tab.active")?.dataset.project,a=document.getElementById("gameplay-video-container"),n=document.getElementById("makingof-video-container");a.innerHTML=`<h4 data-lang-key="gameplayVideo">${getTranslation("gameplayVideo")}</h4>`,n.innerHTML=`<h4 data-lang-key="makingOfVideo">${getTranslation("makingOfVideo")}</h4>`;const o=l=>{const u=document.createElement("div");return u.className="associated-video-card card-link-wrapper",u.dataset.youtubeId=l.youtube_id,u.dataset.itemId=l.id,u.innerHTML=`
                <img src="${getCorrectImagePath(l)}" alt="${l.title}" onerror="this.src='https://placehold.co/100x56/000/fff?text=Error';">
                <p>${l.title}</p>
            `,u};let c=!1,r=!1;e.associatedVideos&&e.associatedVideos.length>0&&e.associatedVideos.forEach(l=>{const u=findItemById(l);u&&(siteData.contentData[s].gameplay[l]?(a.appendChild(o(u)),c=!0):siteData.contentData[s].makingofs[l]&&(n.appendChild(o(u)),r=!0))}),c||(a.innerHTML+=`<p>${getTranslation("noAssociatedVideo")}</p>`),r||(n.innerHTML+=`<p>${getTranslation("noAssociatedVideo")}</p>`)}function renderVideoSuggestions(){const e=document.querySelector(".profile-tab.active")?.dataset.project||"mmg-music",s={...siteData.contentData[e].titles,...siteData.contentData[e].gameplay},a=Object.values(s).filter(n=>n.id!==currentPlayingItem?.id).sort(()=>.5-Math.random()).slice(0,4);renderCards("suggestions-cards",a,"video")}function updateMp3PlayerInfo(e){if(e&&e.title){document.getElementById("song-title").textContent=e.title;const s=isMusicTitle(e)?getCorrectImagePath(e):`https://img.youtube.com/vi/${e.youtube_id}/mqdefault.jpg`;document.getElementById("player-album-cover").src=s||"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='70' height='70'%3E%3C/svg%3E",updateLikeButtonUI(e.id)}}function resetMiniPlayerUI(){document.getElementById("progress-fill").style.width="0%",document.getElementById("song-title").textContent=getTranslation("noTrackPlaying"),document.getElementById("player-album-cover").src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='70' height='70'%3E%3C/svg%3E"}function updateProgressBar(){if(!activePlayer||typeof activePlayer.getDuration!="function"||!currentPlayingItem)return;const e=activePlayer.getDuration();if(e>0){const s=activePlayer.getCurrentTime();if(listenProgress=s/e,document.getElementById("progress-fill").style.width=`${listenProgress*100}%`,document.getElementById("current-time-display").textContent=formatTime(s),document.getElementById("duration-display").textContent=formatTime(e),previousListenProgress>0){const a=listenProgress-previousListenProgress,n=2/e;e>2&&Math.abs(a)>n&&(seekDetectedInCurrentPlay=!0)}previousListenProgress=listenProgress}updateMediaPositionState()}function formatTime(e){const s=Math.floor(e/60),a=Math.floor(e%60);return`${s}:${a.toString().padStart(2,"0")}`}function scaleToShowSection(e){const a=document.querySelector(".content-section-board").querySelector(".page-section:not(.hidden)"),n=document.getElementById(e);if(!n||a&&a.id===e)return;const o=400;a&&a.classList.add("is-scaling-out"),n.style.animation="scale-in-fade 0.4s ease-out forwards",setTimeout(()=>{a&&(a.classList.add("hidden"),a.classList.remove("is-scaling-out")),n.classList.remove("hidden"),(!history.state||history.state.section!==e)&&history.pushState({section:e,fromApp:!0},"","#"+e)},o)}function showSection(e,s=!0){const n=document.querySelector(".content-section-board").querySelector(".page-section:not(.hidden)"),o=document.getElementById(e);if(!o||n&&n.id===e)return;const c=300,r=()=>{document.querySelectorAll(".content-section-board .page-section").forEach(l=>{l.classList.add("hidden"),l.classList.remove("is-hiding")}),o.classList.remove("hidden"),s&&(!history.state||history.state.section!==e)&&history.pushState({section:e,fromApp:!0},"","#"+e)};n?(n.classList.add("is-hiding"),setTimeout(r,c)):r(),updateTempPlayButtonVisibility()}function updateTempPlayButtonVisibility(){const e=document.getElementById("temp-play-btn");if(!e)return;const s=!document.getElementById("music-title-details-section").classList.contains("hidden");!isAutoplayActive&&s?e.classList.remove("hidden"):e.classList.add("hidden")}function updateVisibleCards(e=null){const s=document.getElementById("search-input").value.toLowerCase().trim(),a=Array.from(document.querySelectorAll("#tags-filter-list input:checked")).map(r=>r.value);if(s===""&&a.length===0){document.getElementById("tags-filter-overlay").classList.contains("hidden")&&document.getElementById("search-results-section").classList.contains("hidden")===!1&&resetToHome();return}const n=Object.fromEntries(Object.entries(allSearchableItems).filter(([r,l])=>{const u=l.title.toLowerCase().includes(s),f=(l.tags||[]).some(p=>p.toLowerCase().includes(s));let v=!1;l.albumId&&siteData.contentData["mmg-music"].albums[l.albumId]&&(v=siteData.contentData["mmg-music"].albums[l.albumId].title.toLowerCase().includes(s));const A=(l.tags||[]).map(p=>p.toLowerCase()),C=a.length===0||a.every(p=>A.includes(p));return(u||f||v)&&C})),o=currentPlayingItem&&activePlayer&&typeof activePlayer.getPlayerState=="function"&&(activePlayer.getPlayerState()===YT.PlayerState.PLAYING||activePlayer.getPlayerState()===YT.PlayerState.PAUSED),c=typeof e=="string"&&e?e:getTranslation("searchResults");document.getElementById("search-results-title").textContent=c,currentViewContext={type:"search",data:e},showSection("search-results-section",!0,!1),renderCards("search-results-cards",n,"search")}function setupTagFilters(){const e=new Set(["snow","western","desert","dream"]),s=new Set(Object.values(allSearchableItems).flatMap(n=>n.tags||[]).filter(n=>!e.has(n))),a=document.getElementById("tags-filter-list");a.innerHTML="",Array.from(s).sort().forEach(n=>{const o=`tag-${n.toLowerCase().replace(/\s/g,"-")}`,c=document.createElement("div");c.className="tag-filter-item",c.innerHTML=`<input type="checkbox" id="${o}" value="${n.toLowerCase()}"><label for="${o}">${n}</label>`,a.appendChild(c)})}function showDialog(e){const s=document.getElementById("custom-dialog");s.querySelector("p").textContent=e,s.classList.remove("hidden"),setTimeout(()=>s.classList.add("hidden"),2500)}function applyTheme(e){if(e.startsWith("theme-bg-")||e==="default-bg")document.body.classList.remove("theme-bg-waves","theme-bg-sine-waves"),stopWavesBackground(),e==="theme-bg-sine-waves"?(startWavesBackground(),document.body.classList.add(e),window.innerWidth>952?(startWavesBackground(),document.body.classList.add(e)):document.body.classList.add("theme-bg-sine-waves")):e==="theme-bg-waves"&&document.body.classList.add(e),localStorage.setItem("bg-theme",e);else{const a=localStorage.getItem("bg-theme")||"default-bg";document.body.className="",a!=="default"&&document.body.classList.add(a),e&&e!=="default"&&document.body.classList.add(e),localStorage.setItem("ui-theme",e)}localStorage.getItem("theme")==="dark"&&document.body.classList.add("dark-theme"),document.body.classList.contains("tutorial-active-body")&&document.body.classList.add("tutorial-active-body"),updateShopLocksAndSelection()}function resetToHome(){playAudio(sounds.select),showSection("menu-cards-section");const e=document.querySelector(".profile-tab.active").dataset.project;renderCards("content-cards",siteData.projectData[e],"menu")}function setVolume(e,s=!1){currentVolume=Math.max(0,Math.min(100,e)),document.querySelectorAll("#volume-level-display").forEach(n=>n.textContent=currentVolume);const a=currentVolume/100;largePlayer?.setVolume&&largePlayer.setVolume(currentVolume),mediumPlayer?.setVolume&&mediumPlayer.setVolume(currentVolume),Object.values(sounds).forEach(n=>{n&&(n.volume=a)}),s&&playAudio(sounds.hover)}function checkTitleOverflow(e){const s=e.querySelector("span");s&&(e.classList.remove("scrolling"),e.style.setProperty("--overflow-width","0px"),e.style.setProperty("--scroll-duration","0s"),requestAnimationFrame(()=>{if(s.scrollWidth>e.clientWidth+1){const n=s.scrollWidth-e.clientWidth,o=Math.max(3,n/40+1);e.style.setProperty("--overflow-width",`-${n+10}px`),e.style.setProperty("--scroll-duration",`${o}s`),e.classList.add("scrolling")}}))}function setupTitleScrollObserver(e){const s={root:document.querySelector(".content-section-board"),rootMargin:"0px",threshold:.8};titleScrollObserver&&titleScrollObserver.disconnect(),titleScrollObserver=new IntersectionObserver((n,o)=>{n.forEach(c=>{c.isIntersecting?checkTitleOverflow(c.target):c.target.classList.remove("scrolling")})},s),titleResizeObserver&&titleResizeObserver.disconnect(),titleResizeObserver=new ResizeObserver(n=>{for(let o of n)checkTitleOverflow(o.target)}),document.querySelectorAll(`${e} .card__title`).forEach(n=>{titleScrollObserver.observe(n),titleResizeObserver.observe(n)})}function initializeApp(){document.body.style.cursor="",initUserData(),resetMiniPlayerUI(),setupTagFilters(),renderUpdateLog(),updateTime(),setInterval(updateTime,3e4);const e=localStorage.getItem("theme")||"light",s=localStorage.getItem("ui-theme")||"default";document.getElementById("theme-switch").checked=e==="dark",document.body.classList.toggle("dark-theme",e==="dark"),applyTheme(s),setVolume(100),setupEventListeners();const a=window.location.hash.substring(1);let n="menu-cards-section";a&&document.getElementById(a)&&(n=a),history.replaceState({section:"menu-cards-section",fromApp:!0,isTrap:!0},"","#menu-cards-section"),history.pushState({section:"menu-cards-section",fromApp:!0},"","#menu-cards-section"),n!=="menu-cards-section"&&history.pushState({section:n,fromApp:!0},"","#"+n),updateNotificationDot(),handleMenuNavigation(n,!1),"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.addEventListener("message",o=>{if(o.data&&o.data.action)switch(console.log(`Action received from SW: ${o.data.action}`),o.data.action){case"play":activePlayer&&activePlayer.playVideo();break;case"pause":activePlayer&&activePlayer.pauseVideo();break;case"nexttrack":playNextTrack(1,!0);break;case"previoustrack":playNextTrack(-1,!0);break;case"stop":activePlayer&&activePlayer.stopVideo()}})})}const playNextTrack=(e=1,s=!1)=>{s||playAudio(sounds.select);let a,n,o;const r=document.getElementById("music-title-details-section").dataset.currentItemId;if(activePlaybackQueue.length>0)n=activePlaybackQueue,o=n.findIndex(f=>f===r),o===-1&&(o=currentQueueIndex);else if(currentNavigationContext&&currentNavigationContext.playlist.length>0)n=currentNavigationContext.playlist,o=n.findIndex(f=>f===r);else{renderVideoSuggestions(),showSection("video-suggestions-section",!0,!0);return}if(o===-1||n.length===0)return;let l;if(isShuffleMode&&(s||isAutoplayActive)){let f;do f=Math.floor(Math.random()*n.length);while(n.length>1&&f===o);l=f}else l=(o+e+n.length)%n.length;const u=n[l];a=findItemById(u),a&&(isAutoplayActive||s?playVideoWhenReady(a,n,l):(renderMusicTitleDetails(a),showSection("music-title-details-section")))};function setupEventListeners(){document.querySelector(".back-btn").addEventListener("click",t=>{if(t.preventDefault(),playAudio(sounds.back),isTutorialActive)return;const i=document.getElementById("menu-cards-section");i&&!i.classList.contains("hidden")||window.history.back()}),document.getElementById("home-btn").addEventListener("click",t=>{t.preventDefault(),resetToHome()}),window.addEventListener("popstate",t=>{if(t.state&&t.state.isTrap){history.forward();return}const i=t.state?t.state.section:"menu-cards-section";handleMenuNavigation(i,!1)}),document.querySelectorAll(".profile-tab").forEach(t=>{t.addEventListener("click",()=>{document.querySelectorAll(".profile-tab").forEach(i=>i.classList.remove("active")),t.classList.add("active"),resetToHome()})});const e=document.querySelector(".main-board");e.addEventListener("click",t=>{const i=t.target.closest(".top-bar-btn, .player-buttons > i, .controls-box, .player-right-controls > i");i&&(i.classList.remove("icon-pop"),i.offsetWidth,i.classList.add("icon-pop"));const d=t.target.closest(".like-btn-card");if(d){t.preventDefault(),t.stopPropagation(),toggleLike(d.dataset.likeId);return}const g=t.target.closest(".add-playlist-btn-card");if(g){t.preventDefault(),t.stopPropagation(),togglePlaylistItem(g.dataset.playlistId);return}if(t.target.closest("#details-add-to-playlist-btn")){t.preventDefault(),t.stopPropagation();const y=document.getElementById("music-title-details-section").dataset.currentItemId;y&&togglePlaylistItem(y);return}const h=t.target.closest('[data-action="filter-tag"]');if(h){t.preventDefault(),t.stopPropagation();const y=h.dataset.tag;document.getElementById("search-input").value="",document.querySelectorAll("#tags-filter-list input").forEach(b=>b.checked=!1);const k=document.querySelector(`#tags-filter-list input[value="${y.toLowerCase()}"]`);k&&(k.checked=!0),updateVisibleCards();return}const _=t.target.closest("#details-year-link");if(_){t.preventDefault(),t.stopPropagation();const y=_.dataset.year;if(y){playAudio(sounds.select),document.getElementById("search-input").value="",document.querySelectorAll("#tags-filter-list input").forEach(b=>b.checked=!1);const k=Object.fromEntries(Object.entries(allSearchableItems).filter(([b,T])=>T.year===y));document.getElementById("search-results-title").textContent=y,renderCards("search-results-cards",k,"search"),showSection("search-results-section")}}const U=t.target.closest(".associated-video-card");if(U){t.preventDefault();const y=U.dataset.itemId,k=findItemById(y);k&&(playAudio(sounds.select),playVideoWhenReady(k));return}const V=t.target.closest("a.card-link-wrapper");if(!V)return;t.preventDefault();const{youtubeId:H,link:Y,albumId:N,unlockAlbum:z}=V.dataset,J=V.closest(".card"),W=J.dataset.itemId;if(z){if(userCoins>=COIN_COST_UNLOCK){const k=Object.values(allSearchableItems).filter(b=>b.albumId===z&&b.isUnlockable).find(b=>!unlockedTracks.includes(b.id));k?(userCoins-=COIN_COST_UNLOCK,unlockedTracks.push(k.id),localStorage.setItem("mmg-userCoins",JSON.stringify(userCoins)),localStorage.setItem("mmg-unlockedTracks",JSON.stringify(unlockedTracks)),updateCoinDisplay(),showDialog(`${getTranslation("youUnlocked")} "${k.title}"!`),handleMenuNavigation("albums-section")):showDialog(getTranslation("allTracksUnlocked"))}else showDialog(getTranslation("needCoinsToUnlock",{COIN_COST_UNLOCK})),playAudio(sounds.blocked);return}if(H){const y=findItemById(W);if(!y)return;if(y.isUnlockable&&!unlockedTracks.includes(y.id)){showDialog(getTranslation("trackLocked")),playAudio(sounds.blocked);return}const k=document.querySelector(".profile-tab.active")?.dataset.project;let b=[],T=-1;if(isMusicTitle(y)&&y.albumId)b=Object.values(siteData.contentData[k].titles).filter(P=>P.albumId===y.albumId).filter(P=>!P.isUnlockable||unlockedTracks.includes(P.id)).map(P=>P.id),T=b.findIndex(P=>P===y.id);else{const K=J.parentElement;K&&(b=Array.from(K.querySelectorAll(".card:not(.locked)")).map(F=>F.dataset.itemId).filter(Boolean),T=b.findIndex(F=>F===y.id))}currentNavigationContext={playlist:b,index:T},isBackgroundPlayEnabled&&sounds.keepAlive&&sounds.keepAlive.play().catch(K=>console.log("Keep-alive audio failed to play on user tap.")),playAudio(sounds.select),isMusicTitle(y)?(renderMusicTitleDetails(y),scaleToShowSection("music-title-details-section"),isAutoplayActive&&playVideoWhenReady(y,b,T)):playVideoWhenReady(y,b,T)}else if(Y)playAudio(sounds.select),handleMenuNavigation(Y);else if(N){playAudio(sounds.select);const y=document.querySelector(".profile-tab.active")?.dataset.project,k=Object.fromEntries(Object.entries(siteData.contentData[y].titles).filter(([b,T])=>T.albumId===N));document.getElementById("titles-section-title").textContent=siteData.contentData[y].albums[N].title,currentViewContext={type:"titles",data:N},renderCards("titles-cards",k,"title"),showSection("titles-section")}}),e.addEventListener("mousedown",t=>{const i=t.target.closest(".card");if(i){const d=i.querySelector(".card__title.scrolling > span");d&&(d.style.animationPlayState="paused")}}),e.addEventListener("touchstart",t=>{const i=t.target.closest(".card");if(i){const d=i.querySelector(".card__title.scrolling > span");d&&(d.style.animationPlayState="paused")}},{passive:!0});const s=()=>{document.querySelectorAll('.card__title.scrolling > span[style*="animation-play-state: paused"]').forEach(t=>{t.style.animationPlayState="running"})};window.addEventListener("mouseup",s),window.addEventListener("touchend",s),document.getElementById("details-album-link").addEventListener("click",t=>{t.preventDefault();const i=t.currentTarget.dataset.albumId;if(i){playAudio(sounds.select);const d=document.querySelector(".profile-tab.active")?.dataset.project,g=Object.fromEntries(Object.entries(siteData.contentData[d].titles).filter(([m,h])=>h.albumId===i));document.getElementById("titles-section-title").textContent=siteData.contentData[d].albums[i].title,currentViewContext={type:"titles",data:i},renderCards("titles-cards",g,"title"),showSection("titles-section")}});const a=document.getElementById("artwork-overlay");document.getElementById("details-album-art").addEventListener("click",t=>{document.getElementById("artwork-overlay-img").src=t.target.src,a.classList.remove("hidden")}),a.addEventListener("click",t=>{t.target.id==="artwork-overlay"&&a.classList.add("hidden")}),document.getElementById("player-album-cover").addEventListener("click",()=>{if(currentPlayingItem){playAudio(sounds.select);const t=isMusicTitle(currentPlayingItem)?"music-title-details-section":"large-player-section";showSection(t),isMusicTitle(currentPlayingItem)&&renderMusicTitleDetails(currentPlayingItem)}}),document.getElementById("search-input").addEventListener("input",updateVisibleCards),document.getElementById("tags-filter-list").addEventListener("change",updateVisibleCards),document.getElementById("theme-switch").addEventListener("change",t=>{document.body.classList.toggle("dark-theme",t.target.checked),playAudio(t.target.checked?sounds.switchToBlack:sounds.switchToWhite),localStorage.setItem("theme",t.target.checked?"dark":"light"),applyTheme(localStorage.getItem("ui-theme")||"default")}),document.getElementById("sfx-switch").addEventListener("change",t=>{sfxEnabled=t.target.checked,localStorage.setItem("mmg-sfxEnabled",JSON.stringify(sfxEnabled))}),document.querySelectorAll(".lang-btn").forEach(t=>{t.addEventListener("click",i=>{applyLanguage(i.target.dataset.lang),playAudio(sounds.select)})}),document.getElementById("background-play-switch").addEventListener("change",t=>{isBackgroundPlayEnabled=t.target.checked,localStorage.setItem("mmg-backgroundPlayEnabled",JSON.stringify(isBackgroundPlayEnabled))}),document.getElementById("play-pause-box").addEventListener("click",()=>{if(!activePlayer||!currentPlayingItem){if(currentPlaylist.length>0){const i=findItemById(currentPlaylist[0]);i&&playVideoWhenReady(i,currentPlaylist,0,!0)}return}playAudio(sounds.select),activePlayer.getPlayerState()===YT.PlayerState.PLAYING?activePlayer.pauseVideo():activePlayer.playVideo()}),document.getElementById("next-video-btn").addEventListener("click",()=>playNextTrack(1,isAutoplayActive)),document.getElementById("prev-video-btn").addEventListener("click",()=>playNextTrack(-1,isAutoplayActive)),document.getElementById("loop-btn").addEventListener("click",t=>{isPlayerLooping=!isPlayerLooping,t.currentTarget.classList.toggle("active",isPlayerLooping),playAudio(sounds.select),isPlayerLooping&&(isShuffleMode=!1,document.getElementById("shuffle-btn").classList.remove("active"))}),document.getElementById("shuffle-btn").addEventListener("click",t=>{isShuffleMode=!isShuffleMode,t.currentTarget.classList.toggle("active",isShuffleMode),playAudio(sounds.select),isShuffleMode&&(isPlayerLooping=!1,document.getElementById("loop-btn").classList.remove("active"))});const n=t=>{isAutoplayActive=!isAutoplayActive,document.querySelectorAll("#autoplay-toggle, #overlay-autoplay-toggle").forEach(d=>{d.classList.toggle("active",isAutoplayActive),d.title=getTranslation(isAutoplayActive?"autoplayOn":"autoplayOff")}),showDialog(getTranslation(isAutoplayActive?"autoplayOn":"autoplayOff")),playAudio(sounds.select),isAutoplayActive&&activePlayer&&typeof activePlayer.getPlayerState=="function"&&activePlayer.getPlayerState()===YT.PlayerState.ENDED&&playNextTrack(),updateTempPlayButtonVisibility()};document.getElementById("autoplay-toggle").addEventListener("click",n),document.getElementById("overlay-autoplay-toggle").addEventListener("click",n);const o=async()=>{if(!currentPlayingItem)return;const t={title:`MMGEAR - ${currentPlayingItem.title}`,text:`\xC9coute "${currentPlayingItem.title}" sur la MMGEAR !`,url:window.location.href};if(navigator.share)try{await navigator.share(t)}catch(i){console.error("Erreur de partage:",i)}else navigator.clipboard.writeText(`https://www.youtube.com/watch?v=${currentPlayingItem.youtube_id}`).then(()=>showDialog(getTranslation("linkCopied"))).catch(i=>showDialog(getTranslation("copyFailed")))};document.getElementById("share-btn").addEventListener("click",o),document.getElementById("overlay-share-btn").addEventListener("click",o),document.getElementById("player-like-btn").addEventListener("click",t=>{currentPlayingItem&&toggleLike(currentPlayingItem.id)}),document.getElementById("progress-bar").addEventListener("click",t=>{if(activePlayer&&typeof activePlayer.getDuration=="function"){const i=t.currentTarget.getBoundingClientRect();activePlayer.seekTo((t.clientX-i.left)/i.width*activePlayer.getDuration(),!0),seekDetectedInCurrentPlay=!0}}),document.getElementById("volume-up-btn").addEventListener("click",()=>setVolume(currentVolume+10,!0)),document.getElementById("volume-down-btn").addEventListener("click",()=>setVolume(currentVolume-10,!0)),document.getElementById("temp-play-btn").addEventListener("click",()=>{const i=document.getElementById("music-title-details-section").dataset.currentItemId;if(i){const d=findItemById(i);d&&(playAudio(sounds.select),playVideoWhenReady(d,[],-1,!1,!0))}});const c=document.querySelectorAll("#settings-overlay, #shop-overlay, #wifi-overlay, #achievements-overlay, #tags-filter-overlay, #playlist-overlay, #player-options-overlay, #tutorial-overlay, #notifications-overlay");let r=null;function l(t,i,d=!1){if(r!==t){if(d||(pausedForOverlay=activePlayer&&typeof activePlayer.getPlayerState=="function"&&activePlayer.getPlayerState()===YT.PlayerState.PLAYING,pausedForOverlay&&activePlayer.pauseVideo(),document.getElementById("background-music").pause()),r&&r.classList.add("hidden"),r=t,r.classList.remove("hidden"),i&&playAudio(i),t.id==="player-options-overlay"){const g=document.querySelector(".player-right-controls .volume-control-new"),m=document.getElementById("overlay-volume-container");g&&m&&m.appendChild(g)}t.id==="playlist-overlay"&&renderPlaylist(),t.id==="wifi-overlay"&&(playAudio(sounds.connecting,!0),sounds.connecting.onended=()=>{r&&r.id==="wifi-overlay"&&(u(sounds.back),updateAchievementProgress("patienceIsKey"),showDialog(getTranslation("connectionSuccess")))})}}function u(t){if(!r)return;const i=r.id==="player-options-overlay",d=r.id==="tags-filter-overlay"||r.id==="tutorial-overlay"&&!isTutorialActive;if(i){const g=document.querySelector("#overlay-volume-container .volume-control-new"),m=document.querySelector(".player-right-controls");g&&m&&m.insertBefore(g,document.getElementById("player-like-btn"))}r.id==="shop-overlay"&&sounds.shop&&(sounds.shop.pause(),sounds.shop.currentTime=0),r.id==="wifi-overlay"&&sounds.connecting&&(sounds.connecting.pause(),sounds.connecting.currentTime=0,sounds.connecting.onended=null),r.classList.add("hidden"),r=null,t&&playAudio(t),d||(pausedForOverlay?activePlayer&&(isResumingFromOverlay=!0,activePlayer.playVideo()):document.getElementById("background-music-switch").checked&&(!currentPlayingItem||activePlayer&&typeof activePlayer.getPlayerState=="function"&&activePlayer.getPlayerState()!==1)&&document.getElementById("background-music").play()),pausedForOverlay=!1}document.getElementById("settings-btn").addEventListener("click",t=>{t.preventDefault(),l(document.getElementById("settings-overlay"),sounds.select,!0)}),document.getElementById("shop-btn").addEventListener("click",t=>{t.preventDefault(),l(document.getElementById("shop-overlay"),sounds.shop)}),document.getElementById("wifi-btn").addEventListener("click",t=>{t.preventDefault(),l(document.getElementById("wifi-overlay"),null)}),document.getElementById("achievements-btn").addEventListener("click",t=>{t.preventDefault(),l(document.getElementById("achievements-overlay"),sounds.select)}),document.getElementById("tags-filter-btn").addEventListener("click",t=>{t.preventDefault(),l(document.getElementById("tags-filter-overlay"),sounds.select,!0)}),document.getElementById("playlist-btn").addEventListener("click",t=>{t.preventDefault(),l(document.getElementById("playlist-overlay"),sounds.select,!0)}),document.getElementById("player-more-options-btn").addEventListener("click",t=>{t.preventDefault(),l(document.getElementById("player-options-overlay"),sounds.select,!0)}),document.getElementById("notifications-btn").addEventListener("click",t=>{t.preventDefault(),l(document.getElementById("notifications-overlay"),sounds.select,!0)}),document.getElementById("mark-as-read-btn").addEventListener("click",()=>{playAudio(sounds.select),siteData.updateLog&&siteData.updateLog.length>0&&(siteData.updateLog.forEach(t=>readUpdateIds.add(t.id)),localStorage.setItem("mmg-readUpdateIds",JSON.stringify([...readUpdateIds]))),updateNotificationDot(),renderUpdateLog()}),c.forEach(t=>{t.addEventListener("click",i=>{if(i.target===t){if(t.id==="tutorial-overlay"&&isTutorialActive)return;u(sounds.back)}}),t.querySelector(".close-btn")?.addEventListener("click",()=>{t.id==="tutorial-overlay"?S():u(sounds.back)})}),document.querySelectorAll(".theme-buy-btn").forEach(t=>{t.addEventListener("click",i=>{i.target.classList.contains("locked")||i.target.classList.contains("selected")||(applyTheme(i.target.dataset.theme),playAudio(sounds.select))})}),document.getElementById("cheat-code-btn").addEventListener("click",()=>{const t=document.getElementById("cheat-code-input"),i=t.value.toLowerCase();if(i==="gameshark")unlockAllAchievements(),t.value="",showDialog(getTranslation("allAchievementsUnlocked")),playAudio(sounds.achievementUnlocked);else if(i==="musicleaks"){const d=Object.values(allSearchableItems).filter(g=>g.isUnlockable);unlockedTracks=d.map(g=>g.id),localStorage.setItem("mmg-unlockedTracks",JSON.stringify(unlockedTracks)),t.value="",showDialog(getTranslation("allSongsUnlocked")),playAudio(sounds.achievementUnlocked),document.getElementById("albums-section").classList.contains("hidden")===!1&&handleMenuNavigation("albums-section")}else showDialog(getTranslation("incorrectCode")),playAudio(sounds.blocked)}),document.getElementById("background-music-switch").addEventListener("change",t=>{const i=activePlayer&&typeof activePlayer.getPlayerState=="function"?activePlayer.getPlayerState():-1;t.target.checked&&i!==YT.PlayerState.PLAYING?document.getElementById("background-music").play():document.getElementById("background-music").pause()});let f=null;const v=document.getElementById("playlist-container"),A=".card, .profile-tab, .top-bar-btn, #start-music-btn, #mp3-player-container i, .volume-adjust-btn, .guide-choice-btn";document.body.addEventListener("mouseenter",t=>{t.target.closest(A)&&playAudio(sounds.hover)},!0),document.body.addEventListener("mouseleave",t=>{const i=t.target.closest(A)},!0),v.addEventListener("click",t=>{const i=t.target.closest(".playlist-item-delete");if(i){const g=i.closest(".playlist-item").dataset.itemId,m=currentPlaylist.findIndex(h=>h===g);m>-1&&(currentPlaylist.splice(m,1),localStorage.setItem("mmg-playlist",JSON.stringify(currentPlaylist)),renderPlaylist(),updateCardPlaylistButtonState(g),playAudio(sounds.back))}else{const d=t.target.closest(".playlist-item");if(d){const g=findItemById(d.dataset.itemId);g&&playVideoWhenReady(g,[],-1,!0)}}}),v.addEventListener("dragstart",t=>{t.target.classList.contains("playlist-item")&&(f=t.target,setTimeout(()=>t.target.classList.add("dragging"),0))}),v.addEventListener("dragend",t=>{f&&(f.classList.remove("dragging"),f=null)}),v.addEventListener("dragover",t=>{t.preventDefault();const i=C(v,t.clientY);f&&(i==null?v.appendChild(f):v.insertBefore(f,i))}),v.addEventListener("drop",t=>{if(t.preventDefault(),!f)return;currentPlaylist=Array.from(v.querySelectorAll(".playlist-item")).map(d=>d.dataset.itemId),currentPlayingItem&&(currentQueueIndex=currentPlaylist.findIndex(d=>d===currentPlayingItem.id)),localStorage.setItem("mmg-playlist",JSON.stringify(currentPlaylist)),renderPlaylist()}),document.getElementById("clear-playlist-btn").addEventListener("click",()=>{currentPlaylist=[],currentQueueIndex=-1,localStorage.setItem("mmg-playlist",JSON.stringify(currentPlaylist)),renderPlaylist(),showDialog(getTranslation("playlistCleared")),playAudio(sounds.back)});function C(t,i){return[...t.querySelectorAll(".playlist-item:not(.dragging)")].reduce((g,m)=>{const h=m.getBoundingClientRect(),_=i-h.top-h.height/2;return _<0&&_>g.offset?{offset:_,element:m}:g},{offset:Number.NEGATIVE_INFINITY}).element}let p=null,w=0,I=[];const $=[{step:1,selector:".back-btn",textKey:"tutorial_main_1"},{step:2,selector:"#home-btn",textKey:"tutorial_main_2"},{step:3,selector:".search-bar",textKey:"tutorial_main_3"},{step:4,selector:"#tags-filter-btn",textKey:"tutorial_main_4"},{step:5,selector:"#shop-btn",textKey:"tutorial_main_5"},{step:6,selector:"#achievements-btn",textKey:"tutorial_main_6"},{step:7,selector:"#settings-btn",textKey:"tutorial_main_7"},{step:8,selector:"#wifi-btn",textKey:"tutorial_main_8"},{step:9,selector:'.profile-tab[data-project="mmg-music"]',textKey:"tutorial_main_9",position:"pos-bottom"},{step:10,selector:'.profile-tab[data-project="mmg-beats"]',textKey:"tutorial_main_10",position:"pos-bottom"},{step:11,selector:"#content-cards",textKey:"tutorial_main_11",position:"pos-top"},{step:12,selector:"#mp3-player-container",textKey:"tutorial_main_12"},{step:13,selector:"#player-album-cover",textKey:"tutorial_main_13"},{step:14,selector:"#autoplay-toggle",textKey:"tutorial_main_14"},{step:15,selector:"#shuffle-btn",textKey:"tutorial_main_15"},{step:16,selector:"#loop-btn",textKey:"tutorial_main_16"},{step:17,selector:".volume-control-new",textKey:"tutorial_main_17"},{step:18,selector:"#player-like-btn",textKey:"tutorial_main_18"},{step:19,selector:"#playlist-btn",textKey:"tutorial_main_19"},{step:20,selector:"#share-btn",textKey:"tutorial_main_20"},{step:21,selector:"#player-more-options-btn",textKey:"tutorial_main_21"}],x=[{step:1,textKey:"tutorial_music_1",selector:()=>document.querySelector("#titles-cards .card"),position:"pos-bottom"},{step:2,selector:()=>document.querySelector("#titles-cards .card .like-btn-card"),textKey:"tutorial_music_2",position:"pos-top"},{step:3,selector:()=>document.querySelector("#titles-cards .card .add-playlist-btn-card"),textKey:"tutorial_music_3",position:"pos-top",action:()=>{const t=document.querySelector("#titles-cards .card a.card-link-wrapper");t&&(tutorialSuppressAutoplay=!0,t.click())}},{step:4,selector:"#details-album-art",textKey:"tutorial_music_4",position:"pos-top",reverseAction:()=>{showSection("titles-section",!1),document.getElementById("temp-play-btn").classList.remove("hidden")}},{step:5,selector:["#details-album-link","#details-tags"],textKey:"tutorial_music_5",position:"pos-top"},{step:6,selector:"#details-add-to-playlist-btn",textKey:"tutorial_music_6",position:"pos-top"},{step:7,selector:"#streaming-links",textKey:"tutorial_music_7",position:"pos-top"},{step:8,selector:".associated-videos-panel",textKey:"tutorial_music_8",position:"pos-top"},{step:9,selector:"#temp-play-btn",textKey:"tutorial_music_9",position:"pos-top"},{step:10,selector:["#prev-video-btn","#next-video-btn"],textKey:"tutorial_music_10",position:"pos-top"},{step:11,textKey:"tutorial_music_11",position:"pos-top"}],R={main:$,music:x};function L(t){if(I.length>0&&(I.forEach(m=>{m.classList.remove("tutorial-highlight"),m.classList.contains("card")&&(m.style.opacity="")}),I=[]),t<0||t>=p.length){S();return}document.getElementById("tutorial-prev").style.visibility=t===0?"hidden":"visible",w=t;const i=p[t];let d=[];if(typeof i.selector=="function"){const m=i.selector();d=Array.isArray(m)?m.filter(Boolean):m?[m]:[]}else if(typeof i.selector=="string"){const m=document.querySelector(i.selector);m&&d.push(m)}else Array.isArray(i.selector)?i.selector.forEach(m=>{const h=document.querySelector(m);h&&d.push(h)}):d=[document.body];d.length===0?console.warn(`Tutorial element(s) not found for step ${i.step}:`,i.selector):(I=d,I.forEach(m=>{m.classList.add("tutorial-highlight"),m.classList.contains("card")&&(m.style.opacity=1)}),I[0].scrollIntoView({behavior:"smooth",block:"center",inline:"center"}));const g=document.getElementById("tutorial-box");document.getElementById("tutorial-text").textContent=getTranslation(i.textKey),document.getElementById("tutorial-step-counter").textContent=`${i.step} / ${p.length}`,g.className="tutorial-box-style",g.classList.add(i.position||"pos-center")}function B(t){if(playAudio(sounds.select),p=R[t],!p)return;if(isTutorialActive=!0,document.body.classList.add("tutorial-active-body"),w=0,t==="music"&&(originalAutoplayState=isAutoplayActive,isAutoplayActive=!1,document.getElementById("temp-play-btn").classList.remove("hidden")),currentPlayingItem&&activePlayer&&typeof activePlayer.getPlayerState=="function"){const d=activePlayer.getPlayerState();(d===YT.PlayerState.PLAYING||d===YT.PlayerState.PAUSED)&&(tutorialSavedPlayerState={item:currentPlayingItem,time:activePlayer.getCurrentTime(),state:d,queue:[...activePlaybackQueue],queueIndex:currentQueueIndex},activePlayer.pauseVideo())}else tutorialSavedPlayerState=null;document.getElementById("guide-selection-overlay").style.display="none";const i=()=>{L(0),document.getElementById("tutorial-box").classList.remove("hidden")};t==="music"?setTimeout(i,600):i()}function S(){if(I.length>0&&(I.forEach(t=>{t.classList.remove("tutorial-highlight"),t.classList.contains("card")&&(t.style.opacity="")}),I=[]),isTutorialActive=!1,document.body.classList.remove("tutorial-active-body"),w=0,u(sounds.back),setTimeout(()=>{document.getElementById("tutorial-box").classList.add("hidden"),document.getElementById("guide-selection-overlay").style.display=""},500),tutorialSavedPlayerState){const{item:t,time:i,state:d,queue:g,queueIndex:m}=tutorialSavedPlayerState;currentPlayingItem=t,activePlaybackQueue=g,currentQueueIndex=m,activePlayer.cueVideoById({videoId:t.youtube_id,startSeconds:i}),updateMp3PlayerInfo(t),renderPlaylist(),setTimeout(()=>{d===YT.PlayerState.PLAYING&&activePlayer.playVideo(),updateProgressBar()},500),tutorialSavedPlayerState=null}else currentPlayingItem&&p===x&&(currentPlayingItem=null,resetMiniPlayerUI(),activePlayer.stopVideo());p===x&&(isAutoplayActive=originalAutoplayState,document.querySelectorAll("#autoplay-toggle, #overlay-autoplay-toggle").forEach(i=>{i.classList.toggle("active",isAutoplayActive),i.title=isAutoplayActive?"Autoplay activ\xE9":"Autoplay d\xE9sactiv\xE9"}),resetToHome()),updateTempPlayButtonVisibility(),p=null}document.getElementById("guide-btn").addEventListener("click",()=>{playAudio(sounds.select),l(document.getElementById("tutorial-overlay"),null,!0)}),document.querySelectorAll(".guide-choice-btn").forEach(t=>{t.addEventListener("click",i=>{const d=i.target.dataset.guide;if(d==="main")resetToHome();else if(d==="music"){const g=document.querySelector('.profile-tab[data-project="mmg-music"]');g&&!g.classList.contains("active")&&g.click();const m=Object.keys(siteData.contentData["mmg-music"].albums)[0];if(m){const h="mmg-music",_=siteData.contentData[h],U=Object.fromEntries(Object.entries(_.titles).filter(([V,H])=>H.albumId===m));document.getElementById("titles-section-title").textContent=siteData.contentData[h].albums[m].title,renderCards("titles-cards",U,"title"),showSection("titles-section")}}B(d)})}),document.getElementById("tutorial-next").addEventListener("click",async()=>{const t=p[w];t&&t.action&&(await t.action(),await new Promise(i=>setTimeout(i,500))),L(w+1)}),document.getElementById("tutorial-prev").addEventListener("click",async()=>{const t=p[w];t&&t.reverseAction&&(await t.reverseAction(),await new Promise(i=>setTimeout(i,500))),L(w-1)}),document.getElementById("tutorial-close").addEventListener("click",S),document.getElementById("player-toggle-handle").addEventListener("click",()=>{const t=!document.body.classList.contains("player-hidden");playAudio(t?sounds.minimize:sounds.maximize),document.body.classList.toggle("player-hidden")});function q(t){document.fullscreenElement?document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen():t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen&&t.msRequestFullscreen()}document.getElementById("fullscreen-btn").addEventListener("click",()=>{const t=document.getElementById("large-player-iframe");t&&q(t)});const E=document.getElementById("large-player-section");let j=0;E.addEventListener("dblclick",()=>{const t=document.getElementById("large-player-iframe");t&&q(t)}),E.addEventListener("touchend",t=>{const i=new Date().getTime(),d=i-j;if(d<300&&d>0){t.preventDefault();const g=document.getElementById("large-player-iframe");g&&q(g)}j=i});const M=document.getElementById("pwa-install-btn"),O=document.getElementById("pwa-dismiss-btn"),D=document.getElementById("pwa-install-overlay");M.addEventListener("click",async()=>{if(!deferredPrompt)return;D.classList.add("hidden"),deferredPrompt.prompt();const{outcome:t}=await deferredPrompt.userChoice;console.log(`User response to the install prompt: ${t}`),deferredPrompt=null}),O.addEventListener("click",()=>{D.classList.add("hidden")})}function handleMenuNavigation(e,s=!0){const a=document.querySelector(".profile-tab.active")?.dataset.project,n=siteData.contentData[a],o={"albums-section":{data:n.albums,type:"album",container:"albums-cards"},"gameplay-section":{data:n.gameplay,type:"video",container:"gameplay-cards"},"makingofs-section":{data:n.makingofs,type:"video",container:"makingofs-cards"}};if(document.getElementById(e)||(currentViewContext={type:"menu",data:null},e="menu-cards-section"),e==="albums-section")currentViewContext={type:"albums",data:null},renderCards("albums-cards",n.albums,"album");else if(e==="about-section"){currentViewContext={type:"about",data:null},document.getElementById("about-title").textContent=getTranslation("about");const c=a==="mmg-music"?"assets/mmg-music-avatar.webp":"assets/mmg-beats-avatar.webp",r=`about_${a.replace("-","_")}`;document.getElementById("about-content").innerHTML=`<img src="${c}" alt="Avatar"><p>${getTranslation(r)}</p>`}else if(e==="liked-titles-section"){const c=Object.fromEntries([...likedSongs].map(r=>[r,findItemById(r)]).filter(([,r])=>r));currentViewContext={type:"liked",data:null},document.getElementById("liked-titles-section-title").textContent=getTranslation("likedTitles"),renderCards("liked-titles-cards",c,"title")}else o[e]?renderCards(o[e].container,o[e].data,o[e].type):e==="menu-cards-section"&&(currentViewContext={type:"menu",data:null},renderCards("content-cards",siteData.projectData[a],"menu"),titleScrollObserver&&titleScrollObserver.disconnect());showSection(e,s)}function renderUpdateLog(){const e=document.getElementById("update-log-entries");!e||!siteData.updateLog||(e.innerHTML=siteData.updateLog.map(s=>`
                <div class="update-log-entry ${readUpdateIds.has(s.id)?"read":"unread"}">
                    <h5>${s.date}</h5>
                    <p>${s.content}</p>
                </div>
            `).join(""))}
