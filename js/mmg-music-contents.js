let siteData={},allSearchableItems={},largePlayer,mediumPlayer,activePlayer=null,currentPlayingItem=null,isPlayerLooping=!1,isShuffleMode=!1,pausedForOverlay=!1,isResumingFromOverlay=!1,playerInitializationComplete=!1,likedSongs=new Set,achievements={},savedPlaylists={},currentPlaylist=[],contextPlaybackQueue=[],userQueue=[],currentQueueIndex=-1,isHovering=!1,isAutoplayActive=!0,currentVolume=100,sfxEnabled=!0,currentLang="en",currentNavigationContext={playlist:[],index:-1},currentViewContext={type:"menu",data:null},currentPlaybackContext={type:"none",name:""},isBackgroundPlayEnabled=!0,listenProgress=0,previousListenProgress=0,seekDetectedInCurrentPlay=!1,isReloadingForAd=!1,userCoins=0,COIN_COST_UNLOCK=10,unlockedDreamSeasonTracks=[],purchasedShopItems=new Set,isTutorialActive=!1,tutorialSuppressAutoplay=!1,tutorialSavedPlayerState=null,originalAutoplayState=!0,titleScrollObserver=null,titleResizeObserver=null,readUpdateIds=new Set,deferredPrompt=null,carouselInterval=null,sounds={select:document.getElementById("select-sound"),back:document.getElementById("back-sound"),hover:document.getElementById("hover-sound"),switchToWhite:document.getElementById("switch-to-white-sound"),switchToBlack:document.getElementById("switch-to-black-sound"),shop:document.getElementById("shop-sound"),connecting:document.getElementById("connecting-sound"),achievementUnlocked:document.getElementById("achievement-unlocked-sound"),minimize:document.getElementById("minimize-sound"),maximize:document.getElementById("maximize-sound"),coin:document.getElementById("coin-sound"),keepAlive:document.getElementById("keep-alive-sound"),blocked:document.getElementById("blocked-sound")};async function loadDataAndInitialize(){try{var e=await fetch("data.json");if(!e.ok)throw new Error("HTTP error! status: "+e.status);siteData=await e.json(),Object.values(siteData.contentData).forEach(e=>{e.titles&&Object.entries(e.titles).forEach(([e,t])=>t.id=e),e.videos&&Object.entries(e.videos).forEach(([e,t])=>t.id=e),e.bonus&&Object.entries(e.bonus).forEach(([e,t])=>t.id=e),e.albums&&Object.entries(e.albums).forEach(([e,t])=>{t.id=e,t.type="album"}),Object.assign(allSearchableItems,e.titles,e.videos,e.bonus,e.albums)}),initializeApp()}catch(e){console.error("Could not load site data:",e),document.body.innerHTML='<h1 style="text-align: center; margin-top: 50px;">Erreur de chargement des données. Veuillez réessayer.</h1>'}}function onPlayerReady(e){setVolume(currentVolume),setInterval(updateProgressBar,1e3)}function onPlayerStateChange(e){var t=document.getElementById("play-pause-btn"),a=document.getElementById("play-pause-box");let i=document.getElementById("background-music");var l,n=document.getElementById("mini-player-play-pause-btn"),s=document.getElementById("mobile-player-play-pause-btn");e.data===YT.PlayerState.PLAYING||e.data===YT.PlayerState.PAUSED||e.data===YT.PlayerState.ENDED?a.classList.remove("loading"):e.data===YT.PlayerState.BUFFERING&&a.classList.add("loading"),e.data===YT.PlayerState.ENDED?("mediaSession"in navigator&&(navigator.mediaSession.playbackState="paused"),a=currentPlayingItem?.id,l=0<activePlayer.getDuration()?activePlayer.getCurrentTime()/activePlayer.getDuration():0,currentPlayingItem&&isMusicTitle(currentPlayingItem)&&!seekDetectedInCurrentPlay&&.95<=l&&(userCoins++,localStorage.setItem("mmg-userCoins",JSON.stringify(userCoins)),updateCoinDisplay(),showDialog("+1 pièce ! Total : "+userCoins),playAudio(sounds.coin),isPlayerLooping&&updateAchievementProgress("loopMaster",a),currentPlayingItem.tags?.includes("retro")&&updateAchievementProgress("retroPlayer",a),currentPlayingItem.tags?.includes("playstation")&&updateAchievementProgress("psPlayer",a),currentPlayingItem.tags?.includes("spotimon"))&&updateAchievementProgress("spotimonFan",a),isPlayerLooping?(isBackgroundPlayEnabled&&sounds.keepAlive&&sounds.keepAlive.play().catch(e=>console.log("Keep-alive audio failed to play on loop.")),e.target.seekTo(0),e.target.playVideo()):(isAutoplayActive?playNextTrack():(sounds.keepAlive&&sounds.keepAlive.pause(),t&&(t.className="fas fa-play"),n&&(n.className="fas fa-play"),s&&(s.className="fas fa-play")),updateMediaPositionState())):e.data===YT.PlayerState.PLAYING?isReloadingForAd?isReloadingForAd=!1:(t&&(t.className="fas fa-pause"),i.pause(),n&&(n.className="fas fa-pause"),s&&(s.className="fas fa-pause"),"mediaSession"in navigator&&(navigator.mediaSession.playbackState="playing"),isResumingFromOverlay?isResumingFromOverlay=!1:(!1===document.getElementById("video-suggestions-section").classList.contains("hidden")&&showSection(isMusicTitle(currentPlayingItem)?"music-title-details-section":"large-player-section"),isMusicTitle(currentPlayingItem)&&setTimeout(()=>{i.paused||isReloadingForAd||activePlayer.getPlayerState()!==YT.PlayerState.PLAYING||(console.log("Ad detected (background music still playing). Reloading video."),isReloadingForAd=!0,loadAndPlayVideo(currentPlayingItem))},500),updateMediaPositionState())):e.data===YT.PlayerState.PAUSED&&(t&&(t.className="fas fa-play"),n&&(n.className="fas fa-play"),s&&(s.className="fas fa-play"),"mediaSession"in navigator&&(navigator.mediaSession.playbackState="paused"),sounds.keepAlive&&sounds.keepAlive.pause(),updateMediaPositionState())}function playVideoWhenReady(a,e=[],t=-1,i="titles",l=!1,n=!1,s=!1){if(a)if(isAutoplayActive||l||!isMusicTitle(a)){currentPlayingItem=a;var o=userQueue.indexOf(a.id);if(-1<o&&(userQueue.splice(o,1),updateAllQueueViews()),l)contextPlaybackQueue=[a.id],currentQueueIndex=0;else if(e&&0<e.length)contextPlaybackQueue=e,currentQueueIndex=t;else{o=document.querySelector(".profile-tab.active")?.dataset.project||"mmg-music";let t=a.albumId;currentQueueIndex=t?(contextPlaybackQueue=Object.values(siteData.contentData[o].titles).filter(e=>e.albumId===t).map(e=>e.id)).findIndex(e=>e===a.id):(activePlaybackQueue=[a.id],0)}currentPlaybackContext="myPlaylist"===i?{type:"playlist",name:"Ma Playlist"}:"liked"===i?{type:"liked",name:"Titres Likés"}:"queue"===i?{type:"selection",name:"File d'attente"}:"mmgPlaylist"===i?{type:"mmgPlaylist",name:"Mmg Playlists"}:"video"===i?{type:"video",name:"Vidéos"}:!a.albumId||"titles"!==i&&"search"!==i&&"album"!==i?"search"===i?{type:"search",name:"Recherche"}:{type:"track",name:"Titres"}:(document.querySelector(".profile-tab.active")?.dataset.project,(l=a.albumId?siteData.contentData[document.querySelector(".profile-tab.active")?.dataset.project||"mmg-music"].albums[a.albumId]:null)?{type:"album",name:l.title}:{type:"track",name:"Titres"}),seekDetectedInCurrentPlay=!1,previousListenProgress=0,playerInitializationComplete?loadAndPlayVideo(a,n,s):showDialog("Chargement du lecteur vidéo...")}else renderMusicTitleDetails(a),showSection("music-title-details-section"),updateTempPlayButtonVisibility()}function loadAndPlayVideo(e,t=!1){document.getElementById("play-pause-box").classList.add("loading"),unhighlightPlayingCard();var a=isMusicTitle(currentPlayingItem=e),i=(activePlayer=a?mediumPlayer:largePlayer,a?largePlayer:mediumPlayer),i=(i&&"function"==typeof i.stopVideo&&i.stopVideo(),arguments[2]||!1),l=!document.getElementById("music-title-details-section").classList.contains("hidden"),t=(a&&renderMusicTitleDetails(e),t&&!i&&!l||showSection(a?"music-title-details-section":"large-player-section"),updateMp3PlayerInfo(e),updateLikeButtonUI(e.id),updateMediaSession(e),highlightPlayingCard(e),renderPlaylist(),document.getElementById("mobile-mini-player"));t&&t.classList.remove("hidden"),document.body.classList.remove("mobile-player-hidden"),document.documentElement.style.setProperty("--mobile-player-height","66px"),tutorialSuppressAutoplay?(tutorialSuppressAutoplay=!1,a?(renderMusicTitleDetails(e),showSection("music-title-details-section")):showSection("large-player-section")):activePlayer&&"function"==typeof activePlayer.loadVideoById&&activePlayer.loadVideoById(e.youtube_id,0)}function updateMediaSession(e){var t,a;"mediaSession"in navigator&&(t=document.querySelector(".profile-tab.active")?.dataset.project||"mmg-music",a=siteData.contentData[t].albums[e.albumId],navigator.mediaSession.metadata=new MediaMetadata({title:e.title,artist:"mmg-music"===t?"Mmg Music":"Mmg Beats",album:a?a.title:"Single",artwork:[{src:getCorrectImagePath(e),sizes:"512x512",type:"image/png"}]}),navigator.mediaSession.playbackState="playing",navigator.mediaSession.setActionHandler("play",()=>{activePlayer&&activePlayer.playVideo()}),navigator.mediaSession.setActionHandler("pause",()=>{activePlayer&&activePlayer.pauseVideo()}),navigator.mediaSession.setActionHandler("previoustrack",()=>playNextTrack(-1,!0)),navigator.mediaSession.setActionHandler("nexttrack",()=>playNextTrack(1,!0)),navigator.mediaSession.setActionHandler("seekbackward",e=>{e=e.seekOffset||10;activePlayer&&activePlayer.seekTo(Math.max(0,activePlayer.getCurrentTime()-e),!0)}),navigator.mediaSession.setActionHandler("seekforward",e=>{e=e.seekOffset||10;activePlayer&&activePlayer.seekTo(Math.min(activePlayer.getDuration(),activePlayer.getCurrentTime()+e),!0)}),navigator.mediaSession.setActionHandler("seekto",e=>{e.fastSeek&&"fastSeek"in activePlayer?activePlayer.fastSeek(e.seekTime):activePlayer&&activePlayer.seekTo(e.seekTime,!0)}),navigator.mediaSession.setActionHandler("stop",()=>{activePlayer&&"function"==typeof activePlayer.stopVideo&&(activePlayer.stopVideo(),currentPlayingItem=null,resetMiniPlayerUI())}),updateMediaPositionState())}function updateMediaPositionState(){if("mediaSession"in navigator&&activePlayer&&"function"==typeof activePlayer.getDuration){var e=activePlayer.getDuration()||0,t=activePlayer.getCurrentTime()||0;if("playing"===navigator.mediaSession.playbackState&&!isNaN(e)&&isFinite(e))try{navigator.mediaSession.setPositionState({duration:e,playbackRate:activePlayer.getPlaybackRate(),position:t})}catch(e){console.error("Erreur lors de la mise à jour de setPositionState:",e)}}}function highlightPlayingCard(e){var t;unhighlightPlayingCard(),e&&(t=document.querySelector(".page-section:not(.hidden)"))&&(t=t.querySelector(`.card[data-item-id="${e.id}"]`))&&t.classList.add("now-playing-card")}function unhighlightPlayingCard(){var e=document.querySelector(".card.now-playing-card");e&&e.classList.remove("now-playing-card")}function findItemById(e){return allSearchableItems[e]||null}function isMusicTitle(e){return e&&e.albumId&&e.year}function initUserData(){var e=localStorage.getItem("mmg-likedSongs"),e=(likedSongs=e?new Set(JSON.parse(e)):new Set,localStorage.getItem("mmg-playlist")),e=(currentPlaylist=e?JSON.parse(e):[],localStorage.getItem("mmg-savedPlaylists")),e=(savedPlaylists=e?JSON.parse(e):{},localStorage.getItem("mmg-sfxEnabled")),e=(sfxEnabled=null===e||JSON.parse(e),document.getElementById("sfx-switch").checked=sfxEnabled,localStorage.getItem("mmg-lang")),e=(applyLanguage(currentLang=e||"en"),localStorage.getItem("mmg-backgroundPlayEnabled")),e=(isBackgroundPlayEnabled=null===e||JSON.parse(e),document.getElementById("background-play-switch").checked=isBackgroundPlayEnabled,localStorage.getItem("mmg-readUpdateIds")),e=(readUpdateIds=e?new Set(JSON.parse(e)):new Set,localStorage.getItem("mmg-achievements"));let t={loopMaster:{unlocked:!1,progress:{},goal:3,icon:"fa-sync-alt"},retroPlayer:{unlocked:!1,progress:[],goal:3,icon:"fa-gamepad"},patienceIsKey:{unlocked:!1,progress:0,goal:2,icon:"fa-hourglass-end"},psPlayer:{unlocked:!1,progress:[],goal:2,icon:"fab fa-playstation"},spotimonFan:{unlocked:!1,progress:[],goal:7,icon:"fa-compact-disc"}};achievements=e?JSON.parse(e):t,Object.keys(t).forEach(e=>{achievements[e]||(achievements[e]=t[e])});e=localStorage.getItem("mmg-userCoins"),userCoins=e?JSON.parse(e):0,e=localStorage.getItem("mmg-unlockedTracks");try{unlockedDreamSeasonTracks=e?JSON.parse(e):[],Array.isArray(unlockedDreamSeasonTracks)||(unlockedDreamSeasonTracks=[])}catch(e){console.error("Failed to parse unlocked tracks, resetting.",e),unlockedDreamSeasonTracks=[]}e=localStorage.getItem("mmg-purchasedItems");try{var a=e?JSON.parse(e):[];purchasedShopItems=new Set(a)}catch(e){console.error("Failed to parse purchased items, resetting.",e),purchasedShopItems=new Set}renderShopPage()}function updateCoinDisplay(){var e=document.getElementById("coin-count");e&&(e.textContent=userCoins)}function updateNotificationDot(){var e=document.querySelectorAll(".notification-dot"),a=document.getElementById("mark-as-read-btn"),i=document.getElementById("unlock-notification-item");if(0!==e.length&&i&&a){var l=Object.values(allSearchableItems).filter(e=>e.isUnlockable).some(e=>!unlockedDreamSeasonTracks.includes(e.id)),l=userCoins>=COIN_COST_UNLOCK&&l,n=siteData.updateLog&&siteData.updateLog.some(e=>!readUpdateIds.has(e.id)),s=siteData.devMessages&&siteData.devMessages.some(e=>!readUpdateIds.has(e.id));let t=n||s;e.forEach(e=>e.classList.toggle("hidden",!t)),i.classList.toggle("hidden",!l),updateAppBadge(),a.disabled=!1,document.querySelector(".update-log").classList.toggle("has-unread",t)}}function updateAchievementProgress(t,a){if(!achievements[t].unlocked){var i=achievements[t];let e=!1;"loopMaster"===t?(i.progress[a]=(i.progress[a]||0)+1,i.progress[a]>=i.goal&&unlockAchievement(t),e=!0):"retroPlayer"===t||"psPlayer"===t?i.progress.includes(a)||(i.progress.push(a),i.progress.length>=i.goal&&unlockAchievement(t),e=!0):"patienceIsKey"===t?(i.progress++,i.progress>=i.goal&&unlockAchievement(t),e=!0):"spotimonFan"!==t||i.progress.includes(a)||(i.progress.push(a),i.progress.length>=i.goal&&unlockAchievement(t),e=!0),e&&(localStorage.setItem("mmg-achievements",JSON.stringify(achievements)),renderShopMissions())}}function unlockAchievement(e){achievements[e].unlocked||(achievements[e].unlocked=!0,localStorage.setItem("mmg-achievements",JSON.stringify(achievements)),playAudio(sounds.achievementUnlocked,!0),showDialog(`${getTranslation("achievementUnlocked")}: ${getTranslation(`achievement_${e}_title`)}!`),renderShopMissions(),updateShopLocksAndSelection())}function updateAppBadge(){var e=!document.querySelector(".notification-dot")?.classList.contains("hidden");"setAppBadge"in navigator&&(e?navigator.setAppBadge():navigator.clearAppBadge())}function unlockAllAchievements(){Object.keys(achievements).forEach(e=>{achievements[e].unlocked||(achievements[e].unlocked=!0)}),localStorage.setItem("mmg-achievements",JSON.stringify(achievements)),renderAchievements(),updateShopLocksAndSelection()}function renderAchievements(){let n=document.getElementById("achievements-list");n&&(n.innerHTML="",Object.entries(achievements).forEach(([e,t])=>{let a=0;"loopMaster"===e?a=Math.max(0,...Object.values(t.progress).map(Number))/t.goal:"retroPlayer"===e||"psPlayer"===e||"spotimonFan"===e?a=t.progress.length/t.goal:"patienceIsKey"===e&&(a=t.progress/t.goal),a=100*Math.min(1,a);var i=t.icon.startsWith("fab")?`<i class="${t.icon}"></i>`:`<i class="fas ${t.icon}"></i>`,l=document.createElement("div");l.className="achievement-item "+(t.unlocked?"unlocked":""),l.innerHTML=`
                <div class="achievement-icon">${i}</div>
                <div class="achievement-details">
                    <h4>${getTranslation(`achievement_${e}_title`)}</h4>
                    <p>${getTranslation(`achievement_${e}_desc`)}</p>
                    ${t.unlocked?"":`
                    <div class="achievement-progress-bar">
                        <div class="achievement-progress-fill" style="width: ${a}%"></div>
                    </div>`}
                </div>
            `,n.appendChild(l)}))}function toggleLike(e){playAudio(sounds.select),likedSongs.has(e)?likedSongs.delete(e):likedSongs.add(e),localStorage.setItem("mmg-likedSongs",JSON.stringify([...likedSongs])),updateLikeButtonUI(e);var t=document.querySelector(`.card[data-item-id="${e}"] .like-btn-card`);t&&(e=likedSongs.has(e),t.classList.toggle("active",e),t.classList.toggle("fas",e),t.classList.toggle("far",!e)),!1===document.getElementById("library-section").classList.contains("hidden")&&renderLibraryPage((t=document.querySelector("#library-tabs-container .playlist-tab-btn.active"))?t.dataset.tabId:"liked"),renderUserActivity(),renderLikedSongsPreview()}function updateLikeButtonUI(e){var t,a=document.getElementById("player-like-btn");a&&currentPlayingItem&&currentPlayingItem.id===e&&(e=likedSongs.has(e),(t=document.getElementById("mobile-player-like-btn")).classList.toggle("active",e),t.classList.toggle("fas",e),t.classList.toggle("far",!e),(t=document.getElementById("mini-player-like-btn")).classList.toggle("active",e),t.classList.toggle("fas",e),t.classList.toggle("far",!e),a.classList.toggle("active",e),a.classList.toggle("fas",e),a.classList.toggle("far",!e))}function togglePlaylistItem(e){var t=currentPlaylist.indexOf(e),t=(-1<t?(currentPlaylist.splice(t,1),showDialog(getTranslation("titleRemovedPlaylist")),playAudio(sounds.back)):(currentPlaylist.push(e),showDialog(getTranslation("titleAddedPlaylist")),playAudio(sounds.select)),localStorage.setItem("mmg-playlist",JSON.stringify(currentPlaylist)),renderPlaylist(),updateDetailsPlaylistButtonState(),!document.getElementById("library-section").classList.contains("hidden")),a=document.querySelector('#library-tabs-container .playlist-tab-btn[data-tab-id="current"]')?.classList.contains("active");t&&a&&renderLibraryPage("current"),updatePlayerPlaylistButtonUI(e),updateCardPlaylistButtonState(e)}function addToQueue(e){userQueue.includes(e)||(userQueue.push(e),showDialog(`"${findItemById(e).title}" `+getTranslation("addedToQueue")),updateAllQueueViews(),playAudio(sounds.select))}function playNext(e){var t;currentPlayingItem?(-1<(t=userQueue.indexOf(e))&&userQueue.splice(t,1),-1<(t=userQueue.indexOf(currentPlayingItem.id))?userQueue.splice(t+1,0,e):userQueue.unshift(e),showDialog(`"${findItemById(e).title}" ${getTranslation("playNext")}.`),updateAllQueueViews(),playAudio(sounds.select)):playVideoWhenReady(findItemById(e),[],-1,"queue")}function renderQueue(){let l=document.getElementById("queue-container");var a=document.getElementById("queue-context-subtitle");if(l&&a){var i=currentPlayingItem?userQueue.indexOf(currentPlayingItem.id):-1;let e=[],t=(e=-1<i?userQueue.slice(i+1):userQueue,"");if(currentPlayingItem)switch(currentPlaybackContext.type){case"album":t=`Lecture depuis l'album : <strong>${currentPlaybackContext.name}</strong>`;break;case"playlist":t=`Lecture depuis la playlist : <strong>${currentPlaybackContext.name}</strong>`}a.innerHTML=t,0===e.length?l.innerHTML='<p style="text-align: center; padding: 20px 0;">Aucun titre à venir.</p>':(l.innerHTML="",e.forEach((a,e)=>{var t,i=findItemById(a);i&&((t=document.createElement("div")).className="playlist-item queue-item",t.dataset.itemId=a,t.draggable=!0,t.dataset.index=e,(e=currentPlayingItem&&currentPlayingItem.id===a)&&t.classList.add("currently-playing"),t.innerHTML=`
                <i class="fas fa-bars playlist-drag-handle" title="Réorganiser"></i>
                <img src="${getCorrectImagePath(i)}" alt="${i.title}">
                <div class="playlist-item-info">
                    <p class="playlist-item-title">${i.title}</p>
                    <p class="playlist-item-subtitle">${i.year||"Vidéo"}</p>
                </div>
                ${e?'<span class="currently-playing-indicator"><i class="fas fa-volume-up"></i></span>':""}
            `,t.addEventListener("click",e=>{var t;e.target.closest(".playlist-drag-handle")||(activePlaybackQueue.findIndex(e=>e===a),e=findItemById(a),t=userQueue.indexOf(a),playVideoWhenReady(e,userQueue,t,"queue"))}),l.appendChild(t))}))}}function renderPlaylist(t={}){var{}=t,t=document.getElementById("playlist-overlay");if(t&&!t.classList.contains("hidden")){var a=document.getElementById("playlist-tabs-container");document.getElementById("playlist-header-actions");let o=document.getElementById("playlist-container");var i=document.getElementById("playlist-overlay-title"),l=document.getElementById("clear-playlist-btn");if(t&&a&&o&&i&&l){t='<button class="playlist-tab-btn active" data-playlist-id="custom">Ma Playlist</button>',t=(t+=Object.keys(savedPlaylists).map(e=>`<button class="playlist-tab-btn" data-playlist-id="${e}">${e}</button>`).join(""),a.innerHTML=t,a.querySelector(".playlist-tab-btn.active")),a=t.dataset.playlistId;let e=[],s=!1;s="custom"===a?(e=currentPlaylist,i.textContent="Ma Playlist",!0):(e=savedPlaylists[a]||[],i.textContent=a,!1),l.style.display=s?"flex":"none",0===e.length?o.innerHTML=`<p>${getTranslation("playlistEmpty")}</p>`:(o.innerHTML="",e.forEach((e,t)=>{var a,i,l,n=findItemById(e);n&&(a=currentPlayingItem&&currentPlayingItem.id===e,(i=document.createElement("div")).className="playlist-item "+(a?"currently-playing":""),i.dataset.itemId=e,e=(i.draggable=s)?'<i class="fas fa-bars playlist-drag-handle"></i>':'<span class="playlist-drag-handle-placeholder"></span>',l=s?`<button class="playlist-item-delete" title="${getTranslation("deleteFromPlaylist")}"><i class="fas fa-trash-alt"></i></button>`:"",i.innerHTML=`
                ${e}
                <img src="${getCorrectImagePath(n)}" alt="${n.title}">
                <div class="playlist-item-info">
                    <p class="playlist-item-title">${n.title}</p>
                    <p class="playlist-item-subtitle">${n.year||"Vidéo"}</p>
                </div>
                ${l}
                ${a?'<span class="currently-playing-indicator"><i class="fas fa-volume-up"></i></span>':""}
            `,o.appendChild(i))}))}}}function showPwaInstallPrompt(){var e,t=window.matchMedia("(display-mode: standalone)").matches;deferredPrompt&&!t?(console.log("Showing PWA install prompt."),(e=document.getElementById("pwa-install-overlay"))&&e.classList.remove("hidden")):console.log("PWA prompt not shown:",{deferredPrompt:!!deferredPrompt,isStandalone:t})}function playAudio(e,t=!1){(sfxEnabled||t)&&e&&(e.currentTime=0,e.play().catch(e=>{}))}function getTranslation(e,t={}){let a=translations[currentLang][e]||translations.en[e]||`[${e}]`;for(var i in t)a=a.replace(`{${i}}`,t[i]);return a}function applyLanguage(t){currentLang=t,localStorage.setItem("mmg-lang",t),document.querySelectorAll("[data-lang-key]").forEach(e=>{var t=getTranslation(e.dataset.langKey);e.placeholder?e.placeholder=t:e.textContent=t}),document.querySelectorAll("[data-lang-title]").forEach(e=>{var t=e.dataset.langTitle;e.title=getTranslation(t)}),document.querySelectorAll(".lang-btn").forEach(e=>{e.classList.toggle("active",e.dataset.lang===t)});let e=document.querySelector(".profile-tab.active")?.dataset.project;if(e&&(l=document.getElementById("menu-cards-section"))&&!l.classList.contains("hidden")&&renderCards("content-cards",siteData.projectData[e],"menu"),currentPlayingItem?updateMp3PlayerInfo(currentPlayingItem):resetMiniPlayerUI(),currentViewContext.type){let e=document.querySelector(".profile-tab.active")?.dataset.project;var a=siteData.contentData[e];switch(currentViewContext.type){case"home":renderDashboard();break;case"titles":renderCards("titles-cards",Object.fromEntries(Object.entries(a.titles).filter(([,e])=>e.albumId===currentViewContext.data)),"title");break;case"music-details":var i=findItemById(currentViewContext.data);i&&renderMusicTitleDetails(i);break;case"liked":handleMenuNavigation("liked-titles-section",!1);break;case"library":handleMenuNavigation("library-section",!1,currentViewContext.data);break;case"about":handleMenuNavigation("about-section",!1);break;case"search":updateVisibleCards(currentViewContext.data);break;case"albums":handleMenuNavigation("albums-section",!1)}}var l=document.getElementById("shop-section");l&&!l.classList.contains("hidden")&&renderShopPage()}function renderShopPage(){"undefined"!=typeof lucide&&lucide.createIcons(),updateCoinDisplay(),renderShopMissions(),renderShopItems(),setupTitleScrollObserver(".shop-product-title > span")}function renderShopMissions(){var e=document.getElementById("missions-container");e&&(e.innerHTML=Object.entries(achievements).map(([e,t])=>{var{unlocked:t,progress:a,goal:i}=t;let l="",n="shop-list-item card";var s=`<i class="fas ${achievements[e].icon}"></i>`;let o="",r=0;return"loopMaster"===e?r=Math.max(0,...Object.values(a).map(Number)):"retroPlayer"===e||"psPlayer"===e||"spotimonFan"===e?r=a.length:"patienceIsKey"===e&&(r=a),o=t?(n+=" unlocked",l='<button class="theme-buy-btn selected" disabled><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-check"><path d="M20 6 9 17l-5-5"/></svg></button>',`<p class="shop-item-description">${getTranslation(`achievement_${e}_desc`)}</p>`):(a=Math.min(100,Math.floor(r/i*100)),l=`<button class="theme-buy-btn locked mission-progress-text" disabled>${a}%</button>`,`<p class="shop-item-description">${getTranslation(`achievement_${e}_desc`)} (${r}/${i})</p>`),`
                <div class="${n}" data-mission-id="${e}">
                    <div class="shop-list-item-icon-container" data-icon-for-mission="${e}">
                        ${s}
                    </div>
                    <div class="list-view-title">
                        <span class="font-medium text-sm sm:text-base text-text-color"><span>${getTranslation(`achievement_${e}_title`)}</span></span>
                        ${o}
                    </div>
                    <div class="shop-list-item-action">
                        ${l}
                    </div>
                </div>
            `}).join(""),"undefined"!=typeof lucide)&&lucide.createIcons()}function renderShopItems(){var e,t,a=document.getElementById("themes-container"),i=document.getElementById("backgrounds-container");a&&i&&siteData.shopItems&&({backgrounds:e,themes:t}=siteData.shopItems,i||console.error("Backgrounds container not found in shop."),i.innerHTML=e.map(e=>{var t="bg-default-theme"===e.id||purchasedShopItems.has(e.id)||0===e.cost,a=(localStorage.getItem("bg-theme")||"bg-default-theme")===e.id;let i;i=a?'<button class="theme-buy-btn selected" disabled><i class="fas fa-check"></i></button>':t?`<button class="theme-buy-btn" data-theme="${e.id}"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle"><circle cx="12" cy="12" r="10"/></svg></button>`:`<button class="shop-buy-btn" data-item-id="${e.id}"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-coins"><circle cx="8" cy="8" r="6"/><path d="M18.09 10.37A6 6 0 1 1 10.34 18"/><path d="M7 6h1v4"/><path d="m16.71 13.88.7.71-2.82 2.82"/></svg> <span>${e.cost}</span></button>`;a=e.nameKey?getTranslation(e.nameKey):e.name;return`
                <div class="shop-product-card card ${t?"":"locked"}" data-item-id="${e.id}">
                    <div class="card-image-container">
                        
                        <img src="${e.image}" alt="Aperçu de ${a}" class="card__image">
                    </div>
                    <div class="card-info-container">
                        <div class="card__text">
                            <p class="card__title shop-product-title"><span>${a}</span></p>
                        </div>
                        ${i}
                    </div>
                </div>`}).join(""),a.innerHTML=t.map(e=>{var t=!e.missionId||achievements[e.missionId]&&achievements[e.missionId].unlocked,a=(localStorage.getItem("ui-theme")||"default")===e.id,i={default:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-palette-icon lucide-palette"><path d="M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z"/><circle cx="13.5" cy="6.5" r=".5" fill="currentColor"/><circle cx="17.5" cy="10.5" r=".5" fill="currentColor"/><circle cx="6.5" cy="12.5" r=".5" fill="currentColor"/><circle cx="8.5" cy="7.5" r=".5" fill="currentColor"/></svg>',"theme-8bit":'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-gamepad-icon lucide-gamepad"><line x1="6" x2="10" y1="12" y2="12"/><line x1="8" x2="8" y1="10" y2="14"/><line x1="15" x2="15.01" y1="13" y2="13"/><line x1="18" x2="18.01" y1="11" y2="11"/><rect width="20" height="12" x="2" y="6" rx="2"/></svg>',"theme-16bit":'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-gamepad2-icon lucide-gamepad-2"><line x1="6" x2="10" y1="11" y2="11"/><line x1="8" x2="8" y1="9" y2="13"/><line x1="15" x2="15.01" y1="12" y2="12"/><line x1="18" x2="18.01" y1="10" y2="10"/><path d="M17.32 5H6.68a4 4 0 0 0-3.978 3.59c-.006.052-.01.101-.017.152C2.604 9.416 2 14.456 2 16a3 3 0 0 0 3 3c1 0 1.5-.5 2-1l1.414-1.414A2 2 0 0 1 9.828 16h4.344a2 2 0 0 1 1.414.586L17 18c.5.5 1 1 2 1a3 3 0 0 0 3-3c0-1.545-.604-6.584-.685-7.258-.007-.05-.011-.1-.017-.151A4 4 0 0 0 17.32 5z"/></svg>',"theme-ps-style":'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-gamepad-directional-icon lucide-gamepad-directional"><path d="M11.146 15.854a1.207 1.207 0 0 1 1.708 0l1.56 1.56A2 2 0 0 1 15 18.828V21a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1v-2.172a2 2 0 0 1 .586-1.414z"/><path d="M18.828 15a2 2 0 0 1-1.414-.586l-1.56-1.56a1.207 1.207 0 0 1 0-1.708l1.56-1.56A2 2 0 0 1 18.828 9H21a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1z"/><path d="M6.586 14.414A2 2 0 0 1 5.172 15H3a1 1 0 0 1-1-1v-4a1 1 0 0 1 1-1h2.172a2 2 0 0 1 1.414.586l1.56 1.56a1.207 1.207 0 0 1 0 1.708z"/><path d="M9 3a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2.172a2 2 0 0 1-.586 1.414l-1.56 1.56a1.207 1.207 0 0 1-1.708 0l-1.56-1.56A2 2 0 0 1 9 5.172z"/></svg>',"theme-android":'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-smartphone-icon lucide-smartphone"><rect width="14" height="20" x="5" y="2" rx="2" ry="2"/><path d="M12 18h.01"/></svg>',"theme-spotimon":'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" fill="currentColor"><path d="M450.46,256.09C449.35,175.17,399.81,102.71,324,73.79,247.59,44.67,157.49,69,105.82,132.13,54.4,195,46.61,285.58,88.49,355.68c41.8,69.95,123.74,106,203.55,91.63,91-16.37,156.14-98.12,158.35-189.14A20.16,20.16,0,0,0,450.46,256.09ZM119.05,174.38C152.76,118,220.23,87,285,99.43c69.4,13.29,120.43,70.47,128.83,139H318.41c-8.26-27.36-32-48-62.62-48-29.65,0-55.15,20.65-63.11,48H97.74A158,158,0,0,1,119.05,174.38ZM286.13,256.1c-2,38.75-60.67,39.4-60.67,0S284.17,217.33,286.13,256.1Zm24,149.79C246.85,428.58,175,408.74,132.3,356.82a157.53,157.53,0,0,1-34.57-83H192.6c7.91,27.39,33.7,48,63.19,48,30.67,0,54.36-20.68,62.62-48h95.45C406.61,333,367.54,385.32,310.14,405.89Z"/></svg>'}[e.id]||'<i data-lucide="palette"></i>';let l;l=a?'<button class="theme-buy-btn selected" disabled><i class="fas fa-check"></i></button>':t?`<button class="theme-buy-btn" data-theme="${e.id}"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle"><circle cx="12" cy="12" r="10"/></svg></button>`:`<button class="theme-buy-btn locked" data-achievement="${e.missionId}"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-lock"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg></button>`;var a=e.nameKey?getTranslation(e.nameKey):e.name,n=t?getTranslation("themeUnlocked"):`${getTranslation("completeMission")} "${getTranslation(`achievement_${e.missionId}_title`)}"`;return`
                <div class="shop-list-item card ${t?"":"locked"}" data-item-id="${e.id}" data-mission-id="${e.missionId||""}">
                    <div class="shop-list-item-icon-container" style="color: ${e.color||"var(--active-color)"};">
                        ${i}
                    </div>
                    <div class="list-view-title">
                        <span class="font-medium text-sm sm:text-base text-text-color"><span>${a}</span></span>
                        <p class="shop-item-description">${n}</p>
                    </div>
                    <div class="shop-list-item-action">
                        ${l}
                    </div>
                </div>`}).join(""),"undefined"!=typeof lucide)&&lucide.createIcons()}function updateThemeColorMeta(){var e=document.body.classList.contains("dark-theme"),t=document.querySelector('meta[name="theme-color"]'),a=document.querySelector('meta[name="navigation-bar-color"]');t&&t.setAttribute("content",e?"#1f2937":"#ffffff"),a&&a.setAttribute("content",e?"#121212":"#ffffff")}window.onYouTubeIframeAPIReady=function(){var e={height:"100%",width:"100%",playerVars:{playsinline:1,autoplay:0,controls:0,modestbranding:1,rel:0,origin:window.location.origin},events:{onReady:onPlayerReady,onStateChange:onPlayerStateChange}};largePlayer=new YT.Player("large-player-iframe",e),mediumPlayer=new YT.Player("medium-player-iframe",e),playerInitializationComplete=!0,currentPlayingItem&&loadAndPlayVideo(currentPlayingItem)},window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),deferredPrompt=e,console.log("`beforeinstallprompt` event was fired.")});let activeOverlay=null;function openOverlay(e,t,a=!1){var i;activeOverlay!==e&&(a||((pausedForOverlay=activePlayer&&"function"==typeof activePlayer.getPlayerState&&activePlayer.getPlayerState()===YT.PlayerState.PLAYING)&&activePlayer.pauseVideo(),document.getElementById("background-music").pause()),activeOverlay&&activeOverlay.classList.add("hidden"),a=window.innerWidth<=952,i=e.querySelector(".settings-card"),(activeOverlay=e).classList.remove("hidden"),a&&i&&(i.offsetWidth,i.style.transform="translateY(0)"),t&&playAudio(t),"playlist-overlay"===e.id&&renderPlaylist(),"queue-overlay"===e.id&&renderQueue(),"wifi-overlay"===e.id)&&(playAudio(sounds.connecting,!0),sounds.connecting.onended=()=>{activeOverlay&&"wifi-overlay"===activeOverlay.id&&(closeOverlay(sounds.back),updateAchievementProgress("patienceIsKey"),showDialog(getTranslation("connectionSuccess")))})}function closeOverlay(t){if(activeOverlay){let e=activeOverlay;var a=window.innerWidth<=952,i=e.querySelector(".settings-card"),a=(a&&i&&"wifi-overlay"!==e.id&&"purchase-confirm-overlay"!==e.id?(i.style.transform="translateY(100%)",setTimeout(()=>{e.classList.add("hidden")},400)):e.classList.add("hidden"),e.id,"tags-filter-overlay"===e.id||"tutorial-overlay"===e.id&&!isTutorialActive);"wifi-overlay"===e.id&&sounds.connecting&&(sounds.connecting.pause(),sounds.connecting.currentTime=0,sounds.connecting.onended=null),activeOverlay=null,t&&playAudio(t),a||(pausedForOverlay?activePlayer&&(isResumingFromOverlay=!0,activePlayer.playVideo()):document.getElementById("settings-bg-music-switch").checked&&(!currentPlayingItem||activePlayer&&"function"==typeof activePlayer.getPlayerState&&1!==activePlayer.getPlayerState())&&document.getElementById("background-music").play()),pausedForOverlay=!1}}function handleShopClick(e){e.target.closest(".shop-buy-btn")}function updateTime(){var e=(new Date).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}),t=document.getElementById("real-time"),t=(t&&(t.textContent=e),document.getElementById("mobile-real-time"));t&&(t.textContent=e)}function getCorrectImagePath(e,t="full"){if(!e||!e.image)return"https://placehold.co/200x120/9E9E9E/FFFFFF?text=No+Image";if("thumb"===t){t=e.image.split("/");if(1<t.length){var a=t.pop(),t=t.join("/"),a=a.split(".");if(1<a.length)return t+"/thumb/"+(a.slice(0,-1).join(".")+"_thumb."+a.pop())}}return e.image}function renderCards(t,a,w="generic"){let S=document.getElementById(t);if(S){S.innerHTML="",S.style.display="",S.style.alignItems="",S.style.justifyContent="",S.style.height="";let P=document.createDocumentFragment();if(0===Object.keys(a).length){var i="search-results-cards"===t;let e=document.querySelector(`[data-header-for="${t}"]`);e&&(e.innerHTML="",e.classList.add("hidden"));i=i||"liked-titles-cards"===t?"noResults":"workInProgress";S.style.display="flex",S.style.alignItems="center",S.style.justifyContent="center",S.style.height="100%",void(S.innerHTML=`<p style="font-size: 1.2em; opacity: 0.7; white-space: nowrap;">${getTranslation(i)}</p>`)}else{i=localStorage.getItem("mmg-global-view")||"grid";let k="album"!==w&&"list"===i,e=document.querySelector(`[data-header-for="${t}"]`);e&&(k?(e.classList.remove("hidden"),e.innerHTML=`
                    <div class="whitespace-nowrap">#</div>
                    <div></div> <!-- CORRECTION: Ajout d'un div vide pour la colonne de l'image -->
                    <div class="whitespace-nowrap" data-lang-key="titles">${getTranslation("titles")}</div> 
                    <div class="whitespace-nowrap list-view-artist-col">${getTranslation("titleAndArtist").split(" & ")[1]||"Artiste"}</div>
                    <div class="tags-column whitespace-nowrap list-view-tags-col" data-lang-key="tags">${getTranslation("tags")}</div>
                    <div class="hidden sm:block"></div>
                    <div class="hidden sm:block"></div>`):(e.innerHTML="",e.classList.add("hidden"))),S.classList.toggle("list-view",k),S.classList.toggle("titles-grid",!k);var l=document.querySelector(`.view-toggle-btn[data-target-container="${t}"]`);l&&(l.querySelector("svg").innerHTML="list"===i&&"album"!==w?'<path stroke-linecap="round" stroke-linejoin="round" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path>':'<path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"></path>');let E=0;Object.entries(a).forEach(([e,l],t)=>{var n=document.createElement("div");n.className="menu"===w?"card card-menu":"card",n.style.animationDelay=E+"s",E+=.05;let s=l.id||e;n.dataset.itemId=s;var i="album"===w&&l.isUnlockableAlbum,o=i?Object.values(allSearchableItems).filter(e=>e.albumId===l.id&&e.isUnlockable):[],r=i?o.filter(e=>unlockedDreamSeasonTracks.includes(e.id)):[];let c=l.isUnlockable&&!unlockedDreamSeasonTracks.includes(s),d=i&&r.length<o.length;var e=c||d,u=(e&&n.classList.add("locked"),getCorrectImagePath(l,"thumb")),m=getCorrectImagePath(l,"full"),y=(document.querySelector(".profile-tab.active")?.dataset.project,l.langKey?getTranslation(l.langKey):l.title),g="title"===w||"video"===w||"search"===w&&"album"!==l.type,a=likedSongs.has(s),p=currentPlaylist.includes(s),v=(l.tags&&0<l.tags.length&&l.tags.join(", "),e&&"title"!==w&&d,y.replace(/"/g,"&quot;"),g?`
                <div class="card-actions">
                    <i class="like-btn-card ${a?"fas":"far"} fa-heart ${a?"active":""}" data-like-id="${s}" title="${getTranslation("like")}"></i>
                    <i class="fas ${p?"fa-check":"fa-plus"} add-playlist-btn-card ${p?"added":""}" data-playlist-id="${s}" title="${getTranslation("removePlaylist")||"Retirer"}"></i>
                </div>`:"");let h="";if("title"===w||"video"===w||"search"===w?h=`data-youtube-id="${l.youtube_id}"`:"album"===w?h=`data-album-id="${l.id}"`:"menu"===w&&(h=`data-link="${l.link}"`),!k||"title"!==w&&"video"!==w&&"search"!==w){var b,f=l.loopable?'<div class="card__badge">LOOP ME!</div>':"";let t,a;if("menu"!==w){t=`<img class="card__image" loading="lazy" decoding="async" src="${u}" onerror="this.onerror=null;this.src='${m}'" alt="${y.replace(/"/g,"&quot;")}">`;let e=getTranslation("viewContent");switch(w){case"title":var I=getTranslation("desc_"+l.id);e=I.startsWith("[")?l.description||getTranslation("listenToTitle"):I;break;case"album":e=i&&0<(I=o.length-r.length)?(b=1==I?"trackToUnlock_one":"trackToUnlock_many",n.classList.add("has-unlockable-text"),getTranslation(b,{count:I})):"";break;case"video":e=getTranslation("videoOrMakingOf");break;case"search":e="album"===l.type?"":l.year?getTranslation("musicTitle"):getTranslation("videoOrMakingOf")}a=`
                        <p class="card__title" title="${y.replace(/"/g,"&quot;")}">
                        <span>${y}</span>
                        </p>
                        <p class="card__description">${e}</p>
                    `}let e="";c?e=`
                    <div class="lock-overlay">
                        <i class="fas fa-lock"></i>
                        <span class="unlock-cost">${COIN_COST_UNLOCK}</span>
                    </div>`:d&&(h=`data-unlock-album="${l.id}"`,e='<div class="lock-overlay"><i class="fas fa-lock"></i></div>'),n.innerHTML=`
                    <a href="#" class="card-link-wrapper" ${h}>
                        <div class="card-image-container">
                            ${e}
                            ${f}
                            ${t}
                        </div>
                    </a>
                    <div class="card-info-container">
                        <div class="card__text">${a}</div>
                        ${g?v:""}
                    </div>`}else{f=siteData.contentData[document.querySelector(".profile-tab.active")?.dataset.project||"mmg-music"]===siteData.contentData["mmg-music"]?"Mmg Music":"Mmg Beats",v=l.tags&&0<l.tags.length?`<span class="tag-item" data-action="filter-tag" data-tag="${l.tags[0]}">${l.tags[0]}</span>`:"";n.innerHTML=`
                    <div class="list-view-index-container">
                        <span class="list-view-index text-sub-text-color text-sm">${t+1}</span>
                        <div class="list-view-equalizer">
                            <div class="bar"></div><div class="bar"></div><div class="bar"></div>
                        </div>
                    </div>
                    <div class="list-view-image-container">
                        <img src="${u}" loading="lazy" decoding="async" onerror="this.onerror=null;this.src='${m}'" alt="Pochette de ${y}" class="list-view-item-image"/>
                        ${e?'<div class="list-view-lock-overlay"><i class="fas fa-lock"></i></div>':""}
                    </div>
                    <div class="list-view-title">
                        <span class="font-medium text-sm sm:text-base text-text-color">${y}</span>
                        ${d?`
                            <span class="list-view-unlock-text">
                                ${getTranslation(1<r.length?"trackToUnlock_many":"trackToUnlock_one",{count:o.length-r.length})}
                            </span>
                        `:""}
                    </div> 
                    <div class="text-sub-text-color text-xs truncate items-center list-view-artist-col"><span>${f}</span></div>
                    <div class="tags-column text-sub-text-color text-xs items-center min-w-0 list-view-tags-col">${v}</div>
                    <div class="flex items-center justify-center"><i class="like-btn-card ${a?"fas":"far"} fa-heart ${a?"active":""}" data-like-id="${s}" title="${getTranslation("like")}"></i></div>
                    <div class="flex items-center justify-center"><i class="fas ${p?"fa-check":"fa-plus"} add-playlist-btn-card ${p?"added":""}" data-playlist-id="${s}" title="${getTranslation(p?"removePlaylist":"addPlaylist")}"></i></div>
                `,n.addEventListener("click",e=>{var t=e.target.closest(".like-btn-card"),a=e.target.closest(".add-playlist-btn-card"),i=e.target.closest('[data-action="filter-tag"]');if(!c||t||a||i)if(!d||t||a||i)if(t)e.stopPropagation(),toggleLike(s);else if(a)e.stopPropagation(),togglePlaylistItem(s);else if(i){e.stopPropagation();let t=i.dataset.tag;document.getElementById("search-input").value="",document.querySelectorAll("#tags-filter-list input").forEach(e=>e.checked=e.value===t.toLowerCase()),updateVisibleCards()}else{let e="titles";t=document.querySelector(".page-section:not(.hidden)")?.id;"library-section"===t?(a=document.querySelector("#library-tabs-container .playlist-tab-btn.active"))&&"liked"===a.dataset.tabId?e="liked":a&&savedPlaylists[a.dataset.tabId]?e="mmgPlaylist":a&&"current"===a.dataset.tabId&&(e="myPlaylist"):"search-results-section"===t&&(e="search"),playVideoWhenReady(l,[],-1,e)}else playAudio(sounds.blocked);else playAudio(sounds.blocked),showDialog(getTranslation("trackLocked"))})}if(g){n.addEventListener("contextmenu",e=>{e.preventDefault(),openCardContextMenu(e,s)});let t,a=0,i=0,l=(n.addEventListener("touchstart",e=>{a=e.touches[0].clientX,i=e.touches[0].clientY,t=setTimeout(()=>{openCardContextMenu(e,s)},500)},{passive:!0}),()=>clearTimeout(t));n.addEventListener("touchend",l),n.addEventListener("touchcancel",l),n.addEventListener("touchmove",e=>{var t=e.touches[0].clientX,e=e.touches[0].clientY;(10<Math.abs(t-a)||10<Math.abs(e-i))&&l()})}S.appendChild(n),P.appendChild(n)}),S.appendChild(P),k?setupTitleScrollObserver(`#${t} .list-view-title > span, #${t} .list-view-artist-col > span, #${t} .recent-video-item-info .video-title > span`):setupTitleScrollObserver(`#${t} .card__title > span, #${t} .carousel-item-info h3 > span, #${t} .recent-video-item-info .video-title > span`)}}}function getLikeSvg(e){return`
            <svg class="action-icon ${e?"liked":""}" viewBox="0 0 24 24" stroke="${e?"red":"currentColor"}" stroke-linecap="round" stroke-linejoin="round" fill="${e?"red":"none"}">
                <path d="M20.84 4.61a5.5 5.5 0 00-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 00-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 000-7.78z" />
            </svg>
        `}function getAddSvg(){return`
            <svg class="action-icon" viewBox="0 0 24 24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" fill="none">
                <path d="M12 5v14M5 12h14" />
            </svg>
        `}function handleLikeClick(e,t){e.stopPropagation(),toggleLike(t)}function handleAddClick(e,t){e.stopPropagation(),togglePlaylistItem(t)}function updateCardPlaylistButtonState(e){var a=document.querySelectorAll(`.card[data-item-id="${e}"] .add-playlist-btn-card`);if(0!==a.length){let t=currentPlaylist.includes(e);a.forEach(e=>{e.classList.toggle("fa-check",t),e.classList.toggle("fa-plus",!t),e.classList.toggle("added",t),e.title=t?getTranslation("removePlaylist"):getTranslation("addPlaylist")});a=document.querySelector(`.card[data-item-id="${e}"] .action-btn-like svg`);a&&(e=likedSongs.has(e),a.classList.toggle("liked",e),a.setAttribute("fill",e?"red":"none"),a.setAttribute("stroke",e?"red":"currentColor"))}}function updateDetailsPlaylistButtonState(){var e=document.getElementById("music-title-details-section"),t=document.getElementById("details-add-to-playlist-btn");e&&t&&(e=e.dataset.currentItemId)&&(currentPlaylist.includes(e)?(t.innerHTML=`<i class="fas fa-check"></i> <span data-lang-key="addedToPlaylist">${getTranslation("addedToPlaylist")}</span>`,t.classList.add("added")):(t.innerHTML=`<i class="fas fa-plus"></i> <span data-lang-key="addToPlaylist">${getTranslation("addToPlaylist")}</span>`,t.classList.remove("added")))}function renderMusicTitleDetails(e){currentViewContext={type:"music-details",data:e.id},document.getElementById("music-title-details-section").dataset.currentItemId=e.id;var t=document.querySelector(".profile-tab.active")?.dataset.project||"mmg-music",t=siteData.contentData[t].albums[e.albumId],a=(document.getElementById("details-album-art").src=getCorrectImagePath(e,"full"),document.getElementById("details-title").textContent=e.title,document.getElementById("details-album")),t=(a.textContent=t?t.title:getTranslation("unknown"),a.parentElement.dataset.albumId=e.albumId,document.getElementById("details-year")),a=(t.textContent=e.year||getTranslation("unknown"),t.parentElement.dataset.year=e.year||"",getTranslation("desc_"+e.id)),i=(document.getElementById("details-description").textContent=a.startsWith("[")?e.description||"":a,document.getElementById("details-tags").innerHTML=(e.tags||[]).map(e=>`<span class="tag-item" data-action="filter-tag" data-tag="${e}">${e}</span>`).join(""),document.getElementById("streaming-links"));if(i.innerHTML="",e.streaming){var l,n,s,o={spotify:{icon:"fab fa-spotify",base_url:"https://open.spotify.com/album/"},appleMusic:{icon:"fab fa-apple",base_url:"https://music.apple.com/fr/album/"},youtube:{icon:"fab fa-youtube",base_url:"https://www.youtube.com/watch?v="},deezer:{icon:"fab fa-deezer",base_url:"https://www.deezer.com/album/"},amazonMusic:{icon:"fab fa-amazon",base_url:"https://amazon.fr/music/player/albums/"},tidal:{icon:"fas fa-record-vinyl",base_url:"https://tidal.com/browse/album/"}};for([l,n]of Object.entries(e.streaming))o[l]&&n&&""!==n.trim()&&((s=document.createElement("a")).href=o[l].base_url+n,s.target="_blank",s.title="Écouter sur "+(l.charAt(0).toUpperCase()+l.slice(1)),s.innerHTML=`<i class="${o[l].icon}"></i>`,i.appendChild(s))}renderAssociatedVideos(e),updateTempPlayButtonVisibility(),updateDetailsPlaylistButtonState()}function renderAssociatedVideos(e){let a=document.querySelector(".profile-tab.active")?.dataset.project,i=document.getElementById("gameplay-video-container"),l=document.getElementById("makingof-video-container"),n=(i.innerHTML=`<h4 data-lang-key="gameplayVideo">${getTranslation("gameplayVideo")}</h4>`,l.innerHTML=`<h4 data-lang-key="makingOfVideo">${getTranslation("makingOfVideo")}</h4>`,e=>{var t=document.createElement("div");return t.className="associated-video-card card-link-wrapper",t.dataset.youtubeId=e.youtube_id,t.dataset.itemId=e.id,t.innerHTML=`
                <img src="${getCorrectImagePath(e)}" alt="${e.title}" onerror="this.src='https://placehold.co/100x56/000/fff?text=Error';">
                <p>${e.title}</p>
            `,t}),s=!1,o=!1;e.associatedVideos&&0<e.associatedVideos.length&&e.associatedVideos.forEach(e=>{var t=findItemById(e);t&&(siteData.contentData[a].videos[e]?(i.appendChild(n(t)),s=!0):siteData.contentData[a].bonus[e]&&(l.appendChild(n(t)),o=!0))}),s||(i.innerHTML+=`<p>${getTranslation("noAssociatedVideo")}</p>`),o||(l.innerHTML+=`<p>${getTranslation("noAssociatedVideo")}</p>`)}function renderVideoSuggestions(){var e=document.querySelector(".profile-tab.active")?.dataset.project||"mmg-music",e={...siteData.contentData[e].titles,...siteData.contentData[e].gameplay};renderCards("suggestions-cards",Object.values(e).filter(e=>e.id!==currentPlayingItem?.id).sort(()=>.5-Math.random()).slice(0,4),"video")}function updateMp3PlayerInfo(a){if(a&&a.title){document.getElementById("song-title").textContent=a.title;var i=document.getElementById("mobile-player-title"),l=document.getElementById("mobile-player-artist"),i=(i.querySelector("span").textContent=a.title,checkTitleOverflow(i),siteData.contentData[document.querySelector(".profile-tab.active")?.dataset.project||"mmg-music"]),i=i===siteData.contentData["mmg-music"]?"Mmg Music":"Mmg Beats";l.querySelector("span").textContent=i,checkTitleOverflow(l);let e=isMusicTitle(a)?getCorrectImagePath(a,"full"):`https://img.youtube.com/vi/${a.youtube_id}/mqdefault.jpg`;document.getElementById("player-album-cover").src=e||"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='70' height='70'%3E%3C/svg%3E",document.getElementById("mobile-player-album-art").src=e||"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='300'%3E%3C/svg%3E";var i=document.getElementById("mini-player-title"),l=document.getElementById("mini-player-context"),n=document.getElementById("desktop-player-context");i&&(i.querySelector("span").textContent=a.title,i.parentElement.classList.remove("no-track"),checkTitleOverflow(i));let t=document.getElementById("mini-player-album-art");if(t.src=isMusicTitle(a)?getCorrectImagePath(a,"thumb"):e,t.onerror=()=>{t.onerror=null,t.src=e},l||n){let e="";switch(currentPlaybackContext.type){case"album":case"search":case"track":e=getTranslation("fromTitles");break;case"selection":e=getTranslation("fromPlaybackQueue");break;case"playlist":e=getTranslation("fromMyPlaylist");break;case"video":e=getTranslation("fromVideos");break;case"liked":e=getTranslation("fromLiked");break;case"mmgPlaylist":e=getTranslation("fromMmgPlaylists")}l&&(l.textContent=e),n&&(n.textContent=e)}i=document.getElementById("mini-player-album-art"),l=(i&&(i.style.opacity="1"),updatePlayerPlaylistButtonUI(a.id),document.getElementById("mini-player-controls")),n=(l&&(l.style.display="flex"),document.getElementById("mini-player-album-art"));n&&(n.style.display="block"),updateLikeButtonUI(a.id)}}function updatePlayerPlaylistButtonUI(e){var a=[document.getElementById("player-add-to-playlist-btn"),document.getElementById("mobile-player-add-to-playlist-btn")].filter(Boolean);if(0!==a.length&&currentPlayingItem&&currentPlayingItem.id===e){let t=currentPlaylist.includes(e);a.forEach(e=>{e.classList.toggle("fa-plus",!t),e.classList.toggle("fa-check",t),e.classList.toggle("added",t),e.title=getTranslation(t?"removePlaylist":"addPlaylist")})}}function resetMiniPlayerUI(){document.getElementById("mobile-mini-player")&&(document.body.classList.add("mobile-player-hidden"),document.documentElement.style.setProperty("--mobile-player-height","0px")),document.getElementById("progress-fill").style.width="0%",document.getElementById("song-title").textContent=getTranslation("noTrackPlaying"),document.getElementById("player-album-cover").src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='70' height='70'%3E%3C/svg%3E";var e=document.getElementById("mini-player-title"),e=(e&&(e.querySelector("span").textContent="",e.parentElement.classList.add("no-track")),document.getElementById("mini-player-album-art").src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='45' height='45'%3E%3C/svg%3E",document.getElementById("mini-player-progress-fill").style.width="0%",document.getElementById("mobile-player-title")),t=document.getElementById("mobile-player-artist");e.querySelector("span").textContent=getTranslation("noTrackPlaying"),t.querySelector("span").textContent="",e.classList.remove("scrolling"),t.classList.remove("scrolling"),document.getElementById("mobile-player-album-art").src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='300'%3E%3C/svg%3E",document.getElementById("mobile-player-progress-fill").style.width="0%",document.getElementById("mobile-player-current-time").textContent="0:00",document.getElementById("mobile-player-duration").textContent="0:00",document.getElementById("mobile-player-play-pause-btn").className="fas fa-play",unhighlightPlayingCard()}function updateProgressBar(){var e,t,a;activePlayer&&"function"==typeof activePlayer.getDuration&&currentPlayingItem&&(0<(e=activePlayer.getDuration())&&(t=activePlayer.getCurrentTime(),listenProgress=t/e,document.getElementById("progress-fill").style.width=100*listenProgress+"%",document.getElementById("current-time-display").textContent=formatTime(t),document.getElementById("duration-display").textContent=formatTime(e),0<previousListenProgress&&((a=document.getElementById("mobile-player-progress-fill"))&&(a.style.width=100*listenProgress+"%"),(a=document.getElementById("mini-player-progress-fill"))&&(a.style.width=100*listenProgress+"%"),(a=document.getElementById("mobile-player-current-time"))&&(a.textContent=formatTime(t)),(a=document.getElementById("mobile-player-duration"))&&(a.textContent=formatTime(e)),t=listenProgress-previousListenProgress,a=2/e,2<e)&&Math.abs(t)>a&&(seekDetectedInCurrentPlay=!0),previousListenProgress=listenProgress),updateMediaPositionState())}function formatTime(e){return Math.floor(e/60)+":"+Math.floor(e%60).toString().padStart(2,"0")}function scaleToShowSection(e){let t=document.querySelector(".content-section-board").querySelector(".page-section:not(.hidden)"),a=document.getElementById(e);!a||t&&t.id===e||(t&&t.classList.add("is-scaling-out"),a.style.animation="scale-in-fade 0.4s ease-out forwards",setTimeout(()=>{t&&(t.classList.add("hidden"),t.classList.remove("is-scaling-out")),a.classList.remove("hidden"),history.state&&history.state.section===e||history.pushState({section:e,fromApp:!0},"","#"+e)},400))}function showSection(t,a=!0){var e;let i=document.querySelector(".content-section-board").querySelector(".page-section:not(.hidden)"),l=document.getElementById(t);!l||i&&i.id===t?(e=document.querySelector(".content-section-board"))&&(e.scrollTop=0):(e=()=>{var e=document.querySelector(".content-section-board"),e=(e&&(e.scrollTop=0),document.querySelectorAll(".content-section-board .page-section").forEach(e=>{e.classList.add("hidden"),e.classList.remove("is-hiding")}),l.classList.remove("hidden"),!a||history.state&&history.state.section===t||(i&&"library-section"===i.id&&(e=document.querySelector("#library-tabs-container .playlist-tab-btn.active"))&&(currentViewContext={type:"library",data:e.dataset.tabId}),history.replaceState({...history.state,context:currentViewContext},"",window.location.hash),history.pushState({section:t,fromApp:!0,context:null},"","#"+t)),updateTempPlayButtonVisibility(),highlightPlayingCard(currentPlayingItem),document.querySelector(".profile-tab.active")?.dataset.project);e&&renderSidebarNav(e)},unhighlightPlayingCard(),i?(i.classList.add("is-hiding"),setTimeout(e,200)):e())}function updateTempPlayButtonVisibility(){var e,t=document.getElementById("temp-play-btn");t&&(e=!document.getElementById("music-title-details-section").classList.contains("hidden"),!isAutoplayActive&&e?t.classList.remove("hidden"):t.classList.add("hidden"))}function updateVisibleCards(t=null){let n=document.getElementById("search-input").value.toLowerCase().trim(),s=Array.from(document.querySelectorAll("#tags-filter-list input:checked")).map(e=>e.value);var a=document.getElementById("tags-filter-count");if(a&&(a.textContent=0<s.length?s.length:"",a.classList.toggle("hidden",0===s.length)),""===n&&0===s.length)document.getElementById("tags-filter-overlay").classList.contains("hidden")&&!1===document.getElementById("search-results-section").classList.contains("hidden")&&resetToHome();else{var i,a=Object.fromEntries(Object.entries(allSearchableItems).filter(([,e])=>{var t=e.title.toLowerCase().includes(n),a=(e.tags||[]).some(e=>e.toLowerCase().includes(n));let i=!1,l=(e.albumId&&siteData.contentData["mmg-music"].albums[e.albumId]&&(i=siteData.contentData["mmg-music"].albums[e.albumId].title.toLowerCase().includes(n)),(e.tags||[]).map(e=>e.toLowerCase()));e=0===s.length||s.every(e=>l.includes(e));return(t||a||i)&&e})),l=(currentPlayingItem&&activePlayer&&"function"==typeof activePlayer.getPlayerState&&(activePlayer.getPlayerState()!==YT.PlayerState.PLAYING&&(activePlayer.getPlayerState(),YT.PlayerState.PAUSED)),[]);n&&l.push(`${getTranslation("searchFor")}: "${n}"`),0<s.length&&(i=s.map(e=>`"${e}"`).join(", "),l.push(getTranslation("contentWithTag")+": "+i));let e=l.join(" & ");e=e||getTranslation("searchResults"),document.getElementById("search-results-title").innerHTML=e,showSection("search-results-section",!0,!(currentViewContext={type:"search",data:t})),renderCards("search-results-cards",a,"search")}}function setupTagFilters(){let t=new Set(["snow","western","desert","dream"]);var e=new Set(Object.values(allSearchableItems).flatMap(e=>e.tags||[]).filter(e=>!t.has(e)));let i=document.getElementById("tags-filter-list");i.innerHTML="",Array.from(e).sort().forEach(e=>{var t="tag-"+e.toLowerCase().replace(/\s/g,"-"),a=document.createElement("div");a.className="tag-filter-item",a.innerHTML=`<input type="checkbox" id="${t}" value="${e.toLowerCase()}"><label for="${t}">${e}</label>`,i.appendChild(a)})}function showDialog(e){let t=document.getElementById("custom-dialog");t.querySelector("p").textContent=e,t.classList.remove("hidden"),setTimeout(()=>t.classList.add("hidden"),2500)}function showBigDialog(e){let t=document.getElementById("big-dialog");t&&(t.querySelector("p").textContent=e,t.classList.remove("hidden"),t.classList.remove("fade-out"),setTimeout(()=>{t.classList.add("fade-out"),setTimeout(()=>t.classList.add("hidden"),500)},1e4))}function applyTheme(t){var e=siteData.shopItems.backgrounds.some(e=>e.id===t),{themes:a,backgrounds:i}=siteData.shopItems;e?(localStorage.setItem("bg-theme",t),i.forEach(e=>document.body.classList.remove(e.id)),"default-bg"!==t&&document.body.classList.add(t)):(a.forEach(e=>document.body.classList.remove(e.id)),"default"!==t&&document.body.classList.add(t),localStorage.setItem("ui-theme",t)),renderShopItems()}function updateShopLocksAndSelection(){let i=localStorage.getItem("ui-theme")||"default",l=localStorage.getItem("bg-theme")||"bg-1";document.querySelectorAll(".shop-list-item-action .theme-buy-btn, .shop-product-card .theme-buy-btn, .shop-product-card .shop-buy-btn").forEach(e=>{var t=e.dataset.achievement;let a=e.dataset.theme;a&&(e.disabled=!1,e.classList.remove("locked","selected"),t&&achievements[t]&&!achievements[t].unlocked?(e.classList.add("locked"),e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-lock"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>',e.disabled=!0):siteData.shopItems.backgrounds.some(e=>e.id===a)&&a===l||siteData.shopItems.themes.some(e=>e.id===a)&&a===i?(e.classList.add("selected"),e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-check"><path d="M20 6 9 17l-5-5"/></svg>',e.disabled=!0):e.classList.contains("shop-buy-btn")||(e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle"><circle cx="12" cy="12" r="10"/></svg>'))})}function applyInitialTheme(){var e=localStorage.getItem("mmg-theme")||"light",t=localStorage.getItem("ui-theme")||"default",a=localStorage.getItem("bg-theme")||"bg-1";document.getElementById("theme-switch").checked="dark"===e,document.body.classList.toggle("dark-theme","dark"===e),"default"!==t&&document.body.classList.add(t),"bg-default-theme"!==a&&document.body.classList.add(a),updateThemeColorMeta()}function resetToHome(e=!0){e&&playAudio(sounds.select),handleMenuNavigation("home-dashboard-section")}function renderSidebarNav(e){var i=document.getElementById("sidebar-main-nav");if(i){let t=document.querySelector(".page-section:not(.hidden)")?.id||"home-dashboard-section",a={albums:"disc-album",videos:"tv",about:"info",library:"library",shop:"shopping-bag"};var e=Object.values(siteData.projectData[e]||{}).filter(e=>e.link),l=e.find(e=>"about"===e.langKey),e=e.filter(e=>"about"!==e.langKey).map(e=>`
                <a href="#" class="sidebar-nav-link ${e.link===t?"active":""}" data-link="${e.link}">
                    <i data-lucide="${a[e.langKey]||"help-circle"}"></i>
                    <span data-lang-key="${e.langKey}">${getTranslation(e.langKey)||e.title}</span>
                </a>`).join(""),n=`
            <a href="#" class="sidebar-nav-link ${"library-section"===t?"active":""}" data-link="library-section">
                <i data-lucide="${a.library}"></i>
                <span data-lang-key="library">${getTranslation("library")}</span>
            </a>`,s=`
            <a href="#" class="sidebar-nav-link ${"shop-section"===t?"active":""}" data-link="shop-section">
                <i data-lucide="${a.shop}"></i>
                <span data-lang-key="shop">${getTranslation("shop")}</span>
            </a>`,o=l&&l.link===t,o=l?`
            <a href="#" class="sidebar-nav-link ${o?"active":""}" data-link="${l.link}">
                <i data-lucide="${a[l.langKey]||"info"}"></i>
                <span data-lang-key="${l.langKey}">${getTranslation(l.langKey)}</span>
            </a>`:"";i.innerHTML=e+n+s+o,"undefined"!=typeof lucide&&lucide.createIcons()}}function setVolume(e,t=!1){currentVolume=Math.max(0,Math.min(100,e)),document.querySelectorAll("#volume-level-display").forEach(e=>e.textContent=currentVolume);let a=currentVolume/100;largePlayer?.setVolume&&largePlayer.setVolume(currentVolume),mediumPlayer?.setVolume&&mediumPlayer.setVolume(currentVolume);e=document.getElementById("mobile-volume-level");e&&(e.style.width=currentVolume+"%",e.parentElement.setAttribute("aria-valuenow",currentVolume)),Object.values(sounds).forEach(e=>{e&&(e.volume=a)}),t&&playAudio(sounds.hover)}function checkTitleOverflow(a){let i=a.parentElement;i&&(i.classList.remove("scrolling"),i.style.setProperty("--overflow-width","0px"),requestAnimationFrame(()=>{var e,t;a.scrollWidth>i.clientWidth+1&&(e=a.scrollWidth-i.clientWidth,t=Math.max(3,e/40+1),i.style.setProperty("--overflow-width",`-${10+e}px`),i.style.setProperty("--scroll-duration",t+"s"),i.classList.add("scrolling"))}))}function setupTitleScrollObserver(e){titleScrollObserver&&titleScrollObserver.disconnect();var t={root:document.querySelector(".content-section-board"),rootMargin:"0px",threshold:.8};titleScrollObserver=new IntersectionObserver((e,t)=>{e.forEach(e=>{e.isIntersecting?checkTitleOverflow(e.target):e.target.classList.remove("scrolling")})},t),titleResizeObserver&&titleResizeObserver.disconnect(),titleResizeObserver=new ResizeObserver(e=>{for(var t of e)checkTitleOverflow(t.target)}),document.querySelectorAll(e).forEach(e=>{titleScrollObserver.observe(e),titleResizeObserver.observe(e)})}function initializeApp(){document.body.style.cursor="",initUserData();renderSidebarNav(document.querySelector(".profile-tab.active")?.dataset.project||"mmg-music"),resetMiniPlayerUI(),setupTagFilters(),renderUpdateLog(),updateTime(),setInterval(updateTime,3e4),applyInitialTheme(),setVolume(100),setupEventListeners(),window.location.hash.substring(1);history.replaceState({section:"home-dashboard-section",fromApp:!0,isTrap:!0},"","#home-dashboard-section"),history.pushState({section:"home-dashboard-section",fromApp:!0},"","#home-dashboard-section"),updateNotificationDot(),setTimeout(showPwaInstallPrompt,5e3),handleMenuNavigation("home-dashboard-section",!1),"serviceWorker"in navigator&&(navigator.serviceWorker.register("/sw.js").then(function(e){console.log("Service Worker enregistré avec succès, portée :",e.scope)}).catch(function(e){console.log("Échec de l'enregistrement du Service Worker: ",e)}),window.addEventListener("load",()=>{navigator.serviceWorker.addEventListener("message",e=>{if(e.data&&e.data.action)switch(console.log("Action received from SW: "+e.data.action),e.data.action){case"play":activePlayer&&activePlayer.playVideo();break;case"pause":activePlayer&&activePlayer.pauseVideo();break;case"nexttrack":playNextTrack(1,!0);break;case"previoustrack":playNextTrack(-1,!0);break;case"stop":activePlayer&&activePlayer.stopVideo()}})}))}let playNextTrack=(e=1,t=!1,a=!1)=>{t||isAutoplayActive||playAudio(sounds.select);let i,l,n="context";var s=currentPlayingItem?userQueue.indexOf(currentPlayingItem.id):-1;if(-1<s&&1<userQueue.length)i=(s+e+userQueue.length)%userQueue.length,l=userQueue[i],n="user";else if(0<userQueue.length)l=userQueue[0],i=0,n="user";else{if(0===contextPlaybackQueue.length||-1===currentQueueIndex)return renderVideoSuggestions(),void showSection("video-suggestions-section",!0,!0);i=(currentQueueIndex+e+contextPlaybackQueue.length)%contextPlaybackQueue.length,l=contextPlaybackQueue[i]}var o="user"===n?userQueue:contextPlaybackQueue;if(isShuffleMode&&(t||isAutoplayActive)){let e;for(;e=Math.floor(Math.random()*o.length),1<o.length&&e===("user"===n?s:currentQueueIndex););i=e,l=o[i]}(e=findItemById(l))&&(isAutoplayActive||t?(t="user"===n?"queue":currentPlaybackContext.type,playVideoWhenReady(e,o,i,t,!1,!0,a)):(renderMusicTitleDetails(e),showSection("music-title-details-section"),updateTempPlayButtonVisibility()))};function setupEventListeners(){var e=document.querySelector(".back-btn"),e=(e&&e.addEventListener("click",e=>{e.preventDefault(),playAudio(sounds.back),isTutorialActive||!1===document.getElementById("home-dashboard-section").classList.contains("hidden")||((e=document.getElementById("library-section"))&&!e.classList.contains("hidden")?resetToHome(!1):(e=document.getElementById("menu-cards-section"),document.getElementById("artwork-overlay").classList.contains("hidden")?e&&!e.classList.contains("hidden")||window.history.back():document.getElementById("artwork-overlay").classList.add("hidden")))}),document.getElementById("mobile-profile-switch")),e=(e&&e.addEventListener("click",e=>{var t,e=e.target.closest(".profile-switch-btn");e&&!e.classList.contains("active")&&(t=e.dataset.project,t=document.querySelector(`.profile-tab[data-project="${t}"]`))&&(t.click(),document.querySelectorAll("#mobile-profile-switch .profile-switch-btn").forEach(e=>e.classList.remove("active")),e.classList.add("active"))}),document.getElementById("home-btn")),e=(e&&e.addEventListener("click",e=>{e.preventDefault(),resetToHome()}),window.addEventListener("popstate",e=>{e.state&&e.state.isTrap?history.forward():e.state&&"artwork"===e.state.overlay?(document.getElementById("artwork-overlay").classList.add("hidden"),updateThemeColorMeta()):handleMenuNavigation(e.state?.section||"home-dashboard-section",!1,e.state?.context||null)}),document.querySelectorAll(".profile-tab").forEach(e=>{e.addEventListener("click",()=>{var i=document.querySelector(".profile-tab.active")?.dataset.project,l=(document.querySelectorAll(".profile-tab").forEach(e=>e.classList.remove("active")),e.classList.add("active"),e.dataset.project);if(i&&i!==l){let a=document.querySelector(".page-section:not(.hidden)")?.id||"home-dashboard-section",e="home-dashboard-section";if(["library-section"].includes(a)&&(e=a),"home-dashboard-section"!==a){let t=Object.values(siteData.projectData[i]).find(e=>e.link===a);t&&(i=Object.values(siteData.projectData[l]).find(e=>e.langKey===t.langKey||e.link===t.link))&&(e=i.link)}renderSidebarNav(l),handleMenuNavigation(e)}})}),document.getElementById("main-content-wrapper")),e=(e.addEventListener("click",s=>{var o=s.target.closest(".top-bar-btn, .player-buttons > i, .controls-box, .player-right-controls > i, .mobile-player-controls > i, .mobile-player-play-box, .mobile-player-secondary-controls > i, .mobile-player-header-btn, .mini-player-controls > i, .mobile-nav-link, #mobile-player-autoplay-btn"),o=(o&&("mobile-player-play-pause-box"===o.id&&o.querySelector("i"),o.classList.remove("icon-pop"),o.offsetWidth,o.classList.add("icon-pop")),s.target.closest(".guide-choice-btn[data-guide]"));if(o){s.preventDefault();o=o.dataset.guide;if("main"===o)resetToHome(!1);else if("music"===o){var e=document.querySelector('.profile-tab[data-project="mmg-music"]');e&&!e.classList.contains("active")&&e.click();let t=Object.keys(siteData.contentData["mmg-music"].albums)[0];renderCards("titles-cards",Object.fromEntries(Object.entries(siteData.contentData["mmg-music"].titles).filter(([,e])=>e.albumId===t)),"title"),showSection("titles-section")}e=o,(p=f[e])&&(openOverlay(document.getElementById("tutorial-overlay"),sounds.select),isTutorialActive=!0,document.body.classList.add("tutorial-active-body"),v=0,"music"===e&&(originalAutoplayState=isAutoplayActive,isAutoplayActive=!1,updateTempPlayButtonVisibility(),document.getElementById("temp-play-btn").classList.remove("hidden")),tutorialSavedPlayerState=currentPlayingItem&&activePlayer&&"function"==typeof activePlayer.getPlayerState?(t=activePlayer.getPlayerState(),{item:currentPlayingItem,time:activePlayer.getCurrentTime(),state:pausedForOverlay?YT.PlayerState.PLAYING:t,queue:[...contextPlaybackQueue],queueIndex:currentQueueIndex}):null,t=()=>{I(0),document.getElementById("tutorial-box").classList.remove("hidden")},"music"===e?setTimeout(t,600):t())}else{var t,o=s.target.closest(".view-toggle-btn");if(o){s.preventDefault(),s.stopPropagation(),playAudio(sounds.select);o=o.dataset.targetContainer;if(o){var r=localStorage.getItem("mmg-global-view")||"grid";if(localStorage.setItem("mmg-global-view","grid"===r?"list":"grid"),"library-container"===o){r=document.querySelector("#library-tabs-container .playlist-tab-btn.active");renderLibraryPage(r?r.dataset.tabId:"liked")}else if("titles-cards"===o&&"titles"===currentViewContext.type&&currentViewContext.data){r=document.querySelector(".profile-tab.active")?.dataset.project;let t=currentViewContext.data;renderCards("titles-cards",Object.fromEntries(Object.entries(siteData.contentData[r].titles).filter(([,e])=>e.albumId===t)),"title")}else{var r=document.querySelector(".profile-tab.active")?.dataset.project,c=o.replace("-cards","");renderCards(o,siteData.contentData[r][c]||siteData.contentData[r][c.replace("s","")],"albums"===c?"album":"video")}highlightPlayingCard(currentPlayingItem)}}else{o=s.target.closest(".like-btn-card");if(o)s.preventDefault(),s.stopPropagation(),toggleLike(o.dataset.likeId);else{r=s.target.closest(".add-playlist-btn-card");if(r)s.preventDefault(),s.stopPropagation(),togglePlaylistItem(r.dataset.playlistId);else if(s.target.closest("#details-add-to-playlist-btn"))s.preventDefault(),s.stopPropagation(),(c=document.getElementById("music-title-details-section").dataset.currentItemId)&&togglePlaylistItem(c);else{o=s.target.closest('[data-action="filter-tag"]');if(o)s.preventDefault(),s.stopPropagation(),r=o.dataset.tag,document.getElementById("search-input").value="",document.querySelectorAll("#tags-filter-list input").forEach(e=>e.checked=!1),(c=document.querySelector(`#tags-filter-list input[value="${r.toLowerCase()}"]`))&&(c.checked=!0),updateVisibleCards();else{o=s.target.closest("#details-year-link");if(o){s.preventDefault(),s.stopPropagation();let t=o.dataset.year;t&&(playAudio(sounds.select),document.getElementById("search-input").value="",document.querySelectorAll("#tags-filter-list input").forEach(e=>e.checked=!1),r=Object.fromEntries(Object.entries(allSearchableItems).filter(([,e])=>e.year===t)),document.getElementById("search-results-title").textContent=t,renderCards("search-results-cards",r,"search"),showSection("search-results-section"))}c=s.target.closest(".associated-video-card");if(c){s.preventDefault();let e=c.dataset.itemId;o=findItemById(e);void(o&&(playAudio(sounds.select),playVideoWhenReady(o,[],-1,"video"),r=document.getElementById("mobile-player-toggle-btn"))&&(r.style.display="flex"))}else{c=s.target.closest("a.card-link-wrapper, .sidebar-nav-link, .dashboard-card-button, .carousel-item, .recent-video-item, .dashboard-about-card");if(c){s.preventDefault();let{youtubeId:e,link:t,albumId:a,unlockAlbum:i,itemId:l}=c.dataset||{};o=c.closest(".card, .carousel-item");let n=o?o.dataset.itemId:l;if(i)userCoins>=COIN_COST_UNLOCK?(r=Object.values(allSearchableItems).filter(e=>e.albumId===i&&e.isUnlockable).find(e=>!unlockedDreamSeasonTracks.includes(e.id)))?(userCoins-=COIN_COST_UNLOCK,unlockedDreamSeasonTracks.push(r.id),localStorage.setItem("mmg-userCoins",JSON.stringify(userCoins)),localStorage.setItem("mmg-unlockedTracks",JSON.stringify(unlockedDreamSeasonTracks)),updateCoinDisplay(),showDialog(`${getTranslation("youUnlocked")} "${r.title}"!`),handleMenuNavigation("albums-section")):showDialog(getTranslation("allTracksUnlocked")):(showDialog(getTranslation("needCoinsToUnlock",{COIN_COST_UNLOCK:COIN_COST_UNLOCK})),playAudio(sounds.blocked));else if(e){let i=findItemById(n);if(i)if(i.isUnlockable&&!unlockedDreamSeasonTracks.includes(i.id))showDialog(getTranslation("trackLocked")),playAudio(sounds.blocked);else{var c=document.querySelector(".profile-tab.active")?.dataset.project;let e=[],t=-1,a=(isMusicTitle(i)&&i.albumId?(r=Object.values(siteData.contentData[c].titles).filter(e=>e.albumId===i.albumId),e=r.filter(e=>!e.isUnlockable||unlockedDreamSeasonTracks.includes(e.id)).map(e=>e.id),t=e.findIndex(e=>e===i.id)):(c=o?.parentElement)&&(r=Array.from(c.querySelectorAll(".card:not(.locked)")),e=r.map(e=>e.dataset.itemId).filter(Boolean),t=e.findIndex(e=>e===i.id)),currentNavigationContext={playlist:e,index:t},playAudio(sounds.select),"titles");o=document.querySelector(".page-section:not(.hidden)")?.id,c=("library-section"===o&&document.querySelector('#library-tabs-container .playlist-tab-btn[data-tab-id="liked"]')?.classList.contains("active")?a="liked":"video"===i.type||"bonus"===i.type?a="video":"search-results-section"===o?a="search":i.albumId&&(a="album"),playVideoWhenReady(i,e,t,a),document.getElementById("mobile-player-toggle-btn"));c&&(c.style.display="flex")}}else t?(playAudio(sounds.select),s.target.closest(".sidebar-nav-link"),handleMenuNavigation(t),"guide-overlay"===t?document.getElementById("guide-btn").click():renderSidebarNav(document.querySelector(".profile-tab.active").dataset.project)):a&&(playAudio(sounds.select),r=document.querySelector(".profile-tab.active")?.dataset.project,o=Object.fromEntries(Object.entries(siteData.contentData[r].titles).filter(([,e])=>e.albumId===a)),document.getElementById("titles-section-title").textContent=siteData.contentData[r].albums[a].title,currentViewContext={type:"titles",data:a},renderCards("titles-cards",o,"title"),showSection("titles-section"))}}}}}}}}),e.addEventListener("mousedown",e=>{var e=e.target.closest(".card");e&&(e=e.querySelector(".card__title.scrolling > span"))&&(e.style.animationPlayState="paused")}),e.addEventListener("touchstart",e=>{var e=e.target.closest(".card");e&&(e=e.querySelector(".card__title.scrolling > span"))&&(e.style.animationPlayState="paused")},{passive:!0}),()=>{document.querySelectorAll('.card__title.scrolling > span[style*="animation-play-state: paused"]').forEach(e=>{e.style.animationPlayState="running"})});window.addEventListener("mouseup",e),window.addEventListener("touchend",e),document.getElementById("details-album-link").addEventListener("click",e=>{e.preventDefault();let t=e.currentTarget.dataset.albumId;var a;t&&(playAudio(sounds.select),e=document.querySelector(".profile-tab.active")?.dataset.project,a=Object.fromEntries(Object.entries(siteData.contentData[e].titles).filter(([,e])=>e.albumId===t)),document.getElementById("titles-section-title").textContent=siteData.contentData[e].albums[t].title,currentViewContext={type:"titles",data:t},renderCards("titles-cards",a,"title"),showSection("titles-section"),setupTitleScrollObserver("titles-cards"))}),document.getElementById("mobile-player-album-art").addEventListener("click",e=>{document.getElementById("mobile-full-player").classList.contains("active")&&(document.getElementById("artwork-overlay-img").src=e.target.src,t.classList.remove("hidden"),setSystemBarsColor("#000000"),history.pushState({overlay:"artwork"},""))});let t=document.getElementById("artwork-overlay"),a=(document.getElementById("details-album-art").addEventListener("click",e=>{document.getElementById("artwork-overlay-img").src=e.target.src,t.classList.remove("hidden"),setSystemBarsColor("#000000"),history.pushState({overlay:"artwork"},"")}),t.addEventListener("click",e=>{"artwork-overlay"===e.target.id&&(t.classList.add("hidden"),updateThemeColorMeta(),history.state)&&"artwork"===history.state.overlay&&history.back()}),document.getElementById("player-album-cover").addEventListener("click",()=>{currentPlayingItem&&(playAudio(sounds.select),showSection(isMusicTitle(currentPlayingItem)?"music-title-details-section":"large-player-section"),isMusicTitle(currentPlayingItem))&&renderMusicTitleDetails(currentPlayingItem)}),document.getElementById("search-input")),i=document.getElementById("search-clear-btn");a.addEventListener("input",()=>{i.classList.toggle("hidden",""===a.value),updateVisibleCards()}),i.addEventListener("click",()=>{a.value="",i.classList.add("hidden"),updateVisibleCards(),a.focus()}),document.getElementById("tags-filter-list").addEventListener("change",updateVisibleCards),document.getElementById("theme-switch").addEventListener("change",e=>{document.body.classList.toggle("dark-theme",e.target.checked),playAudio(e.target.checked?sounds.switchToBlack:sounds.switchToWhite),localStorage.setItem("mmg-theme",e.target.checked?"dark":"light"),applyTheme(localStorage.getItem("ui-theme")||"default"),updateThemeColorMeta()});e=document.getElementById("mobile-theme-switch"),e&&(e.checked=document.getElementById("theme-switch").checked,e.addEventListener("change",e=>{document.getElementById("theme-switch").checked=e.target.checked,document.getElementById("theme-switch").dispatchEvent(new Event("change"))})),e=document.getElementById("mobile-guide-btn");e&&e.addEventListener("click",()=>document.getElementById("guide-btn").click()),document.getElementById("sfx-switch").addEventListener("change",e=>{sfxEnabled=e.target.checked,localStorage.setItem("mmg-sfxEnabled",JSON.stringify(sfxEnabled))}),document.querySelectorAll(".lang-btn").forEach(e=>{e.addEventListener("click",e=>{applyLanguage(e.target.dataset.lang),playAudio(sounds.select)})}),document.getElementById("background-play-switch").addEventListener("change",e=>{isBackgroundPlayEnabled=e.target.checked,localStorage.setItem("mmg-backgroundPlayEnabled",JSON.stringify(isBackgroundPlayEnabled))}),document.getElementById("play-pause-box").addEventListener("click",()=>{var e;activePlayer&&currentPlayingItem?(playAudio(sounds.select),activePlayer.getPlayerState()===YT.PlayerState.PLAYING?activePlayer.pauseVideo():activePlayer.playVideo()):0<currentPlaylist.length&&(e=findItemById(currentPlaylist[0]))&&playVideoWhenReady(e,currentPlaylist,0,"myPlaylist")}),document.getElementById("mini-player-play-pause-btn").addEventListener("click",e=>{e.stopPropagation(),document.getElementById("play-pause-box").click()}),document.getElementById("mini-player-like-btn").addEventListener("click",e=>{e.stopPropagation(),document.getElementById("player-like-btn").click()}),document.getElementById("mini-player-close-btn").addEventListener("click",e=>{e.stopPropagation(),activePlayer&&activePlayer.stopVideo(),currentPlayingItem=null,resetMiniPlayerUI()}),document.getElementById("mobile-player-play-pause-box").addEventListener("click",()=>{playAudio(sounds.select),activePlayer.getPlayerState()===YT.PlayerState.PLAYING?activePlayer.pauseVideo():activePlayer.playVideo()}),document.getElementById("next-video-btn").addEventListener("click",()=>playNextTrack(1,isAutoplayActive)),document.getElementById("prev-video-btn").addEventListener("click",()=>playNextTrack(-1,isAutoplayActive)),document.getElementById("loop-btn").addEventListener("click",e=>{isPlayerLooping=!isPlayerLooping,playAudio(sounds.select),isPlayerLooping&&(isShuffleMode=!1),updateLoopShuffleUI()}),document.getElementById("shuffle-btn").addEventListener("click",e=>{isShuffleMode=!isShuffleMode,playAudio(sounds.select),isShuffleMode&&(isPlayerLooping=!1),updateLoopShuffleUI()}),document.getElementById("mobile-player-next-btn").addEventListener("click",()=>playNextTrack(1,!0)),document.getElementById("mobile-player-prev-btn").addEventListener("click",()=>playNextTrack(-1,!0)),document.getElementById("mobile-player-loop-btn").addEventListener("click",()=>{(isPlayerLooping=!isPlayerLooping)&&(isShuffleMode=!1),playAudio(sounds.select),updateLoopShuffleUI()}),document.getElementById("mobile-player-shuffle-btn").addEventListener("click",()=>{(isShuffleMode=!isShuffleMode)&&(isPlayerLooping=!1),playAudio(sounds.select),updateLoopShuffleUI()}),document.getElementById("mobile-player-like-btn").addEventListener("click",()=>document.getElementById("player-like-btn").click()),document.getElementById("mobile-player-add-to-playlist-btn").addEventListener("click",e=>{currentPlayingItem&&togglePlaylistItem(currentPlayingItem.id)}),document.getElementById("mobile-player-queue-btn").addEventListener("click",e=>{e.preventDefault(),renderMobileQueue(),l.classList.remove("hidden"),n.classList.remove("hidden"),requestAnimationFrame(()=>{l.style.transform="translateY(0)"}),playAudio(sounds.select)});let l=document.getElementById("mobile-queue-panel"),n=document.getElementById("mobile-queue-panel-backdrop");function s(){l.style.transform="translateY(100%)",n.classList.add("fading-out"),playAudio(sounds.back),setTimeout(()=>{l.classList.add("hidden"),n.classList.add("hidden"),n.classList.remove("fading-out")},400)}n.addEventListener("click",s);let o=0,r=(l.addEventListener("touchstart",e=>{o=e.touches[0].clientY},{passive:!0}),l.addEventListener("touchend",e=>{e.changedTouches[0].clientY>o+75&&s()}),0),c=0,d=null;document.getElementById("mobile-queue-list").addEventListener("touchstart",e=>{var t,a=e.target.closest(".playlist-item-content");a&&!a.closest(".currently-playing")&&((t=document.querySelector('.playlist-item-content[style*="transform"]'))&&t!==a&&(t.style.transform="translateX(0)"),d=a,r=e.touches[0].clientX,d.style.transition="none")},{passive:!0}),document.getElementById("mobile-queue-list").addEventListener("touchmove",e=>{d&&(e=(c=e.touches[0].clientX)-r)<0&&-100<e&&(d.style.transform=`translateX(${e}px)`)},{passive:!0}),document.getElementById("mobile-queue-list").addEventListener("touchend",e=>{var t;d&&(t=c-r,d.style.transition="transform 0.3s ease-out",d.style.transform=t<-40?"translateX(-80px)":"translateX(0)",d=null,r=0,c=0)}),document.getElementById("mobile-player-share-btn").addEventListener("click",()=>document.getElementById("share-btn").click());var e=e=>{isAutoplayActive=!isAutoplayActive,document.querySelectorAll("#autoplay-toggle, #overlay-autoplay-toggle, #mobile-player-autoplay-btn").forEach(e=>{e.classList.toggle("active",isAutoplayActive),e.title=getTranslation(isAutoplayActive?"autoplayOn":"autoplayOff")}),showDialog(getTranslation(isAutoplayActive?"autoplayOn":"autoplayOff")),playAudio(sounds.select),isAutoplayActive&&activePlayer&&"function"==typeof activePlayer.getPlayerState&&activePlayer.getPlayerState()===YT.PlayerState.ENDED&&playNextTrack(),updateTempPlayButtonVisibility()},e=(document.getElementById("autoplay-toggle").addEventListener("click",e),document.getElementById("overlay-autoplay-toggle").addEventListener("click",e),document.getElementById("mobile-player-autoplay-btn").addEventListener("click",e),async()=>{if(currentPlayingItem){var e={title:"MMGEAR - "+currentPlayingItem.title,text:`Écoute "${currentPlayingItem.title}" sur la MMGEAR !`,url:window.location.href};if(navigator.share)try{await navigator.share(e)}catch(e){console.error("Erreur de partage:",e)}else navigator.clipboard.writeText("https://www.youtube.com/watch?v="+currentPlayingItem.youtube_id).then(()=>showDialog(getTranslation("linkCopied"))).catch(e=>showDialog(getTranslation("copyFailed")))}}),e=(document.getElementById("share-btn").addEventListener("click",e),document.getElementById("overlay-share-btn").addEventListener("click",e),document.getElementById("player-like-btn").addEventListener("click",e=>{currentPlayingItem&&toggleLike(currentPlayingItem.id)}),document.getElementById("mobile-player-progress-bar").addEventListener("click",e=>{var t;activePlayer&&"function"==typeof activePlayer.getDuration&&(t=e.currentTarget.getBoundingClientRect(),activePlayer.seekTo((e.clientX-t.left)/t.width*activePlayer.getDuration(),!0))}),document.getElementById("progress-bar").addEventListener("click",e=>{var t;activePlayer&&"function"==typeof activePlayer.getDuration&&(t=e.currentTarget.getBoundingClientRect(),activePlayer.seekTo((e.clientX-t.left)/t.width*activePlayer.getDuration(),!0),seekDetectedInCurrentPlay=!0)}),document.getElementById("volume-up-btn")),e=(e&&e.addEventListener("click",()=>setVolume(currentVolume+10,!0)),document.getElementById("volume-down-btn")),e=(e&&e.addEventListener("click",()=>setVolume(currentVolume-10,!0)),document.getElementById("mobile-volume-up-btn").addEventListener("click",()=>setVolume(currentVolume+10,!0)),document.getElementById("mobile-volume-down-btn").addEventListener("click",()=>setVolume(currentVolume-10,!0)),document.getElementById("temp-play-btn")?.addEventListener("click",()=>{var e=document.getElementById("music-title-details-section").dataset.currentItemId;e&&(e=findItemById(e))&&(playAudio(sounds.select),playVideoWhenReady(e,[],-1,"titles",!0))}),document.querySelectorAll("#settings-overlay, #wifi-overlay, #tags-filter-overlay, #playlist-overlay, #player-options-overlay, #tutorial-overlay, #notifications-overlay, #reco-playlist-options-overlay, #queue-overlay, #mobile-queue-panel-backdrop, #purchase-confirm-overlay")),u=(document.getElementById("settings-btn").addEventListener("click",e=>{e.preventDefault(),openOverlay(document.getElementById("settings-overlay"),sounds.select,!0)}),document.getElementById("wifi-btn").addEventListener("click",e=>{e.preventDefault(),openOverlay(document.getElementById("wifi-overlay"),null)}),document.getElementById("tags-filter-btn").addEventListener("click",e=>{e.preventDefault(),openOverlay(document.getElementById("tags-filter-overlay"),sounds.select,!0)}),document.getElementById("player-add-to-playlist-btn").addEventListener("click",e=>{currentPlayingItem&&togglePlaylistItem(currentPlayingItem.id)}),document.getElementById("queue-btn").addEventListener("click",e=>{e.preventDefault(),openOverlay(document.getElementById("queue-overlay"),sounds.select,!0)}),document.getElementById("notifications-btn").addEventListener("click",e=>{e.preventDefault(),openOverlay(document.getElementById("notifications-overlay"),sounds.select,!0)}),document.getElementById("mobile-notifications-btn").addEventListener("click",e=>{e.preventDefault(),openOverlay(document.getElementById("notifications-overlay"),sounds.select,!0)}),document.getElementById("mobile-settings-btn")),u=(u&&u.addEventListener("click",e=>{e.preventDefault(),document.getElementById("settings-btn").click()}),document.getElementById("mobile-wifi-btn")),u=(u&&u.addEventListener("click",e=>{e.preventDefault(),document.getElementById("wifi-btn").click()}),e.forEach(t=>{t.addEventListener("click",e=>{e.target!==t||"tutorial-overlay"===t.id&&isTutorialActive||closeOverlay(sounds.back)}),t.querySelector(".close-btn")?.addEventListener("click",()=>{"tutorial-overlay"===t.id?k():closeOverlay(sounds.back)})}),document.getElementById("mark-as-read-btn").addEventListener("click",()=>{playAudio(sounds.select),[...(siteData.updateLog||[]).map(e=>e.id),...(siteData.devMessages||[]).map(e=>e.id)].forEach(e=>readUpdateIds.add(e)),localStorage.setItem("mmg-readUpdateIds",JSON.stringify([...readUpdateIds])),updateNotificationDot(),renderUpdateLog()}),document.getElementById("cheat-code-btn").addEventListener("click",()=>{var e=document.getElementById("cheat-code-input"),t=e.value.toLowerCase();let a=!1;"gameshark"===t?(unlockAllAchievements(),e.value="",showDialog(getTranslation("allAchievementsUnlocked")),playAudio(sounds.select),a=!0):"musicleaks"===t?(t=Object.values(allSearchableItems).filter(e=>e.isUnlockable),unlockedDreamSeasonTracks=t.map(e=>e.id),localStorage.setItem("mmg-unlockedTracks",JSON.stringify(unlockedDreamSeasonTracks)),e.value="",showDialog(getTranslation("allSongsUnlocked")),playAudio(sounds.achievementUnlocked)):(showDialog(getTranslation("incorrectCode")),playAudio(sounds.blocked)),a&&!document.getElementById("shop-section").classList.contains("hidden")&&renderShopPage()}),document.getElementById("settings-bg-music-switch"));u&&((e=document.getElementById("welcome-bg-music-switch"))&&(u.checked=e.checked),u.addEventListener("change",e=>{var t=activePlayer&&"function"==typeof activePlayer.getPlayerState?activePlayer.getPlayerState():-1;e.target.checked&&t!==YT.PlayerState.PLAYING?document.getElementById("background-music").play():document.getElementById("background-music").pause()}));let m=null,y=document.getElementById("playlist-container"),g=".card, .profile-tab, .top-bar-btn, #start-music-btn, #mp3-player-container i, .volume-adjust-btn, .guide-choice-btn";document.body.addEventListener("mouseenter",e=>{e.target.closest(g)&&playAudio(sounds.hover)},!0),document.body.addEventListener("mouseleave",e=>{e.target.closest(g)},!0),y.addEventListener("click",e=>{var a=e.target.closest(".playlist-item-delete");if(a){let t=a.closest(".playlist-item").dataset.itemId;a=currentPlaylist.findIndex(e=>e===t);-1<a&&(currentPlaylist.splice(a,1),localStorage.setItem("mmg-playlist",JSON.stringify(currentPlaylist)),renderPlaylist(),updateCardPlaylistButtonState(t),playAudio(sounds.back))}else{a=e.target.closest(".playlist-item");a&&(e=findItemById(a.dataset.itemId))&&playVideoWhenReady(e,[],-1,!0)}}),document.getElementById("playlist-tabs-container").addEventListener("click",e=>{e=e.target.closest(".playlist-tab-btn");e&&(document.querySelectorAll(".playlist-tab-btn").forEach(e=>e.classList.remove("active")),e.classList.add("active"),playAudio(sounds.hover),renderPlaylist())}),document.getElementById("playlist-reco-list").addEventListener("click",handleRecoPlaylistClick),document.querySelector("#reco-playlist-options-overlay .playlist-options-actions")?.addEventListener("click",e=>{var t,a,i=e.target.closest(".playlist-action-btn");i&&(i=i.dataset.action,{name:e,ids:t}=JSON.parse(e.currentTarget.dataset.recoPlaylist||"{}"),closeOverlay(sounds.select),"play"===i?(a=findItemById(t[0]))&&playVideoWhenReady(a,t,0):"save"===i&&(savedPlaylists[e]?showDialog(`La playlist "${e}" existe déjà.`):(savedPlaylists[e]=t,localStorage.setItem("mmg-savedPlaylists",JSON.stringify(savedPlaylists)),showDialog(getTranslation("playlistSaved")),document.getElementById("library-section").classList.contains("hidden")||renderLibraryPage("current"))))}),y.addEventListener("dragstart",e=>{e.target.classList.contains("playlist-item")&&(m=e.target,setTimeout(()=>e.target.classList.add("dragging"),0))}),y.addEventListener("dragend",e=>{m&&(m.classList.remove("dragging"),m=null)}),y.addEventListener("dragover",e=>{e.preventDefault();e=((e,i)=>(e=[...e.querySelectorAll(".playlist-item:not(.dragging)")]).reduce((e,t)=>{var a=t.getBoundingClientRect(),a=i-a.top-a.height/2;return a<0&&a>e.offset?{offset:a,element:t}:e},{offset:Number.NEGATIVE_INFINITY}).element)(y,e.clientY);m&&(null==e?y.appendChild(m):y.insertBefore(m,e))}),y.addEventListener("drop",e=>{e.preventDefault(),m&&(e=Array.from(y.querySelectorAll(".playlist-item")).map(e=>e.dataset.itemId),currentPlaylist=e,currentPlayingItem&&(currentQueueIndex=currentPlaylist.findIndex(e=>e===currentPlayingItem.id)),localStorage.setItem("mmg-playlist",JSON.stringify(currentPlaylist)),renderPlaylist())}),document.getElementById("clear-playlist-btn").addEventListener("click",()=>{currentPlaylist=[],currentQueueIndex=-1,localStorage.setItem("mmg-playlist",JSON.stringify(currentPlaylist)),renderPlaylist(),showDialog(getTranslation("playlistCleared")),playAudio(sounds.back)});let p=null,v=0,h=[];let b=[{step:1,textKey:"tutorial_music_1",selector:()=>document.querySelector("#titles-cards .card"),position:"pos-bottom"},{step:2,selector:()=>document.querySelector("#titles-cards .card .like-btn-card"),textKey:"tutorial_music_2",position:"pos-top"},{step:3,selector:()=>document.querySelector("#titles-cards .card .add-playlist-btn-card"),textKey:"tutorial_music_3",position:"pos-top",action:()=>{var e=document.querySelector("#titles-cards .card a.card-link-wrapper");e&&(tutorialSuppressAutoplay=!0,e.click())}},{step:4,selector:"#details-album-art",textKey:"tutorial_music_4",position:"pos-top",reverseAction:()=>{showSection("titles-section",!1),document.getElementById("temp-play-btn").classList.remove("hidden")}},{step:5,selector:["#details-album-link","#details-tags"],textKey:"tutorial_music_5",position:"pos-top"},{step:6,selector:"#details-add-to-playlist-btn",textKey:"tutorial_music_6",position:"pos-top"},{step:7,selector:"#streaming-links",textKey:"tutorial_music_7",position:"pos-top"},{step:8,selector:".associated-videos-panel",textKey:"tutorial_music_8",position:"pos-top"},{step:9,selector:"#temp-play-btn",textKey:"tutorial_music_9",position:"pos-top"},{step:10,selector:["#prev-video-btn","#next-video-btn"],textKey:"tutorial_music_10",position:"pos-top"},{step:11,textKey:"tutorial_music_11",position:"pos-top"}],f={main:window.innerWidth<=952?[{step:1,selector:".top-bar",textKey:"tutorial_main_new_5",position:"pos-bottom"},{step:2,selector:".mobile-header-icons",textKey:"tutorial_main_new_6"},{step:3,selector:".search-bar",textKey:"tutorial_main_3"},{step:4,selector:"#mobile-profile-switch",textKey:"tutorial_main_9",position:"pos-bottom"},{step:5,selector:"#home-dashboard-section",textKey:"tutorial_main_new_7",position:"pos-top"},{step:6,selector:".carousel-card",textKey:"tutorial_main_new_8"},{step:7,selector:".liked-preview-card",textKey:"tutorial_main_new_9"},{step:8,selector:".activity-card",textKey:"tutorial_main_new_10"},{step:9,selector:"#mobile-mini-player",textKey:"tutorial_main_12",position:"pos-center"},{step:10,selector:"#mini-player-album-art",textKey:"tutorial_main_13",position:"pos-top"},{step:11,selector:"#mobile-bottom-nav",textKey:"tutorial_main_new_3",position:"pos-top"},{step:12,selector:"#mobile-player-toggle-handle",textKey:"tutorial_main_new_13",position:"pos-top"}]:[{step:1,selector:".sidebar",textKey:"tutorial_main_new_1",position:"pos-right"},{step:2,selector:".sidebar-header-buttons",textKey:"tutorial_main_1"},{step:3,selector:"#notifications-btn",textKey:"tutorial_main_new_2"},{step:4,selector:".central-profiles-card",textKey:"tutorial_main_9",position:"pos-bottom"},{step:5,selector:"#sidebar-main-nav",textKey:"tutorial_main_new_3"},{step:6,selector:".sidebar-footer",textKey:"tutorial_main_new_4"},{step:7,selector:".top-bar",textKey:"tutorial_main_new_5",position:"pos-bottom"},{step:8,selector:".search-bar",textKey:"tutorial_main_3"},{step:9,selector:".top-bar-right",textKey:"tutorial_main_new_6"},{step:10,selector:"#home-dashboard-section",textKey:"tutorial_main_new_7",position:"pos-top"},{step:11,selector:".carousel-card",textKey:"tutorial_main_new_8"},{step:12,selector:".liked-preview-card",textKey:"tutorial_main_new_9"},{step:13,selector:".activity-card",textKey:"tutorial_main_new_10"},{step:14,selector:"#mp3-player-container",textKey:"tutorial_main_12",position:"pos-center"},{step:15,selector:"#player-album-cover",textKey:"tutorial_main_13",position:"pos-top"},{step:16,selector:".player-buttons",textKey:"tutorial_main_new_11",position:"pos-top"},{step:17,selector:".player-right-controls",textKey:"tutorial_main_new_12",position:"pos-top"},{step:18,selector:"#player-toggle-handle",textKey:"tutorial_main_new_13",position:"pos-top"}],music:b};function I(e){if(0<h.length&&(h.forEach(e=>{e.classList.remove("tutorial-highlight"),e.classList.contains("card")&&(e.style.opacity="")}),h=[]),e<0||e>=p.length)k();else{document.getElementById("tutorial-prev").style.visibility=0===e?"hidden":"visible",v=e;e=p[e];let t=[];"function"==typeof e.selector?(i=e.selector(),t=Array.isArray(i)?i.filter(Boolean):i?[i]:[]):"string"==typeof e.selector?(i=document.querySelector(e.selector))&&t.push(i):Array.isArray(e.selector)?e.selector.forEach(e=>{e=document.querySelector(e);e&&t.push(e)}):t=[document.body],0===t.length?console.warn(`Tutorial element(s) not found for step ${e.step}:`,e.selector):(h=t).forEach(e=>{e.classList.add("tutorial-highlight"),e.classList.contains("card")&&(e.style.opacity=1)});var a,i=document.getElementById("tutorial-box");document.getElementById("tutorial-text").textContent=getTranslation(e.textKey),document.getElementById("tutorial-step-counter").textContent=e.step+" / "+p.length,i=i,a=h[0],e.position,i&&(i.style.left="50%",i.style.top="auto",i.style.bottom="auto",i.style.transform="translateX(-50%)",i.className="tutorial-box",a?(a=a.getBoundingClientRect(),e=window.innerHeight,a.top>e/2?(i.style.top="15px",i.classList.add("pos-top")):(i.style.bottom="15px",i.classList.add("pos-bottom"))):(i.style.top="50%",i.style.transform="translate(-50%, -50%)"))}}function k(){document.getElementById("tutorial-box").classList.add("hidden"),0<h.length&&(h.forEach(e=>{e.classList.remove("tutorial-highlight")}),h=[]),isTutorialActive=!1,document.body.classList.remove("tutorial-active-body"),closeOverlay(sounds.back),p&&p===b&&(isAutoplayActive=originalAutoplayState,updateTempPlayButtonVisibility(),resetToHome(!1)),p=null,v=0,tutorialSavedPlayerState=null}document.getElementById("tutorial-next").addEventListener("click",async()=>{var e=p[v];e&&e.action&&(await e.action(),await new Promise(e=>setTimeout(e,500))),I(v+1)}),document.getElementById("tutorial-prev").addEventListener("click",async()=>{var e=p[v];e&&e.reverseAction&&(await e.reverseAction(),await new Promise(e=>setTimeout(e,500))),I(v-1)}),document.getElementById("tutorial-close").addEventListener("click",k);e=document.getElementById("library-section");if(e){let l=0,n=0;e.addEventListener("touchstart",e=>{1===e.touches.length&&(l=e.touches[0].clientX,n=e.touches[0].clientY)},{passive:!0}),e.addEventListener("touchend",t=>{if(1===t.changedTouches.length){var a=t.changedTouches[0].clientX,t=t.changedTouches[0].clientY,a=a-l,t=Math.abs(t-n);if(!(t>Math.abs(a))&&50<Math.abs(a)){var t=Array.from(document.querySelectorAll("#library-tabs-container .playlist-tab-btn")),i=t.findIndex(e=>e.classList.contains("active"));let e=i;(e=a<0?Math.min(t.length-1,i+1):Math.max(0,i-1))!==i&&(playAudio(sounds.hover),renderLibraryPage(t[e].dataset.tabId),i=document.getElementById("library-container"))&&(i.classList.remove("fade-in-right","fade-in-left"),i.offsetWidth,a<0?i.classList.add("fade-in-right"):i.classList.add("fade-in-left"))}}},{passive:!0})}u=document.getElementById("videos-section");if(u){let l=0,n=0;u.addEventListener("touchstart",e=>{1===e.touches.length&&(l=e.touches[0].clientX,n=e.touches[0].clientY)},{passive:!0}),u.addEventListener("touchend",t=>{if(1===t.changedTouches.length){var a=t.changedTouches[0].clientX,t=t.changedTouches[0].clientY,a=a-l,t=Math.abs(t-n);if(!(t>Math.abs(a))&&50<Math.abs(a)){var t=Array.from(document.querySelectorAll("#videos-tabs-container .playlist-tab-btn")),i=t.findIndex(e=>e.classList.contains("active"));let e=i;(e=a<0?Math.min(t.length-1,i+1):Math.max(0,i-1))!==i&&(playAudio(sounds.hover),t[e].click())}}},{passive:!0})}document.querySelectorAll(".profile-tab").forEach(e=>{e.addEventListener("click",()=>{var i=document.querySelector(".profile-tab.active")?.dataset.project;let l=e.dataset.project;if(document.querySelectorAll(".profile-tab").forEach(e=>e.classList.remove("active")),e.classList.add("active"),document.querySelectorAll("#mobile-profile-switch .profile-switch-btn").forEach(e=>{e.classList.toggle("active",e.dataset.project===l)}),i&&i!==l){let a=document.querySelector(".page-section:not(.hidden)")?.id||"home-dashboard-section",e="home-dashboard-section";if(["library-section"].includes(a))e=a;else if("home-dashboard-section"!==a){let t=Object.values(siteData.projectData[i]).find(e=>e.link===a);t&&(i=Object.values(siteData.projectData[l]).find(e=>e.langKey===t.langKey||e.link===t.link))&&(e=i.link)}renderSidebarNav(l),handleMenuNavigation(e),renderSocials()}})});let E=document.getElementById("mobile-full-player");e=document.getElementById("mobile-mini-player");let P=0,w=0,S=(e.addEventListener("touchstart",e=>{e.target.closest(".mini-player-controls")||(P=e.touches[0].clientX,w=e.touches[0].clientY)},{passive:!0}),e.addEventListener("touchend",e=>{0!==w&&(50<e.changedTouches[0].clientY-w&&(document.body.classList.add("mobile-player-hidden"),document.documentElement.style.setProperty("--mobile-player-height","0px"),playAudio(sounds.minimize)),P=0,w=0)}),0);E.addEventListener("touchstart",e=>{e.target.closest(".mobile-player-volume-wrapper")||e.target.closest(".mobile-player-progress")||(S=e.touches[0].clientY)},{passive:!0}),E.addEventListener("touchend",e=>{e=e.changedTouches[0].clientY;0<S&&e>S+75&&(E.classList.remove("active"),playAudio(sounds.back)),S=0});let L=0;function T(e){document.fullscreenElement?document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen():e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()}t.addEventListener("touchstart",e=>{L=e.changedTouches[0].screenY},{passive:!0}),t.addEventListener("touchend",e=>{e.changedTouches[0].screenY>L+50&&(t.classList.add("hidden"),updateThemeColorMeta(),playAudio(sounds.back),history.state)&&"artwork"===history.state.overlay&&history.back()},{passive:!0}),e.addEventListener("click",e=>{!currentPlayingItem||e.target.closest(".mini-player-controls")||e.target.closest(".mini-player-like-btn")||(e.target.closest("#mini-player-album-art")?(playAudio(sounds.select),isMusicTitle(currentPlayingItem)?(renderMusicTitleDetails(currentPlayingItem),showSection("music-title-details-section")):showSection("large-player-section")):isMusicTitle(currentPlayingItem)?(E.classList.add("active"),playAudio(sounds.maximize)):showSection("large-player-section"))}),document.getElementById("mobile-bottom-nav").addEventListener("click",e=>{var t=e.target.closest(".mobile-nav-link[data-link]");t&&(e.preventDefault(),handleMenuNavigation(t.dataset.link))}),document.getElementById("exit-fullscreen-btn").addEventListener("click",()=>{document.fullscreenElement&&T()}),document.getElementById("fullscreen-btn").addEventListener("click",()=>{var e=document.getElementById("large-player-iframe");e&&T(e)});let x=0,B=e=>{1===e.touches.length&&(x=e.touches[0].clientY)},O=e=>{75<e.changedTouches[0].clientY-x&&document.fullscreenElement&&document.exitFullscreen&&document.exitFullscreen()};document.addEventListener("fullscreenchange",()=>{var e=document.fullscreenElement,t=document.getElementById("exit-fullscreen-btn");t&&t.classList.toggle("visible",!!e),e&&(e.addEventListener("touchstart",B,{passive:!0}),e.addEventListener("touchend",O,{passive:!0}))});u=document.getElementById("pwa-install-btn"),e=document.getElementById("pwa-dismiss-btn");let C=document.getElementById("pwa-install-overlay");function A(e){document.querySelectorAll("#shop-rewards-tabs .playlist-tab-btn").forEach(e=>e.classList.remove("active")),document.querySelector(`#shop-rewards-tabs .playlist-tab-btn[data-tab="${e}"]`).classList.add("active");var t=document.getElementById("shop-themes-content"),a=document.getElementById("shop-missions-content");t.classList.toggle("hidden","themes"!==e),a.classList.toggle("hidden","missions"!==e),playAudio(sounds.select)}u.addEventListener("click",async()=>{var e;deferredPrompt&&(C.classList.add("hidden"),deferredPrompt.prompt(),e=(await deferredPrompt.userChoice).outcome,console.log("User response to the install prompt: "+e),deferredPrompt=null)}),e.addEventListener("click",()=>{C.classList.add("hidden")}),document.querySelectorAll(".settings-card").forEach(e=>{let a=0;e.closest(".overlay");e.addEventListener("touchstart",e=>{var t=e.target.closest('[class*="container"], [class*="list"]');a=t&&t.scrollHeight>t.clientHeight&&0<t.scrollTop?0:e.touches[0].clientY},{passive:!0}),e.addEventListener("touchend",e=>{e=e.changedTouches[0].clientY;0<a&&e>a+75&&closeOverlay(sounds.back),a=0})}),document.getElementById("card-context-menu").addEventListener("click",e=>{var t=e.target.closest(".context-menu-btn");t&&(e.stopPropagation(),e=t.dataset.action,t=t.parentElement.parentElement.dataset.itemId,"play-next"===e?playNext(t):"add-to-queue"===e?addToQueue(t):"remove-from-queue"===e&&(removeFromQueue(t),playAudio(sounds.back)),closeCardContextMenu())});let M=document.getElementById("main-content-wrapper"),D=0,$=0,_=!1;M.addEventListener("touchstart",e=>{e.touches[0].clientX<50&&1===e.touches.length&&(D=e.touches[0].clientX,$=e.touches[0].clientY,_=!0,M.style.transition="none")},{passive:!0}),M.addEventListener("touchmove",e=>{_&&0<(e=e.touches[0].clientX-D)&&(M.style.transform=`translateX(${Math.pow(e,.85)}px)`)},{passive:!0}),M.addEventListener("touchend",e=>{var t;_&&(t=e.changedTouches[0].clientX-D,e=Math.abs(e.changedTouches[0].clientY-$),M.style.transition="transform 0.3s ease-out",100<t&&e<100&&window.history.back(),M.style.transform="translateX(0)",_=!1)});u=document.getElementById("shop-rewards-tabs"),u&&u.addEventListener("click",e=>{e=e.target.closest(".playlist-tab-btn");e&&!e.classList.contains("active")&&A(e.dataset.tab)}),e=document.getElementById("shop-section");if(e){let l=0,n=0;e.addEventListener("touchstart",e=>{1===e.touches.length&&(l=e.touches[0].clientX,n=e.touches[0].clientY)},{passive:!0}),e.addEventListener("touchend",t=>{if(1===t.changedTouches.length){var a=t.changedTouches[0].clientX,t=t.changedTouches[0].clientY,a=a-l,t=Math.abs(t-n);if(!(t>Math.abs(a)||Math.abs(a)<50)){var t=Array.from(document.querySelectorAll("#shop-rewards-tabs .playlist-tab-btn")),i=t.findIndex(e=>e.classList.contains("active"));let e=i;a<0&&i<t.length-1?e++:0<a&&0<i&&e--,e!==i&&A(t[e].dataset.tab)}}},{passive:!0})}u=document.getElementById("themes-container");u&&u.addEventListener("click",e=>{var t=e.target.closest(".shop-list-item.locked");t&&!e.target.closest("button")&&(t=t.dataset.missionId)&&(e.preventDefault(),e.stopPropagation(),playAudio(sounds.blocked),e=getTranslation(`achievement_${t}_title`),showDialog(getTranslation("finishMission")+` "${e}"`))})}function openCardContextMenu(e,t){var a=document.getElementById("card-context-menu"),t=(a.dataset.itemId=t,a.classList.remove("hidden"),(e.touches?e.touches[0]:e).clientX),e=(e.touches?e.touches[0]:e).clientY,i=a.offsetWidth,l=a.offsetHeight,n=window.innerWidth,s=window.innerHeight;let o=t,r=e;n<t+i&&(o=n-i-10),s<e+l&&(r=s-l-10),a.style.left=o+"px",a.style.top=r+"px",setTimeout(()=>{document.addEventListener("click",closeCardContextMenu,{once:!0})},0)}function closeCardContextMenu(){var e=document.getElementById("card-context-menu");e&&e.classList.add("hidden"),document.removeEventListener("click",closeCardContextMenu)}function adjustScrollAfterPlayerToggle(){let e=document.querySelector(".content-section-board");e&&e.scrollHeight-e.scrollTop-e.clientHeight<100&&setTimeout(()=>{e.scrollTop=e.scrollHeight},50)}function removeFromQueue(e){e=userQueue.indexOf(e);-1<e&&(userQueue.splice(e,1),updateAllQueueViews())}function updateAllQueueViews(){renderDashboardQueue();var e=document.getElementById("queue-overlay"),e=(e&&!e.classList.contains("hidden")&&renderQueue(),document.getElementById("mobile-queue-panel"));e&&!e.classList.contains("hidden")&&renderMobileQueue()}document.body.addEventListener("click",e=>{var a=e.target.closest(".shop-product-card"),t=e.target.closest(".theme-buy-btn"),i=e.target.closest(".shop-buy-btn");let l=null;if(t?l=t:!a||i||a.classList.contains("locked")||(l=a.querySelector(".theme-buy-btn")),t&&t.classList.contains("locked"))e.preventDefault(),e.stopPropagation(),(a=t?.dataset.achievement)&&(t=getTranslation(`achievement_${a}_title`),showDialog(getTranslation("finishMission")+` "${t}"`)),playAudio(sounds.blocked);else{if(i){e.preventDefault(),e.stopPropagation();let t=i.dataset.itemId;a=siteData.shopItems.backgrounds.find(e=>e.id===t);return a?void(userCoins>=a.cost?(userCoins-=a.cost,purchasedShopItems.add(a.id),localStorage.setItem("mmg-userCoins",JSON.stringify(userCoins)),localStorage.setItem("mmg-purchasedItems",JSON.stringify([...purchasedShopItems])),updateCoinDisplay(),renderShopItems(),playAudio(sounds.coin),showDialog(getTranslation("purchaseSuccess"))):(showDialog(getTranslation("notEnoughCoins")),playAudio(sounds.blocked))):void 0}!l||l.classList.contains("locked")||l.classList.contains("selected")||(e.preventDefault(),e.stopPropagation(),applyTheme(l.dataset.theme),playAudio(sounds.select))}});let renderVideosPage=(t="clips")=>{var e,a,i=document.getElementById("videos-tabs-container"),l=document.getElementById("videos-section-title");i&&l&&(e=document.querySelector(".profile-tab.active")?.dataset.project||"mmg-music",e=siteData.contentData[e],e=[{id:"clips",title:getTranslation("videos"),data:e.videos},{id:"makingofs",title:getTranslation("bonus"),data:e.bonus}],i.innerHTML=e.map(e=>`<button class="playlist-tab-btn ${e.id===t?"active":""}" data-tab-id="${e.id}">${e.title}</button>`).join(""),a=e.find(e=>e.id===t)?.data||{},l.textContent=e.find(e=>e.id===t)?.title||getTranslation("videos"),renderCards("videos-cards",a,"video"),i.querySelectorAll(".playlist-tab-btn").forEach(e=>{e.addEventListener("click",()=>{playAudio(sounds.select),renderVideosPage(e.dataset.tabId)})}),currentViewContext={type:"videos",data:t})};function handleMenuNavigation(t,e=!0,a=null){var i="library-section"===t&&"library"===a?.type?a.data:"liked";let l=document.querySelector(".profile-tab.active")?.dataset.project;var n=document.querySelector(".content-section-board");n&&(n.scrollTop=0);let s=siteData.contentData[l];var o,n={"albums-section":{data:(o="albums-section",n=siteData.projectData[l],((n=Object.values(n).find(e=>e.link===o))?s[n.langKey]:null)||s.albums),type:"album",container:"albums-cards"}};if(document.getElementById(t)||(currentViewContext={type:"home",data:null},t="home-dashboard-section"),document.getElementById("about-content").style.backgroundImage="","home-dashboard-section"===t)currentViewContext={type:"home",data:null},renderDashboard();else if("about-section"===t){currentViewContext={type:"about",data:null},document.getElementById("about-title").textContent=getTranslation("about");var r="mmg-music"===l?"assets/mmg-music-avatar.webp":"assets/mmg-beats-avatar.webp",c="about_"+l.replace("-","_");document.getElementById("about-content").innerHTML=`<img src="${r}" alt="Avatar"><p>${getTranslation(c)}</p>`}else{if("liked-titles-section"===t)return void handleMenuNavigation("library-section",e);"library-section"===t?(currentViewContext={type:"library",data:i},renderLibraryPage(i),(r=document.getElementById("shop-section"))&&!r.classList.contains("hidden")&&renderShopPage()):"shop-section"===t?(currentViewContext={type:"shop",data:null},renderShopPage()):"videos-section"===t?(c="videos"===a?.type?a.data:"clips",renderVideosPage(c)):n[t]&&(currentViewContext={type:n[t].type,data:null},i=n[t].type,renderCards(n[t].container,n[t].data,i))}unhighlightPlayingCard(),showSection(t,e),document.querySelectorAll("#mobile-bottom-nav .mobile-nav-link, #sidebar-main-nav .sidebar-nav-link").forEach(e=>{e.classList.toggle("active",e.dataset.link===t)})}function renderLibraryPage(a="liked"){var i=document.getElementById("library-tabs-container"),l=document.getElementById("library-section-title"),n=document.getElementById("library-clear-playlist-btn");if(i&&l&&n){var s=[{id:"liked",title:getTranslation("likedTitles")},{id:"current",title:getTranslation("currentPlaylist")}],o=Object.keys(savedPlaylists).map(e=>({id:e,title:e}));i.innerHTML=[...s,...o].map(e=>`<button class="playlist-tab-btn ${e.id===a?"active":""}" data-tab-id="${e.id}" title="${e.title}">${e.title}</button>`).join("");let e=[],t=!1;t="liked"===a?(e=[...likedSongs].map(e=>findItemById(e)).filter(Boolean),l.textContent=getTranslation("likedTitles"),!1):"current"===a?(e=currentPlaylist.map(e=>findItemById(e)).filter(Boolean),l.textContent=getTranslation("currentPlaylist"),!0):(e=(savedPlaylists[a]||[]).map(e=>findItemById(e)).filter(Boolean),l.textContent=a,!1),n&&(n.style.display=t?"flex":"none");renderCards("library-container",e.reduce((e,t)=>(t&&(e[t.id]=t),e),{}),"title");s=document.getElementById("library-container"),o="list"===(localStorage.getItem("mmg-global-view")||"grid");if(s.classList.toggle("titles-grid",!o),s.classList.toggle("list-view",o),currentPlayingItem&&highlightPlayingCard(currentPlayingItem),0===e.length){l=document.getElementById("library-container");let e="noResults";"liked"===a?e="noLikedTitles":"current"===a&&(e="playlistEmpty"),l.innerHTML=`<p style="font-size: 1.2em; opacity: 0.7; text-align: center; padding: 40px 20px;">${getTranslation(e)}</p>`,l.style.display="flex",l.style.alignItems="center"}i.querySelectorAll(".playlist-tab-btn").forEach(e=>{e.addEventListener("click",()=>{renderLibraryPage(e.dataset.tabId)})}),n.onclick=()=>{currentPlaylist=[],currentQueueIndex=-1,localStorage.setItem("mmg-playlist",JSON.stringify(currentPlaylist)),renderLibraryPage("current"),showDialog(getTranslation("playlistCleared")),playAudio(sounds.back)}}}function updateLoopShuffleUI(){var e=[document.getElementById("loop-btn"),document.getElementById("mobile-player-loop-btn")],t=[document.getElementById("shuffle-btn"),document.getElementById("mobile-player-shuffle-btn")];e.forEach(e=>e?.classList.toggle("active",isPlayerLooping)),t.forEach(e=>e?.classList.toggle("active",isShuffleMode))}function renderSocials(){var e=document.getElementById("socials-list-container");if(e){var t=document.querySelector(".profile-tab.active")?.dataset.project||"mmg-music",t=siteData.projectData[t]?.socialLinks;if(t){let i={instagram:{name:"Instagram",icon:"fab fa-instagram"},spotify:{name:"Spotify",icon:"fab fa-spotify"},appleMusic:{name:"Apple Music",icon:"fab fa-apple"},deezer:{name:"Deezer",icon:"fab fa-deezer"}};e.innerHTML=Object.entries(t).map(([e,t])=>{var a=i[e];return a?`
                <a href="${t.url}" target="_blank" class="Btn ${e}" title="${a.name}">
                    <i class="${a.icon}"></i>
                    <span class="text">${t.user}</span>
                </a>
            `:""}).join("")}else e.innerHTML=""}}function renderDashboard(){renderDashboardCarousel(),renderRecommendedPlaylists(),renderDashboardGuide(),renderDashboardQueue(),renderSocials();var e="mmg-music"===(document.querySelector(".profile-tab.active")?.dataset.project||"mmg-music")?"assets/mmg-music-avatar.webp":"assets/mmg-beats-avatar.webp",t=document.querySelector(".dashboard-about-card");t&&(t.style.backgroundImage=`url('${e}')`)}function renderDashboardGuide(){var e=document.getElementById("dashboard-guide-buttons");e&&(e.innerHTML=`
            <button class="guide-choice-btn" data-guide="main" data-lang-key="guideMain">1. Menu Principal</button>
            <button class="guide-choice-btn" data-guide="music" data-lang-key="guideMusic">2. Titres Musicaux</button>
        `)}function renderDashboardCarousel(){var e,t=document.getElementById("dashboard-carousel-container"),a=document.getElementById("dashboard-carousel-dots");t&&a&&(e=document.querySelector(".profile-tab.active")?.dataset.project||"mmg-music",e=Object.values(siteData.contentData[e].titles).sort((e,t)=>new Date(t.year,0,1)-new Date(e.year,0,1)).slice(0,3),t.innerHTML=e.map(e=>{var t=getTranslation("desc_"+e.id);let a=t.startsWith("[")&&e.description?e.description:t;return 50<a.length&&(a=a.substring(0,50)+"..."),`
            <div class="carousel-item" data-item-id="${e.id}">
                <img src="${getCorrectImagePath(e,"thumb")}" alt="${e.title}" loading="lazy" decoding="async" onerror="this.onerror=null;this.src='${getCorrectImagePath(e,"full")}'" /> <!-- Utilise la vignette -->
                <div class="carousel-item-info">
                    <h3 class="card__title"><span>${e.title}</span></h3>
                    <p>${a}</p>
                    <button class="dashboard-card-button" data-youtube-id="${e.youtube_id}" data-item-id="${e.id}">${getTranslation("listenNow")}</button>
                </div>
            </div>
        `}).join(""),a.innerHTML=e.map((e,t)=>`<button data-slide-index="${t}" class="${0===t?"active":""}"></button>`).join(""),setupCarousel(),setupTitleScrollObserver("#dashboard-carousel-container .carousel-item-info .card__title > span"))}function handleRecoPlaylistClick(e){e.preventDefault(),e.stopPropagation();e=e.target.closest(".card");if(e){var a=e.dataset.itemId,e=e.querySelector(".card__title span").textContent;if(!savedPlaylists[e]){var i=document.querySelector(".profile-tab.active")?.dataset.project||"mmg-music",i=Object.values(siteData.contentData[i].titles);let t=["title1","title2","title3","title4","title5","title7","title8","title12","title13","title16","title17","title20","title21"];a="chill"===a?i.filter(e=>t.includes(e.id)):i.filter(e=>["title3","title4","title8"].includes(e.id));savedPlaylists[e]=a.map(e=>e.id),localStorage.setItem("mmg-savedPlaylists",JSON.stringify(savedPlaylists)),showDialog(getTranslation("playlistSaved"))}playAudio(sounds.select),handleMenuNavigation("library-section",!0,{type:"library",data:e})}}function renderRecommendedPlaylists(){var e=document.getElementById("playlist-reco-list");if(e){var a=document.querySelector(".profile-tab.active")?.dataset.project||"mmg-music",a=Object.values(siteData.contentData[a].titles);let t=["title1","title2","title3","title4","title5","title7","title8","title12","title13","title16","title17","title20","title21"];a=[{id:"chill",name:"Chill Vibes",icon:"fa-music",items:a.filter(e=>t.includes(e.id))},{id:"frutiger",name:"Frutiger Aero",icon:"fa-bolt",items:a.filter(e=>["title3","title4","title8"].includes(e.id))}];a.every(e=>0===e.items.length)?e.innerHTML='<p class="no-content-message">Aucune playlist recommandée.</p>':e.innerHTML=a.map(e=>`
                <div class="card card-reco-playlist" data-item-id="${e.id}">
                    <a href="#" class="card-link-wrapper" data-album-id="${e.id}">
                        <div class="card-image-container">
                            <div class="card__image card-icon-bg reco-playlist-${e.id}">
                                <i class="fas ${e.icon}"></i>
                            </div>
                        </div>
                    </a>
                    <div class="card-info-container">
                        <div class="card__text">
                            <p class="card__title" title="${e.name}"><span>${e.name}</span></p>
                        </div>
                    </div>
                </div>`).join("")}}function renderDashboardQueue(){var e,t,a,i=document.getElementById("dashboard-queue-list");i&&(t=userQueue.slice(0,4),e=4<userQueue.length,0===userQueue.length?(i.innerHTML=`<p style="font-size: 0.9em; opacity: 0.7; text-align: center; padding: 20px; line-height: 1.5;">${getTranslation("queueEmpty")}</p>`,i.style.display="flex",i.style.alignItems="center",i.style.justifyContent="center",(a=document.querySelector('[data-header-for="dashboard-queue-list"]'))&&a.classList.add("hidden")):(a=t.reduce((e,t)=>{t=findItemById(t);return t&&(e[t.id]=t),e},{}),t=localStorage.getItem("mmg-global-view"),localStorage.setItem("mmg-global-view","list"),renderCards("dashboard-queue-list",a,"title"),t?localStorage.setItem("mmg-global-view",t):localStorage.removeItem("mmg-global-view"),e&&((a=document.createElement("button")).textContent=getTranslation("viewMore"),a.className="dashboard-see-more-btn",a.addEventListener("click",()=>{openOverlay(document.getElementById("queue-overlay"),sounds.select,!0)}),i.appendChild(a))))}function handleRecoPlaylistClick(t){t.preventDefault(),t.stopPropagation();t=t.target.closest(".card");if(t){var a=t.dataset.itemId,t=t.querySelector(".card__title span").textContent;if(!savedPlaylists[t]){var i=document.querySelector(".profile-tab.active")?.dataset.project||"mmg-music",i=Object.values(siteData.contentData[i].titles);let e=[];"chill"===a?e=i.filter(e=>e.tags?.includes("chill")):"frutiger"===a&&(e=i.filter(e=>["title3","title4","title8"].includes(e.id))),savedPlaylists[t]=e.map(e=>e.id),localStorage.setItem("mmg-savedPlaylists",JSON.stringify(savedPlaylists)),showDialog(getTranslation("playlistSaved"))}playAudio(sounds.select),handleMenuNavigation("library-section",!0,{type:"library",data:t})}}function setupCarousel(){let l=document.getElementById("dashboard-carousel-container");var e=document.getElementById("dashboard-carousel-dots");if(l&&e){let a=0;var n=l.querySelectorAll(".carousel-item");let t=e.querySelectorAll("button"),i=n.length;if(!(i<=1)){carouselInterval&&clearInterval(carouselInterval),carouselInterval=setInterval(o,5e3),t.forEach((e,t)=>{e.addEventListener("click",()=>{s(t),r()})});let e;function s(e){e=(a=(e+i)%i)*l.offsetWidth;l.scrollLeft=e,t.forEach((e,t)=>{e.classList.toggle("active",t===a)})}function o(){s(a+1)}function r(){clearInterval(carouselInterval),carouselInterval=setInterval(o,5e3)}l.addEventListener("scroll",()=>{clearTimeout(e),e=setTimeout(()=>{var e=Math.round(l.scrollLeft/l.offsetWidth);e!==a&&(s(e),r())},100)})}}}function renderMobileQueue(){var t=document.getElementById("mobile-queue-list"),a=document.getElementById("mobile-queue-context-name");if(t&&a){currentPlayingItem&&userQueue.indexOf(currentPlayingItem.id);var i=userQueue;let e="";if(currentPlayingItem)switch(currentPlaybackContext.type){case"album":e="Album : "+currentPlaybackContext.name;break;case"playlist":case"mmgPlaylist":e="Playlist : "+currentPlaybackContext.name;break;case"liked":e=getTranslation("fromLiked");break;case"search":e=getTranslation("fromSearch");break;default:e=getTranslation("fromTitles")}a.textContent=e;a=currentPlayingItem?`
            <div class="playlist-item-wrapper">
                <div class="playlist-item-content">
                    <div class="playlist-item currently-playing" data-item-id="${currentPlayingItem.id}">
                        <span class="mobile-queue-drag-handle-placeholder"></span> <!-- CORRECTION: Le titre en cours n'a pas de poignée -->
                        <img src="${getCorrectImagePath(currentPlayingItem)}" alt="${currentPlayingItem.title}">
                        <div class="playlist-item-info">
                            <p class="playlist-item-title">${currentPlayingItem.title}</p>
                            <p class="playlist-item-subtitle">${currentPlayingItem.year||"Vidéo"}</p>
                        </div>
                        <span class="currently-playing-indicator"><i class="fas fa-volume-up"></i></span>
                    </div>
                </div>
            </div>
        `:"",i=i.map(e=>{var t=findItemById(e);return t?`
                <div class="playlist-item-wrapper">
                    <div class="playlist-item-delete-action" data-delete-id="${e}">
                        <i class="fas fa-trash-alt"></i>
                    </div>
                    <div class="playlist-item-content">
                        <div class="playlist-item" data-item-id="${e}">
                            <i class="fas fa-bars mobile-queue-drag-handle"></i>
                            <img src="${getCorrectImagePath(t)}" alt="${t.title}">
                            <div class="playlist-item-info">
                                <p class="playlist-item-title">${t.title}</p>
                                <p class="playlist-item-subtitle">${t.year||"Vidéo"}</p>
                            </div>
                        </div>
                    </div>
                </div>`:""}).join("");t.innerHTML=a+i,t.querySelectorAll(".playlist-item-delete-action").forEach(a=>{a.addEventListener("click",e=>{e.stopPropagation();let t=a.dataset.deleteId;e=a.closest(".playlist-item-wrapper");e?(e.style.transition="opacity 0.3s ease, transform 0.3s ease, max-height 0.3s ease",e.style.transform="translateX(20px)",e.style.opacity="0",e.style.maxHeight="0px",setTimeout(()=>removeFromQueue(t),300)):removeFromQueue(t),playAudio(sounds.back)})})}}function renderUpdateLog(){var e,t=document.getElementById("update-log-entries");t&&siteData.updateLog&&(e=[...siteData.devMessages||[],...siteData.updateLog||[]],t.innerHTML=e.map(e=>{var t=readUpdateIds.has(e.id);e.content.includes("développeur");return`
                <div class="update-log-entry ${t?"read":"unread"}">
                    <h5>${e.date||"Message du développeur"}</h5>
                    <p>${e.content}</p>
                </div>
            `}).join(""))}